/*==============================================================================

  file:     mrGeomShaderObject.cpp

  author:   Daniel Levesque

  created:  16 June 2003

  description:

    Simple object plugin used for instancing geometry using geometry shaders.
    

  modified:	


Copyright 2004 Autodesk
==============================================================================*/
#include "resource.h"

#include "mrGeomShaderObject.h"
#include "Utility.h"
#include "iparamb2.h"

#include <mentalray\imrShader.h>
#include <mentalray\imrPreferences.h>
#include <mentalray\imrShaderClassDesc.h>
#include <mentalray\shared_src\mrShaderFilter.h>

#include "Graphics/IDisplayManager.h"

#define DD (.01f)

namespace {

	mrShaderFilter geomShaderFilter(imrShaderClassDesc::kApplyFlag_Geometry, static_cast<ParamType2>(TYPE_MAX_TYPE), false);

	void MakeQuad(Face *f, int a, int b , int c , int d, int sg) {
		f[0].setVerts( a, b, c);
		f[0].setSmGroup(sg);
		f[0].setEdgeVisFlags(1,1,0);
		f[1].setVerts( c, d, a);
		f[1].setSmGroup(sg);
		f[1].setEdgeVisFlags(1,1,0);
	}

}

//==============================================================================
// class mrGeomShaderObject_ClassDesc
//==============================================================================

class mrGeomShaderObject_ClassDesc : public ClassDesc2 {

public:

	mrGeomShaderObject_ClassDesc();

	int IsPublic();
	void* Create(BOOL loading);
	const TCHAR* ClassName();
	SClass_ID SuperClassID();
	Class_ID ClassID();
	const TCHAR* Category();
	const TCHAR* InternalName();
	HINSTANCE HInstance();    

private:
    
    // Prefernces change callback
    static void PreferencesChangeCallback(void* param);

    bool m_preferenceCallbackRegistered;
};

mrGeomShaderObject_ClassDesc::mrGeomShaderObject_ClassDesc()
: m_preferenceCallbackRegistered(false)
{

}

void mrGeomShaderObject_ClassDesc::PreferencesChangeCallback(void* param) {

    DbgAssert(param != NULL);
    mrGeomShaderObject_ClassDesc* classDesc = static_cast<mrGeomShaderObject_ClassDesc*>(param);
    
    ClassEntry* classEntry = GetCOREInterface()->GetDllDir().ClassDir().FindClassEntry(classDesc->SuperClassID(), classDesc->ClassID());
    DbgAssert(classEntry != NULL);
    if(classEntry != NULL) {
		// Delete the class and add it back. This updates the IsPublic state and
		// also updates the class list in the create panel
		GetCOREInterface()->DeleteClass(classDesc);
		GetCOREInterface()->AddClass(classDesc);

        // Update the 'isPublic' state of the class entry. Do this by completely
        // updating the class entry
        //classEntry->Set(classDesc, classEntry->DllNumber(), classEntry->ClassNumber(), classEntry->IsLoaded());
    }
}

int mrGeomShaderObject_ClassDesc::IsPublic() {

    imrPreferences* preferences = GetMRPreferences();
    DbgAssert(preferences != NULL);
    if(preferences != NULL) {

        // Register the preference change callback once
        if(!m_preferenceCallbackRegistered) {
            preferences->RegisterChangeCallback(PreferencesChangeCallback, this);
            m_preferenceCallbackRegistered = true;
        }
        
        // Public when the 'enable mental ray extensions' preference is ON
        return preferences->GetMRExtensionsActive();
    }
    else {
        return TRUE;
    }
}

void* mrGeomShaderObject_ClassDesc::Create(BOOL loading) {

    return new mrGeomShaderObject(loading != 0);
}

const TCHAR* mrGeomShaderObject_ClassDesc::ClassName() {

    return GetString(IDS_MRGEOMETRYOBJECT_CLASSNAME);
}

SClass_ID mrGeomShaderObject_ClassDesc::SuperClassID() {

    return GEOMOBJECT_CLASS_ID;
}

Class_ID mrGeomShaderObject_ClassDesc::ClassID() {

    return MRGEOMETRYOBJECT_CLASS_ID;
}

const TCHAR* mrGeomShaderObject_ClassDesc::Category() {

    return _T("mental ray");
}

const TCHAR* mrGeomShaderObject_ClassDesc::InternalName() {

    return _T("mental ray Geometry Shader");
}

HINSTANCE mrGeomShaderObject_ClassDesc::HInstance() {

    extern HINSTANCE hInstance;
    return hInstance;
}
 
//==============================================================================
// class mrGeomShaderObject_CreateCallback
//
// The mouse creation callback for the mental ray geometry object.
//==============================================================================

class mrGeomShaderObject_CreateCallback : public CreateMouseCallBack {

public:

    static mrGeomShaderObject_CreateCallback& GetInstance() { return m_theInstance; };

    void SetObject(mrGeomShaderObject* object) { m_object = object; }

    // -- from CreateMouseCallBack
    int proc(ViewExp *vpt,int msg, int point, int flags, IPoint2 m, Matrix3& mat);

private:

    static mrGeomShaderObject_CreateCallback m_theInstance;

    mrGeomShaderObject_CreateCallback();

    // The current object
    mrGeomShaderObject* m_object;

    // The initial point & snap point
    Point3 m_point;
    IPoint2 m_snapPoint;  
};

mrGeomShaderObject_CreateCallback mrGeomShaderObject_CreateCallback::m_theInstance;

mrGeomShaderObject_CreateCallback::mrGeomShaderObject_CreateCallback() 
: m_object(NULL)
{

}

int mrGeomShaderObject_CreateCallback::proc(ViewExp *vpt,int msg, int point, int flags, IPoint2 m, Matrix3& mat) 
{
		if ( ! vpt || ! vpt->IsAlive() )
		{
			// why are we here
			DbgAssert(!_T("Doing proc() on invalid viewport!"));
			return FALSE;
		}
  
		DbgAssert(m_object != NULL);

    // Stole this code from DummyObjectCreateCallBack::proc(), see src\core\dummy.cpp

    switch(msg) {
    case MOUSE_FREEMOVE:
#ifdef _OSNAP
        vpt->SnapPreview(m, m, NULL, SNAP_IN_3D);
#endif
        break;

    case MOUSE_POINT:
    case MOUSE_MOVE:
        switch(point) {
        case 0:
            m_object->SetBox(Box3(Point3(-DD, -DD, -DD), Point3(DD, DD, DD)));
            m_object->SetCreating(true);
#ifdef _3D_CREATE
            m_point = vpt->SnapPoint(m, m, NULL, SNAP_IN_3D);
#else
            m_point = vpt->SnapPoint(m, m, NULL, SNAP_IN_PLANE);
#endif
            mat.SetTrans(m_point);
            m_snapPoint = m;
            m_object->InvalidateMesh();
            break;

        case 1:
            {
                float l;
#ifdef _OSNAP
                l = fabsf(vpt->SnapLength(vpt->GetCPDisp(m_point, Point3(0,0,1), m_snapPoint, m, TRUE)));
#else
                l = fabsf(vpt->SnapLength(vpt->GetCPDisp(m_point, Point3(0,0,1), m_snapPoint, m)));
#endif
                m_object->SetBox(Box3(Point3(-l, -l, -l), Point3(l, l, l)));
                m_object->InvalidateMesh();
                if(msg == MOUSE_POINT) {
                    m_object->SetCreating(false);
                    if(Length(m - m_snapPoint) < 4)
                        return CREATE_ABORT;
                    else
                        return CREATE_STOP;
                }
            }
            break;
        }
        break;

    case MOUSE_ABORT:
        m_object->SetCreating(false);
        return CREATE_ABORT;
    }

    return CREATE_CONTINUE;
}


//==============================================================================
// class mrGeomShaderObject
//==============================================================================

// The param block descriptor
ParamBlockDesc2 mrGeomShaderObject::m_mainPBDesc(
    kMainPBID, _T("Parameters"), IDS_PARAMETERS, &mrGeomShaderObject::GetClassDesc(), P_AUTO_CONSTRUCT | P_AUTO_UI, kRef_MainPB,

    // Rollup
	IDD_MRGEOMETRYOBJECT, IDS_PARAMETERS, 0, 0, &UserDlgProc::GetInstance(),
    
    // Parameters
    kMainPBParam_Shader, _T("Shader"), TYPE_TEXMAP, P_SUBANIM, IDS_SHADER,
        //p_ui, TYPE_TEXMAPBUTTON, IDC_BUTTON_SHADER,
        p_validator, static_cast<PBValidator*>(&geomShaderFilter),
        p_end,

    kMainPBParam_Wireframe, _T("Wireframe"), TYPE_BOOL, 0, IDS_WIREFRAME,
        p_ui, TYPE_SINGLECHEKBOX, IDC_CHECK_WIREFRAME,
        p_default, TRUE,
        p_end,

    p_end      
);


ClassDesc2& mrGeomShaderObject::GetClassDesc() {

    static mrGeomShaderObject_ClassDesc classDesc;
    return classDesc;
}

mrGeomShaderObject::mrGeomShaderObject(bool loading) 
: m_mainPB(NULL),
  m_creating(false)
{

    if(!loading)
        GetClassDesc().MakeAutoParamBlocks(this);
}

mrGeomShaderObject::~mrGeomShaderObject() {

    DeleteAllRefs();
}

void mrGeomShaderObject::DeleteThis() {

    delete this;
}

void mrGeomShaderObject::UpdateMesh(TimeValue t) {

    if(!m_meshValid.InInterval(t)) {
        BuildMesh(t);
    }
}

bool mrGeomShaderObject::DisplayAsWireframe() {

    if(m_mainPB != NULL) {
        return (m_mainPB->GetInt(kMainPBParam_Wireframe) != 0);
    }

    return false;
}

void mrGeomShaderObject::SetGeomShader(Texmap* shader) {

	DbgAssert(m_mainPB != NULL);
    if(m_mainPB != NULL) {
		m_mainPB->SetValue(kMainPBParam_Shader, 0, shader);
    }
}

Texmap* mrGeomShaderObject::GetGeomShaderAsTexmap() {

    if(m_mainPB != NULL) {
        Texmap* texmap = m_mainPB->GetTexmap(kMainPBParam_Shader);
		return texmap;
    }
	else {
		DbgAssert(false);
		return NULL;
	}
}

void mrGeomShaderObject::BuildMesh(TimeValue t) {

    // Stole this from DummyObject::BuildMesh()
	int nverts = 8;
	int nfaces = 12;
	Point3 va = m_box.pmin;
	Point3 vb = m_box.pmax;
	if(m_box.IsEmpty()) {
    	va = Point3(-DD, -DD, -DD);
		vb = Point3( DD,  DD,  DD);
    }

	m_mesh.setNumVerts(nverts);
	m_mesh.setNumFaces(nfaces);

	m_mesh.setVert(0, Point3( va.x, va.y, va.z));
	m_mesh.setVert(1, Point3( vb.x, va.y, va.z));
	m_mesh.setVert(2, Point3( va.x, vb.y, va.z));
	m_mesh.setVert(3, Point3( vb.x, vb.y, va.z));
	m_mesh.setVert(4, Point3( va.x, va.y, vb.z));
	m_mesh.setVert(5, Point3( vb.x, va.y, vb.z));
	m_mesh.setVert(6, Point3( va.x, vb.y, vb.z));
	m_mesh.setVert(7, Point3( vb.x, vb.y, vb.z));

	MakeQuad(&(m_mesh.faces[ 0]), 0,2,3,1,  1);
	MakeQuad(&(m_mesh.faces[ 2]), 2,0,4,6,  2);
	MakeQuad(&(m_mesh.faces[ 4]), 3,2,6,7,  4);
	MakeQuad(&(m_mesh.faces[ 6]), 1,3,7,5,  8);
	MakeQuad(&(m_mesh.faces[ 8]), 0,1,5,4, 16);
	MakeQuad(&(m_mesh.faces[10]), 4,5,7,6, 32);
	m_mesh.InvalidateGeomCache();
	m_mesh.EnableEdgeList(1);

    m_meshValid.SetInfinite();
}

int mrGeomShaderObject::Display(TimeValue t, INode* inode, ViewExp *vpt, int flags) {

	if ( ! vpt || ! vpt->IsAlive() )
	{
		// why are we here
		DbgAssert(!_T("Doing Display() on invalid viewport!"));
		return FALSE;
	}

	if (MaxSDK::Graphics::IsRetainedModeEnabled())
	{
		return 0;
	}

    GraphicsWindow *gw = vpt->getGW();
    DWORD rlim = gw->getRndLimits();

    Matrix3 mat = inode->GetObjectTM(t);
    gw->setTransform(mat);

    UpdateMesh(t);

    if(DisplayAsWireframe()) {
        gw->setRndLimits(GW_WIREFRAME|GW_EDGES_ONLY|GW_BACKCULL);

        if (inode->Selected())  {
		    gw->setColor( LINE_COLOR, GetSelColor());
        }
        else if(!inode->IsFrozen() && !inode->Dependent()) {
            Color color(inode->GetWireColor());
		    gw->setColor( LINE_COLOR, color.r, color.g, color.b);
        }
    }
    
    m_mesh.render(gw, inode->Mtls(), NULL, COMP_ALL, inode->NumMtls());

    gw->setRndLimits(rlim);

    return 0;
}

// from IDisplay
unsigned long mrGeomShaderObject::GetObjectDisplayRequirement() const
{
	return 0;
}

bool mrGeomShaderObject::PrepareDisplay(
					const MaxSDK::Graphics::UpdateDisplayContext& prepareDisplayContext)
{
	using namespace MaxSDK::Graphics;
	
	IMeshDisplay2* pMeshDisplay = static_cast<IMeshDisplay2*>(m_mesh.GetInterface(IMesh_DISPLAY2_INTERFACE_ID));
	if (NULL == pMeshDisplay)
	{
		return false;
	}
	// create a mesh to display (leave it in cache)
	UpdateMesh(prepareDisplayContext.GetDisplayTime());
	GenerateMeshRenderItemsContext generateRenderItemsContext;
	generateRenderItemsContext.GenerateDefaultContext(prepareDisplayContext);
	pMeshDisplay->PrepareDisplay(generateRenderItemsContext);

	return true;
}

bool mrGeomShaderObject::UpdatePerNodeItems(
						const MaxSDK::Graphics::UpdateDisplayContext& updateDisplayContext,
						MaxSDK::Graphics::UpdateNodeContext& nodeContext,
						MaxSDK::Graphics::IRenderItemContainer& targetRenderItemContainer)
{
	using namespace MaxSDK::Graphics;
	IMeshDisplay2* pMeshDisplay = static_cast<IMeshDisplay2*>(m_mesh.GetInterface(IMesh_DISPLAY2_INTERFACE_ID));
	if (NULL == pMeshDisplay)
	{
		return false;
	}
	// create a mesh to display (leave it in cache)
	UpdateMesh(updateDisplayContext.GetDisplayTime());
	GenerateMeshRenderItemsContext generateRenderItemsContext;
	generateRenderItemsContext.GenerateDefaultContext(updateDisplayContext);
	generateRenderItemsContext.RemoveInvisibleMeshElementDescriptions(nodeContext.GetRenderNode());
	pMeshDisplay->GetRenderItems(generateRenderItemsContext,nodeContext,targetRenderItemContainer);

	return true;
}

CreateMouseCallBack* mrGeomShaderObject::GetCreateMouseCallBack() {

    mrGeomShaderObject_CreateCallback& callback = mrGeomShaderObject_CreateCallback::GetInstance();
    callback.SetObject(this);
    return &callback;
}

void mrGeomShaderObject::RescaleWorldUnits(float f) {

	if (TestAFlag(A_WORK1))
		return;
	SetAFlag(A_WORK1);   

    m_box.pmin *= f;
    m_box.pmax *= f;

    NotifyDependents(FOREVER,PART_ALL,REFMSG_CHANGE);
}

IOResult mrGeomShaderObject::Save(ISave *isave) {

    ULONG nBytes;
    IOResult res;

    isave->BeginChunk(kChunk_Box);
    res = isave->Write(&m_box, sizeof(m_box), &nBytes);
    isave->EndChunk();

    return res;
}

IOResult mrGeomShaderObject::Load(ILoad *iload) {

    ULONG nBytes;
    IOResult res = IO_OK;

    while(iload->OpenChunk() == IO_OK) {
        switch(iload->CurChunkID()) {
        case kChunk_Box:
            res = iload->Read(&m_box, sizeof(m_box), &nBytes);
            break;
        }

        iload->CloseChunk();
        if(res != IO_OK)
            return res;
    }

    return IO_OK;
}

ReferenceTarget* mrGeomShaderObject::GetGeomShader() {

    return GetGeomShaderAsTexmap();
}

void mrGeomShaderObject::BeginEditParams(IObjParam *ip, ULONG flags,Animatable *prev) {

    ClassDesc2& classDesc = GetClassDesc();

    classDesc.BeginEditParams(ip, this, flags, prev);
}

void mrGeomShaderObject::EndEditParams(IObjParam *ip, ULONG flags,Animatable *nex) {

    ClassDesc2& classDesc = GetClassDesc();

    classDesc.EndEditParams(ip, this, flags, nex);
}

int mrGeomShaderObject::IntersectRay(TimeValue t, Ray& ray, float& at, Point3& norm) {

    UpdateMesh(t);
    return m_mesh.IntersectRay(ray, at, norm);
}

void mrGeomShaderObject::GetWorldBoundBox(TimeValue t, INode* inode, ViewExp* /*vpt*/, Box3& box ) {

	Matrix3 mat = inode->GetObjectTM(t);
	UpdateMesh(t);
	box = m_mesh.getBoundingBox();
	box = box * mat;
}

void mrGeomShaderObject::GetLocalBoundBox(TimeValue t, INode* inode, ViewExp* /*vpt*/, Box3& box ) {

    UpdateMesh(t);
    box = m_mesh.getBoundingBox();
}

void mrGeomShaderObject::GetDeformBBox(TimeValue t, Box3& box, Matrix3 *tm, BOOL useSel ) {

    UpdateMesh(t);
    box = m_mesh.getBoundingBox(tm);
}

Mesh* mrGeomShaderObject::GetRenderMesh(TimeValue t, INode *inode, View &view, BOOL& needDelete) {

    needDelete = FALSE;

    UpdateMesh(t);
    return &m_mesh;
}

Interval mrGeomShaderObject::ObjectValidity(TimeValue t) {

    return FOREVER;
}

int mrGeomShaderObject::HitTest(TimeValue t, INode* inode, int type, int crossing, int flags, IPoint2 *p, ViewExp *vpt) {

	if (MaxSDK::Graphics::IsHardwareHitTesting(vpt))
	{
		return 0;
	}

    if ( ! vpt || ! vpt->IsAlive() )
		{
			// why are we here
			DbgAssert(!_T("Doing Display() on invalid viewport!"));
			return FALSE;
		}
	
		GraphicsWindow* gw = vpt->getGW();
    DWORD rlim = gw->getRndLimits();

    if(DisplayAsWireframe()) {
        gw->setRndLimits(GW_WIREFRAME|GW_EDGES_ONLY|GW_BACKCULL);
    }

    HitRegion hitRegion;
    MakeHitRegion(hitRegion, type, crossing, 4, p);
    Matrix3 tm = inode->GetObjectTM(t);

    gw->setTransform(tm);
    UpdateMesh(t);

    int res = m_mesh.select(gw, inode->Mtls(), &hitRegion, (flags & HIT_ABORTONHIT), inode->NumMtls());

    gw->setRndLimits(rlim);

    return res;
}

void mrGeomShaderObject::Snap(TimeValue t, INode* inode, SnapInfo *snap, IPoint2 *p, ViewExp *vpt) {

  if ( ! vpt || ! vpt->IsAlive() )
	{
		// why are we here
		DbgAssert(!_T("Doing Snap() on invalid viewport!"));
		return;
	}

	// Don't snap while creating
  if(m_creating)
      return;

	Matrix3 tm = inode->GetObjectTM(t);	
	GraphicsWindow *gw = vpt->getGW();	
	gw->setTransform(tm);

	UpdateMesh(t);
	m_mesh.snap( gw, snap, p, tm );    
}

const TCHAR* mrGeomShaderObject::GetObjectName() {

    return GetString(IDS_MRGEOMETRY_OBJECTNAME);
}

RefResult mrGeomShaderObject::NotifyRefChanged(const Interval& changeInt, RefTargetHandle hTarget, PartID& partID, RefMessage message, BOOL propagate) {

    return REF_SUCCEED;
}

int mrGeomShaderObject::NumRefs() {

    return kNumRefs;
}

RefTargetHandle mrGeomShaderObject::GetReference(int i) {

    switch(i) {
    case kRef_MainPB:
        return m_mainPB;
    default:
        return NULL;
    }
}

void mrGeomShaderObject::SetReference(int i, RefTargetHandle rtarg) {

    switch(i) {
    case kRef_MainPB:
        DbgAssert((rtarg == NULL) || (rtarg->SuperClassID() == PARAMETER_BLOCK2_CLASS_ID));
        m_mainPB = static_cast<IParamBlock2*>(rtarg);
        break;
    }
}

RefTargetHandle mrGeomShaderObject::Clone(RemapDir &remap) {

    mrGeomShaderObject* newObject = new mrGeomShaderObject(true);

    int count = NumRefs();
    for(int i = 0; i < count; ++i) {
        ReferenceTarget* refTarg = GetReference(i);
        newObject->ReplaceReference(i, remap.CloneRef(refTarg));
    }

    newObject->m_box = m_box;
    newObject->m_mesh = m_mesh;
    newObject->m_meshValid = m_meshValid;
    newObject->m_creating = m_creating;

	BaseClone(this, newObject, remap);
    return newObject;
}

int mrGeomShaderObject::NumParamBlocks() {

    return 1;
}

IParamBlock2* mrGeomShaderObject::GetParamBlock(int i) {

    return m_mainPB;
}

IParamBlock2* mrGeomShaderObject::GetParamBlockByID(short id) {

    return m_mainPB;
}

void mrGeomShaderObject::FreeCaches() {

    m_meshValid.SetEmpty();
    m_mesh.FreeAll();
}

void mrGeomShaderObject::GetClassName(TSTR& s) {

    s = GetString(IDS_MRGEOMETRYOBJECT_CLASSNAME);
}

SClass_ID mrGeomShaderObject::SuperClassID() {

    return GEOMOBJECT_CLASS_ID;
}

Class_ID mrGeomShaderObject::ClassID() {

    return MRGEOMETRYOBJECT_CLASS_ID;
}

ObjectState mrGeomShaderObject::Eval(TimeValue t) {

    UpdateMesh(t);
    return ObjectState(this);
}

BaseInterface* mrGeomShaderObject::GetInterface(Interface_ID id) {

	if(id == IMRGEOMSHADERTRANSLATION_INTERFACE_ID) {
		return static_cast<imrGeomShaderTranslation*>(this);
	}
	else {
		return GeomObject::GetInterface(id);
	}
}

//==============================================================================
// class mrGeomShaderObject::UserDlgProc
//==============================================================================

mrGeomShaderObject::UserDlgProc::UserDlgProc() 
: m_theObject(NULL)
{
	m_geomShaderButtonHandler.SetUserDlgProc(*this);
}

mrGeomShaderObject::UserDlgProc::~UserDlgProc() {

}

mrGeomShaderObject::UserDlgProc& mrGeomShaderObject::UserDlgProc::GetInstance() {

	static UserDlgProc theInstance;
	return theInstance;
}

void mrGeomShaderObject::UserDlgProc::SetGeomShader(Texmap* shader) {

	if(m_theObject != NULL) {
		m_theObject->SetGeomShader(shader);
	}
	else {
		DbgAssert(false);
	}
}

Texmap* mrGeomShaderObject::UserDlgProc::GetGeomShader() {

	if(m_theObject != NULL) {
		return m_theObject->GetGeomShaderAsTexmap();
	}
	else {
		DbgAssert(false);
		return NULL;
	}
}

void mrGeomShaderObject::GetScale(Point3& scale) {

	// Scale by the size of the bounding box
	scale = Point3((m_box.pmax.x - m_box.pmin.x), (m_box.pmax.y - m_box.pmin.y), (m_box.pmax.z - m_box.pmin.z));
}

INT_PTR mrGeomShaderObject::UserDlgProc::DlgProc(TimeValue t, IParamMap2 *map, HWND hWnd, UINT msg, WPARAM wParam, LPARAM lParam) {

	SetThingToOwner(map);
	m_geomShaderButtonHandler.OnInitDialog(hWnd);

	switch(msg) {
	case WM_INITDIALOG:
		break;

	case WM_COMMAND:
		switch(LOWORD(wParam)) {
		case IDC_BUTTON_SHADER:
			if(HIWORD(wParam) == BN_CLICKED) {
				m_geomShaderButtonHandler.OnCommand();
			}
			else {
				return FALSE;
			}
			break;
		default:
			return FALSE;
		}
		break;

	case WM_CLOSE:
		m_geomShaderButtonHandler.OnClose();
		SetThing(NULL);
		break;

	default:
		return FALSE;
	}

	return TRUE;

}

void mrGeomShaderObject::UserDlgProc::DeleteThis() {

	// Do nothing - a single static instance ever exists
}

void mrGeomShaderObject::UserDlgProc::Update(TimeValue t, Interval& valid, IParamMap2* pmap) {

	SetThingToOwner(pmap);

	HWND hWnd = pmap->GetHWnd();
	if(hWnd != NULL) {
		m_geomShaderButtonHandler.OnInitDialog(hWnd);
		m_geomShaderButtonHandler.Update();
	}
}

void mrGeomShaderObject::UserDlgProc::SetThing(ReferenceTarget *m) {

	ReferenceMaker* owner = m;
	if((owner == NULL) || ((owner->SuperClassID() == GEOMOBJECT_CLASS_ID) && (owner->ClassID() == MRGEOMETRYOBJECT_CLASS_ID))) {
		m_theObject = static_cast<mrGeomShaderObject*>(owner);
	}
	else {
		DbgAssert(false);
		m_theObject = NULL;
	}
}

void mrGeomShaderObject::UserDlgProc::SetThingToOwner(IParamMap2 *map) {

	if(map != NULL) {
		ReferenceMaker* owner = map->GetParamBlock()->GetOwner();
		if(owner->IsRefTarget()) {
			SetThing(static_cast<ReferenceTarget*>(owner));
		}
		else {
			DbgAssert(false);
			SetThing(NULL);
		}
	}
	else {
		SetThing(NULL);
	}
}

//==============================================================================
// class mrGeomShaderObject::UserDlgProc::GeomShaderButtonHandler
//==============================================================================

mrGeomShaderObject::UserDlgProc::GeomShaderButtonHandler::GeomShaderButtonHandler() 
: mrShaderButtonHandler(imrShaderClassDesc::kApplyFlag_Geometry, IDC_BUTTON_SHADER),
  m_userDlgProc(NULL)
{

}

mrGeomShaderObject::UserDlgProc::GeomShaderButtonHandler::~GeomShaderButtonHandler() {

}

void mrGeomShaderObject::UserDlgProc::GeomShaderButtonHandler::SetUserDlgProc(UserDlgProc& userDlgProc) {

	m_userDlgProc = &userDlgProc;
}

void mrGeomShaderObject::UserDlgProc::GeomShaderButtonHandler::SetShader(Texmap* shader) {

	if(m_userDlgProc != NULL) {
		m_userDlgProc->SetGeomShader(shader);
	}
	else {
		DbgAssert(false);
	}
}

Texmap* mrGeomShaderObject::UserDlgProc::GeomShaderButtonHandler::GetShader() {

	if(m_userDlgProc != NULL) {
		return m_userDlgProc->GetGeomShader();
	}
	else {
		DbgAssert(false);
		return NULL;
	}
}

const TCHAR* mrGeomShaderObject::UserDlgProc::GeomShaderButtonHandler::GetNoneString() {

	return GetString(IDS_NONE);
}



                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  /**********************************************************************
 *<
	FILE: relax.cpp

	DESCRIPTION:  Averages verts with nearby verts.

	CREATED BY: Steve Anderson

	HISTORY: created March 4, 1996

 *>	Copyright (c) 1996, All Rights Reserved.
 **********************************************************************/

#include "relaxmod.h"
#include "iparamm.h"

//--- Relax -----------------------------------------------------------

// Version info added for MAXr4, where we can now be applied to a PatchMesh and retain identity!
#define RELAXMOD_VER1 1
#define RELAXMOD_VER4 4

#define RELAXMOD_CURRENT_VERSION RELAXMOD_VER4

#define RELAX_OSM_CLASS_ID	100

#define MAX_ITER	999999999
#define MIN_ITER	0
#define MAX_RELAX	1.0f
#define MIN_RELAX	-1.0f
#define UIMIN_RELAX	0.0f

#define DEF_RELAX	0.5f
#define DEF_ITER	1
#define DEF_BOUNDARY	1
#define DEF_SADDLE 0

#define EPSILON float(1e-04)

typedef Tab<DWORD> DWordTab;

class RelaxModData : public LocalModData {
public:
	DWordTab *nbor;	// Array of neighbors for each vert.
	BitArray *vis;	// visibility of edges on path to neighbors.
	int *fnum;		// Number of faces for each vert.
	BitArray sel;		// Selection information.
	int vnum;		// Size of above arrays
	Interval ivalid;	// Validity interval of arrays.

	RelaxModData ();
	~RelaxModData () { Clear(); }
	void Clear();
	void SetVNum (int num);
	void MaybeAppendNeighbor(int vert, int index, int &max) {
		for (int k1=0; k1<max; k1++) {
			if (nbor[vert][k1] == index)
				return;
			}
		DWORD dwi = (DWORD)index;
		nbor[vert].Append (1, &dwi, 1);
		max++;
		}
	LocalModData *Clone ();
};

RelaxModData::RelaxModData () {
	nbor = NULL;
	vis = NULL;
	fnum = NULL;
	vnum = 0;
	ivalid = NEVER;
}

void RelaxModData::Clear () {
	if (nbor) delete [] nbor;
	nbor = NULL;
	if (vis) delete [] vis;
	vis = NULL;
	if (fnum) delete [] fnum;
	fnum = NULL;
}

void RelaxModData::SetVNum (int num) {
	if (num==vnum) return;
	Clear();
	vnum = num;
	if (num<1) return;
	nbor = new DWordTab[vnum];
	vis = new BitArray[vnum];
	fnum = new int[vnum];
	sel.SetSize (vnum);
}

LocalModData *RelaxModData::Clone () {
	RelaxModData *clone;
	clone = new RelaxModData ();
	clone->SetVNum (vnum);
	for (int i=0; i<vnum; i++) {
		clone->nbor[i] = nbor[i];
		clone->vis[i].SetSize (vis[i].GetSize());
		clone->vis[i] = vis[i];
	}
	memcpy (clone->fnum, fnum, vnum*sizeof(int));
	clone->sel = sel;
	clone->ivalid = ivalid;
	return clone;
}

class RelaxMod: public Modifier {
protected:
	IParamBlock *pblock;
	int version;

	static IObjParam *ip;
	
public:
	static IParamMap *pmapParam;
	static RelaxMod *editMod;

	// From Animatable
	void DeleteThis() { delete this; }
	void GetClassName(TSTR& s) { s= TSTR (GetString (IDS_RELAXMOD)); }  
	virtual Class_ID ClassID() { return Class_ID(RELAX_OSM_CLASS_ID,32670); }		
	RefTargetHandle Clone(RemapDir& remap);
	const TCHAR *GetObjectName() { return GetString (IDS_RELAX); }
	// IO
	IOResult Save(ISave *isave);
	IOResult Load(ILoad *iload);

	RelaxMod();
	virtual ~RelaxMod();

	ChannelMask ChannelsUsed()  { return GEOM_CHANNEL | TOPO_CHANNEL | SUBSEL_TYPE_CHANNEL | SELECT_CHANNEL; }
	ChannelMask ChannelsChanged() { return GEOM_CHANNEL | GFX_DATA_CHANNEL; }
	void ModifyObject(TimeValue t, ModContext &mc, ObjectState *os, INode *node);
	void NotifyInputChanged(const Interval& changeInt, PartID partID, RefMessage message, ModContext *mc);
	Class_ID InputType() { return defObjectClassID; }
	Interval LocalValidity(TimeValue t);

	// From BaseObject
	BOOL ChangeTopology() {return FALSE;}

	int NumRefs() {return 1;}
	RefTargetHandle GetReference(int i) {return pblock;}
private:
	virtual void SetReference(int i, RefTargetHandle rtarg) {pblock=(IParamBlock*)rtarg;}
public:

 	int NumSubs() { return 1; }  
	Animatable* SubAnim(int i) { return pblock; }
	TSTR SubAnimName(int i) { return TSTR(GetString(IDS_PARAMETERS));}		

	RefResult NotifyRefChanged( const Interval& changeInt,RefTargetHandle hTarget, 
	   PartID& partID, RefMessage message, BOOL propagate);

	CreateMouseCallBack* GetCreateMouseCallBack() {return NULL;} 

	void BeginEditParams(IObjParam *ip, ULONG flags,Animatable *prev);
	void EndEditParams(IObjParam *ip, ULONG flags,Animatable *next);

	void UpdateUI(TimeValue t) {}
	Interval GetValidity(TimeValue t);
	TSTR GetParameterName(int pbIndex);
};

class RelaxClassDesc:public ClassDesc {
	public:
	int 			IsPublic() { return 1; }
	void *			Create(BOOL loading = FALSE) { return new RelaxMod; }
	const TCHAR *	ClassName() { return GetString(IDS_RELAX); }
	SClass_ID		SuperClassID() { return OSM_CLASS_ID; }
	Class_ID		ClassID() { return  Class_ID(RELAX_OSM_CLASS_ID,32670); }
	const TCHAR* 	Category() { return GetString(IDS_CATEGORY); }
};

static RelaxClassDesc relaxDesc;
extern ClassDesc* GetRelaxModDesc() { return &relaxDesc; }

IObjParam*	RelaxMod::ip		= NULL;
IParamMap *	RelaxMod::pmapParam	= NULL;
RelaxMod *RelaxMod::editMod = NULL;

//--- Parameter map/block descriptors -------------------------------

#define PB_RELAX	0
#define PB_ITER		1
#define PB_BOUNDARY	2
#define PB_SADDLE 3

static ParamUIDesc descParam[] = {
	// Interp value
	ParamUIDesc (PB_RELAX, EDITTYPE_FLOAT, IDC_RELAX, IDC_RELAXSPIN,
		UIMIN_RELAX, MAX_RELAX, SPIN_AUTOSCALE),

	// Iterations
	ParamUIDesc(PB_ITER, EDITTYPE_POS_INT, IDC_ITER, IDC_ITERSPIN,
		(float) MIN_ITER, (float) MAX_ITER, 0.5f),
	
	ParamUIDesc (PB_BOUNDARY, TYPE_SINGLECHEKBOX, IDC_BOUNDARY),
	ParamUIDesc (PB_SADDLE, TYPE_SINGLECHEKBOX, IDC_SADDLE)
};

#define PARAMDESC_LENGTH 4

static ParamBlockDescID descVer0[] = {
	{ TYPE_FLOAT, NULL, TRUE,  PB_RELAX },
	{ TYPE_INT,   NULL, TRUE,  PB_ITER },
	{ TYPE_INT,   NULL, FALSE, PB_BOUNDARY }
};

static ParamBlockDescID descVer1[] = {
	{ TYPE_FLOAT, NULL, TRUE,  PB_RELAX },
	{ TYPE_INT,   NULL, TRUE,  PB_ITER },
	{ TYPE_INT,   NULL, FALSE, PB_BOUNDARY },
	{ TYPE_INT,   NULL, FALSE, PB_SADDLE }
};

#define PBLOCK_LENGTH	4

// Array of old versions
static ParamVersionDesc versions[] = {
	ParamVersionDesc(descVer0,3,0),
};
#define NUM_OLDVERSIONS	1

// Current version
#define CURRENT_VERSION	1
static ParamVersionDesc curVersion(descVer1,PBLOCK_LENGTH,CURRENT_VERSION);

RelaxMod::RelaxMod() {
	pblock = NULL;
	ReplaceReference(0, CreateParameterBlock(descVer1, PBLOCK_LENGTH, CURRENT_VERSION));
	pblock->SetValue (PB_RELAX,		TimeValue(0), DEF_RELAX);
	pblock->SetValue (PB_ITER,		TimeValue(0), DEF_ITER);
	pblock->SetValue (PB_BOUNDARY,	TimeValue(0), DEF_BOUNDARY);
	pblock->SetValue (PB_SADDLE,	TimeValue(0), DEF_SADDLE);
	version = RELAXMOD_CURRENT_VERSION;
}

RelaxMod::~RelaxMod() { }

Interval RelaxMod::LocalValidity(TimeValue t) {
	// if being edited, return NEVER forces a cache to be built 
	// after previous modifier.
	if (TestAFlag(A_MOD_BEING_EDITED)) return NEVER;  
	Interval valid = GetValidity(t);	
	return valid;
}

RefTargetHandle RelaxMod::Clone(RemapDir& remap) {
	RelaxMod* newmod = new RelaxMod();	
	newmod->ReplaceReference(0,remap.CloneRef(pblock));
	newmod->version = version;
	BaseClone(this, newmod, remap);
	return(newmod);
}

static void FindVertexAngles(PatchMesh &pm, float *vang) {
	int i;
	for (i=0; i<pm.numVerts + pm.numVecs; i++) vang[i] = 0.0f;
	for (i=0; i<pm.numPatches; i++) {
		Patch &p = pm.patches[i];
		for (int j=0; j<p.type; j++) {
			Point3 d1 = pm.vecs[p.vec[j*2]].p - pm.verts[p.v[j]].p;
			Point3 d2 = pm.vecs[p.vec[((j+p.type-1)%p.type)*2+1]].p - pm.verts[p.v[j]].p;
			float len = LengthSquared(d1);
			if (len == 0) continue;
			d1 /= Sqrt(len);
			len = LengthSquared (d2);
			if (len==0) continue;
			d2 /= Sqrt(len);
			float cs = DotProd (d1, d2);
			if (cs>=1) continue;	// angle of 0
			if (cs<=-1) vang[p.v[j]] += PI;
			else vang[p.v[j]] += (float) acos (cs);
		}
	}
}

static void FindVertexAngles (MNMesh &mm, float *vang) {
	int i;
	for (i=0; i<mm.numv; i++) vang[i] = 0.0f;
	for (i=0; i<mm.numf; i++) {
		int *vv = mm.f[i].vtx;
		int deg = mm.f[i].deg;
		for (int j=0; j<deg; j++) {
			Point3 d1 = mm.v[vv[(j+1)%deg]].p - mm.v[vv[j]].p;
			Point3 d2 = mm.v[vv[(j+deg-1)%deg]].p - mm.v[vv[j]].p;
			float len = LengthSquared(d1);
			if (len == 0) continue;
			d1 /= Sqrt(len);
			len = LengthSquared (d2);
			if (len==0) continue;
			d2 /= Sqrt(len);
			float cs = DotProd (d1, d2);
			// STEVE: What about angles over PI?
			if (cs>=1) continue;	// angle of 0
			if (cs<=-1) vang[vv[j]] += PI;
			else vang[vv[j]] += (float) acos (cs);
		}
	}
}

void RelaxMod::ModifyObject(TimeValue t, ModContext &mc, ObjectState * os, INode *node) {	
	// Get our personal validity interval...
	Interval valid = GetValidity(t);
	// and intersect it with the channels we use as input (see ChannelsUsed)
	valid &= os->obj->ChannelValidity (t, GEOM_CHAN_NUM);
	valid &= os->obj->ChannelValidity (t, TOPO_CHAN_NUM);
	valid &= os->obj->ChannelValidity (t, SUBSEL_TYPE_CHAN_NUM);
	valid &= os->obj->ChannelValidity (t, SELECT_CHAN_NUM);
	Matrix3 modmat,minv;
	
	if (mc.localData == NULL) mc.localData = new RelaxModData;
	RelaxModData *rd = (RelaxModData *) mc.localData;

	TriObject *triObj = NULL;
	PatchObject *patchObj = NULL;
	PolyObject *polyObj = NULL;
	BOOL converted = FALSE;

	// For version 4 and later, we process patch or poly meshes as they are and pass them on. 
	// Earlier versions converted to TriMeshes (done below).
	// For adding other new types of objects, add them here!
#ifndef NO_PATCHES
	if(version >= RELAXMOD_VER4 && os->obj->IsSubClassOf(patchObjectClassID)) {
		patchObj = (PatchObject *)os->obj;
		}
	else	// If it's a TriObject, process it
#endif // NO_PATCHES
	if(os->obj->IsSubClassOf(triObjectClassID)) {
		triObj = (TriObject *)os->obj;
	}
	else if (os->obj->IsSubClassOf (polyObjectClassID)) {
		polyObj = (PolyObject *) os->obj;
	}
	else	// If it can convert to a TriObject, do it
	if(os->obj->CanConvertToType(triObjectClassID)) {
		triObj = (TriObject *)os->obj->ConvertToType(t, triObjectClassID);
		converted = TRUE;
		}
	else
		return;		// We can't deal with it!

	Mesh *mesh = triObj ? &(triObj->GetMesh()) : NULL;
#ifndef NO_PATCHES
	PatchMesh &pmesh = patchObj ? patchObj->GetPatchMesh(t) : *((PatchMesh *)NULL);
#else
	PatchMesh &pmesh = *((PatchMesh *)NULL);
#endif // NO_PATCHES

	float relax, wtdRelax; // mjm - 4.8.99
	int iter;
	BOOL boundary, saddle;

	pblock->GetValue (PB_RELAX,  t, relax,	 FOREVER);
	pblock->GetValue (PB_ITER,	 t, iter,	 FOREVER);
	pblock->GetValue (PB_BOUNDARY, t, boundary, FOREVER);
	pblock->GetValue (PB_SADDLE, t, saddle, FOREVER);

	LimitValue (relax, MIN_RELAX, MAX_RELAX);
	LimitValue (iter, MIN_ITER, MAX_ITER);

	if(triObj) {
		int i, j, max;
		DWORD selLevel = mesh->selLevel;
		// mjm - 4.8.99 - add support for soft selection
		// sca - 4.29.99 - extended soft selection support to cover EDGE and FACE selection levels.
		float *vsw = (selLevel!=MESH_OBJECT) ? mesh->getVSelectionWeights() : NULL;

		if (rd->ivalid.InInterval(t) && (mesh->numVerts != rd->vnum)) {
			// Shouldn't happen, but does with Loft bug and may with other bugs.
			rd->ivalid.SetEmpty ();
		}

		if (!rd->ivalid.InInterval(t)) {
			rd->SetVNum (mesh->numVerts);
			for (i=0; i<rd->vnum; i++) {
				rd->fnum[i]=0;
				rd->nbor[i].ZeroCount();
			}
			rd->sel.ClearAll ();
			DWORD *v;
			int k1, k2, origmax;
			for (i=0; i<mesh->numFaces; i++) {
				v = mesh->faces[i].v;
				for (j=0; j<3; j++) {
					if ((selLevel==MESH_FACE) && mesh->faceSel[i]) rd->sel.Set(v[j]);
					if ((selLevel==MESH_EDGE) && mesh->edgeSel[i*3+j]) rd->sel.Set(v[j]);
					if ((selLevel==MESH_EDGE) && mesh->edgeSel[i*3+(j+2)%3]) rd->sel.Set(v[j]);
					origmax = max = rd->nbor[v[j]].Count();
					rd->fnum[v[j]]++;
					for (k1=0; k1<max; k1++) if (rd->nbor[v[j]][k1] == v[(j+1)%3]) break;
					if (k1==max) { rd->nbor[v[j]].Append (1, v+(j+1)%3, 1); max++; }
					for (k2=0; k2<max; k2++) if (rd->nbor[v[j]][k2] == v[(j+2)%3]) break;
					if (k2==max) { rd->nbor[v[j]].Append (1, v+(j+2)%3, 1); max++; }
					if (max>origmax) rd->vis[v[j]].SetSize (max, TRUE);
					if (mesh->faces[i].getEdgeVis (j)) rd->vis[v[j]].Set (k1);
					else if (k1>=origmax) rd->vis[v[j]].Clear (k1);
					if (mesh->faces[i].getEdgeVis ((j+2)%3)) rd->vis[v[j]].Set (k2);
					else if (k2>= origmax) rd->vis[v[j]].Clear (k2);
				}
			}
	// mjm - begin - 4.8.99
	//		if (selLevel==MESH_VERTEX) rd->sel = mesh->vertSel;
			if (selLevel==MESH_VERTEX)
				rd->sel = mesh->vertSel;
			else if (selLevel==MESH_OBJECT)
				rd->sel.SetAll ();
	// mjm - end
			rd->ivalid  = os->obj->ChannelValidity (t, TOPO_CHAN_NUM);
			rd->ivalid &= os->obj->ChannelValidity (t, SUBSEL_TYPE_CHAN_NUM);
			rd->ivalid &= os->obj->ChannelValidity (t, SELECT_CHAN_NUM);
		}

		Tab<float> vangles;
		if (saddle) vangles.SetCount (rd->vnum);
		Point3 *hold = new Point3[rd->vnum];
		int act;
		for (int k=0; k<iter; k++) {
			for (i=0; i<rd->vnum; i++) hold[i] = triObj->GetPoint(i);
			if (saddle) mesh->FindVertexAngles (vangles.Addr(0));
			for (i=0; i<rd->vnum; i++) {
	// mjm - begin - 4.8.99
	//			if ((selLevel!=MESH_OBJECT) && (!rd->sel[i])) continue;
				if ( (!rd->sel[i] ) && (!vsw || vsw[i] == 0) ) continue;
	// mjm - end
				if (saddle && (vangles[i] <= 2*PI*.99999f)) continue;
				max = rd->nbor[i].Count();
				if (boundary && (rd->fnum[i] < max)) continue;
				if (max<1) continue;
				Point3 avg(0.0f, 0.0f, 0.0f);
				for (j=0,act=0; j<max; j++) {
					if (!rd->vis[i][j]) continue;
					act++;
					avg += hold[rd->nbor[i][j]];
				}
				if (act<1) continue;
	// mjm - begin - 4.8.99
				wtdRelax = (!rd->sel[i]) ? relax * vsw[i] : relax;
				triObj->SetPoint (i, hold[i]*(1-wtdRelax) + avg*wtdRelax/((float)act));
	//			triObj->SetPoint (i, hold[i]*(1-relax) + avg*relax/((float)act));
	// mjm - end
			}
		}
		delete [] hold;
	}

	if (polyObj) {
		int i, j, max;
		MNMesh & mm = polyObj->mm;
		float *vsw = (mm.selLevel!=MNM_SL_OBJECT) ? mm.getVSelectionWeights() : NULL;

		if (rd->ivalid.InInterval(t) && (mm.numv != rd->vnum)) {
			// Shouldn't happen, but does with Loft bug and may with other bugs.
			rd->ivalid.SetEmpty ();
		}

		if (!rd->ivalid.InInterval(t)) {
			rd->SetVNum (mm.numv);
			for (i=0; i<rd->vnum; i++) {
				rd->fnum[i]=0;
				rd->nbor[i].ZeroCount();
			}
			rd->sel = mm.VertexTempSel ();
			int k1, k2, origmax;
			for (i=0; i<mm.numf; i++) {
				int deg = mm.f[i].deg;
				int *vtx = mm.f[i].vtx;
				for (j=0; j<deg; j++) {
					Tab<DWORD> & nbor = rd->nbor[vtx[j]];
					origmax = max = nbor.Count();
					rd->fnum[vtx[j]]++;
					DWORD va = vtx[(j+1)%deg];
					DWORD vb = vtx[(j+deg-1)%deg];
					for (k1=0; k1<max; k1++) if (nbor[k1] == va) break;
					if (k1==max) { nbor.Append (1, &va, 1); max++; }
					for (k2=0; k2<max; k2++) if (nbor[k2] == vb) break;
					if (k2==max) { nbor.Append (1, &vb, 1); max++; }
				}
			}
			rd->ivalid = os->obj->ChannelValidity (t, TOPO_CHAN_NUM);
			rd->ivalid &= os->obj->ChannelValidity (t, SUBSEL_TYPE_CHAN_NUM);
			rd->ivalid &= os->obj->ChannelValidity (t, SELECT_CHAN_NUM);
		}

		Tab<float> vangles;
		if (saddle) vangles.SetCount (rd->vnum);
		Tab<Point3> hold;
		hold.SetCount (rd->vnum);
		int act;
		for (int k=0; k<iter; k++) {
			for (i=0; i<rd->vnum; i++) hold[i] = mm.P(i);
			if (saddle) FindVertexAngles (mm, vangles.Addr(0));
			for (i=0; i<rd->vnum; i++) {
				if ((!rd->sel[i]) && (!vsw || vsw[i] == 0) ) continue;
				if (saddle && (vangles[i] <= 2*PI*.99999f)) continue;
				max = rd->nbor[i].Count();
				if (boundary && (rd->fnum[i] < max)) continue;
				if (max<1) continue;
				Point3 avg(0.0f, 0.0f, 0.0f);
				for (j=0,act=0; j<max; j++) {
					act++;
					avg += hold[rd->nbor[i][j]];
				}
				if (act<1) continue;
				wtdRelax = (!rd->sel[i]) ? relax * vsw[i] : relax;
				polyObj->SetPoint (i, hold[i]*(1-wtdRelax) + avg*wtdRelax/((float)act));
			}
		}
	}

#ifndef NO_PATCHES
	else
	if(patchObj) {
		int i, j, max;
		DWORD selLevel = pmesh.selLevel;
		// mjm - 4.8.99 - add support for soft selection
		// sca - 4.29.99 - extended soft selection support to cover EDGE and FACE selection levels.
		float *vsw = (selLevel!=PATCH_OBJECT) ? pmesh.GetVSelectionWeights() : NULL;

		if (rd->ivalid.InInterval(t) && (pmesh.numVerts != rd->vnum)) {
			// Shouldn't happen, but does with Loft bug and may with other bugs.
			rd->ivalid.SetEmpty ();
		}

		if (!rd->ivalid.InInterval(t)) {
			int vecBase = pmesh.numVerts;
			rd->SetVNum (pmesh.numVerts + pmesh.numVecs);
			for (i=0; i<rd->vnum; i++) {
				rd->fnum[i]=1;		// For patches, this means it's not a boundary
				rd->nbor[i].ZeroCount();
			}
			rd->sel.ClearAll ();
			for (i=0; i<pmesh.numPatches; i++) {
				Patch &p = pmesh.patches[i];
				int vecLimit = p.type * 2;
				for (j=0; j<p.type; j++) {
					PatchEdge &e = pmesh.edges[p.edge[j]];
					BOOL isBoundary = (e.patches.Count() < 2) ? TRUE : FALSE;
					int theVert = p.v[j];
					int nextVert = p.v[(j+1)%p.type];
					int nextVec = p.vec[j*2] + vecBase;
					int nextVec2 = p.vec[j*2+1] + vecBase;
					int prevEdge = (j+p.type-1)%p.type;
					int prevVec = p.vec[prevEdge*2+1] + vecBase;
					int prevVec2 = p.vec[prevEdge*2] + vecBase;
					int theInterior = p.interior[j] + vecBase;
					// Establish selection bits
					if ((selLevel==PATCH_PATCH) && pmesh.patchSel[i]) {
						rd->sel.Set(theVert);
						rd->sel.Set(nextVec);
						rd->sel.Set(prevVec);
						rd->sel.Set(theInterior);
						}
					else
					if ((selLevel==PATCH_EDGE) && pmesh.edgeSel[p.edge[j]]) {
						rd->sel.Set(e.v1);
						rd->sel.Set(e.vec12 + vecBase);
						rd->sel.Set(e.vec21 + vecBase);
						rd->sel.Set(e.v2);
						}
					else
					if ((selLevel==PATCH_VERTEX) && pmesh.vertSel[theVert]) {
						rd->sel.Set(theVert);
						rd->sel.Set(nextVec);
						rd->sel.Set(prevVec);
						rd->sel.Set(theInterior);
						}

					// Set boundary flags if necessary
					if(isBoundary) {
						rd->fnum[theVert] = 0;
						rd->fnum[nextVec] = 0;
						rd->fnum[nextVec2] = 0;
						rd->fnum[nextVert] = 0;
						}

					// First process the verts
					int work = theVert;
					max = rd->nbor[work].Count();
					// Append the neighboring vectors
					rd->MaybeAppendNeighbor(work, nextVec, max);
					rd->MaybeAppendNeighbor(work, prevVec, max);
					rd->MaybeAppendNeighbor(work, theInterior, max);

					// Now process the edge vectors
					work = nextVec;
					max = rd->nbor[work].Count();
					// Append the neighboring points
					rd->MaybeAppendNeighbor(work, theVert, max);
					rd->MaybeAppendNeighbor(work, theInterior, max);
					rd->MaybeAppendNeighbor(work, prevVec, max);
					rd->MaybeAppendNeighbor(work, nextVec2, max);
					rd->MaybeAppendNeighbor(work, p.interior[(j+1)%p.type] + vecBase, max);

					work = prevVec;
					max = rd->nbor[work].Count();
					// Append the neighboring points
					rd->MaybeAppendNeighbor(work, theVert, max);
					rd->MaybeAppendNeighbor(work, theInterior, max);
					rd->MaybeAppendNeighbor(work, nextVec, max);
					rd->MaybeAppendNeighbor(work, prevVec2, max);
					rd->MaybeAppendNeighbor(work, p.interior[(j+p.type-1)%p.type] + vecBase, max);

					// Now append the interior, if not auto
					if(!p.IsAuto()) {
						work = theInterior;
						max = rd->nbor[work].Count();
						// Append the neighboring points
						rd->MaybeAppendNeighbor(work, p.v[j], max);
						rd->MaybeAppendNeighbor(work, nextVec, max);
						rd->MaybeAppendNeighbor(work, nextVec2, max);
						rd->MaybeAppendNeighbor(work, prevVec, max);
						rd->MaybeAppendNeighbor(work, prevVec2, max);
						for(int k = 1; k < p.type; ++k)
							rd->MaybeAppendNeighbor(work, p.interior[(j+k)%p.type] + vecBase, max);
						}
					}
				}
	// mjm - begin - 4.8.99
			if (selLevel==PATCH_VERTEX) {
				for (int i=0; i<pmesh.numVerts; ++i) {
					if (pmesh.vertSel[i]) rd->sel.Set(i);
				}
			}
			else if (selLevel==PATCH_OBJECT) rd->sel.SetAll();
	// mjm - end
			rd->ivalid  = os->obj->ChannelValidity (t, TOPO_CHAN_NUM);
			rd->ivalid &= os->obj->ChannelValidity (t, SUBSEL_TYPE_CHAN_NUM);
			rd->ivalid &= os->obj->ChannelValidity (t, SELECT_CHAN_NUM);
		}

		Tab<float> vangles;
		if (saddle) vangles.SetCount (rd->vnum);
		Point3 *hold = new Point3[rd->vnum];
		int act;
		for (int k=0; k<iter; k++) {
			for (i=0; i<rd->vnum; i++) hold[i] = patchObj->GetPoint(i);
			if (saddle)
				FindVertexAngles(pmesh, vangles.Addr(0));
			for (i=0; i<rd->vnum; i++) {
	// mjm - begin - 4.8.99
	//			if ((selLevel!=MESH_OBJECT) && (!rd->sel[i])) continue;
				if ( (!rd->sel[i] ) && (!vsw || vsw[i] == 0) ) continue;
	// mjm - end
				if (saddle && (i < pmesh.numVerts) && (vangles[i] <= 2*PI*.99999f)) continue;
				max = rd->nbor[i].Count();
				if (boundary && !rd->fnum[i]) continue;
				if (max<1)
					continue;
				Point3 avg(0.0f, 0.0f, 0.0f);
				for (j=0,act=0; j<max; j++) {
					act++;
					avg += hold[rd->nbor[i][j]];
				}
				if (act<1)
					continue;
	// mjm - begin - 4.8.99
				wtdRelax = (!rd->sel[i]) ? relax * vsw[i] : relax;
				patchObj->SetPoint (i, hold[i]*(1-wtdRelax) + avg*wtdRelax/((float)act));
	//			patchObj->SetPoint (i, hold[i]*(1-relax) + avg*relax/((float)act));
	// mjm - end
			}
		}
		delete [] hold;
		patchObj->patch.computeInteriors();
		patchObj->patch.ApplyConstraints();
	}
#endif // NO_PATCHES
	
	if(!converted) {
		os->obj->SetChannelValidity(GEOM_CHAN_NUM, valid);
	} else {
		// Stuff converted object into the pipeline!
		triObj->SetChannelValidity(TOPO_CHAN_NUM, valid);
		triObj->SetChannelValidity(GEOM_CHAN_NUM, valid);
		triObj->SetChannelValidity(TEXMAP_CHAN_NUM, valid);
		triObj->SetChannelValidity(MTL_CHAN_NUM, valid);
		triObj->SetChannelValidity(SELECT_CHAN_NUM, valid);
		triObj->SetChannelValidity(SUBSEL_TYPE_CHAN_NUM, valid);
		triObj->SetChannelValidity(DISP_ATTRIB_CHAN_NUM, valid);

		os->obj = triObj;
	}
}

void RelaxMod::NotifyInputChanged (const Interval& changeInt, PartID part, RefMessage message, ModContext *mc) {
	if (!(part & (PART_TOPO|PART_SELECT|PART_SUBSEL_TYPE))) return;
	RelaxModData *rd = (RelaxModData *) mc->localData;
	if (rd == NULL) return;
	rd->ivalid = NEVER;
}

void RelaxMod::BeginEditParams( IObjParam *ip, ULONG flags,Animatable *prev ) {
	this->ip = ip;
	editMod = this;

	TimeValue t = ip->GetTime();
	NotifyDependents(Interval(t,t), PART_ALL, REFMSG_BEGIN_EDIT);
	NotifyDependents(Interval(t,t), PART_ALL, REFMSG_MOD_DISPLAY_ON);
	SetAFlag(A_MOD_BEING_EDITED);

	pmapParam = CreateCPParamMap(
		descParam,PARAMDESC_LENGTH,
		pblock,
		ip,
		hInstance,
		MAKEINTRESOURCE(IDD_RELAX),
		GetString (IDS_PARAMETERS),
		0);
}

void RelaxMod::EndEditParams( IObjParam *ip, ULONG flags,Animatable *next) {
	this->ip = NULL;
	editMod = NULL;
	
	TimeValue t = ip->GetTime();

	// aszabo|feb.05.02 This flag must be cleared before sending the REFMSG_END_EDIT
	ClearAFlag(A_MOD_BEING_EDITED);
	NotifyDependents(Interval(t,t), PART_ALL, REFMSG_END_EDIT);
	NotifyDependents(Interval(t,t), PART_ALL, REFMSG_MOD_DISPLAY_OFF);

	DestroyCPParamMap(pmapParam);
	pmapParam = NULL;
}

Interval RelaxMod::GetValidity(TimeValue t)	{
	int i;
	float f;
	// Only have to worry about animated parameters.
	Interval valid = FOREVER;
	pblock->GetValue (PB_RELAX, t, f, valid);
	pblock->GetValue (PB_ITER, t, i, valid);
	return valid;
}

RefResult RelaxMod::NotifyRefChanged(const Interval& changeInt, 
		RefTargetHandle hTarget, PartID& partID, 
		RefMessage message, 
		BOOL propagate ) 
   	{
	GetParamDim *gpd;
	GetParamName *gpn;
	switch (message) {
		case REFMSG_CHANGE:
			if (editMod==this && pmapParam) pmapParam->Invalidate();
			break;

		case REFMSG_GET_PARAM_DIM:
			gpd = (GetParamDim*)partID;			
			gpd->dim = defaultDim;
			return REF_HALT; 

		case REFMSG_GET_PARAM_NAME:
			gpn = (GetParamName*)partID;
			gpn->name = GetParameterName(gpn->index);			
			return REF_HALT; 
	}
	return(REF_SUCCEED);
}

TSTR RelaxMod::GetParameterName(int pbIndex) {
	switch (pbIndex) {
	case PB_RELAX:	return TSTR(GetString (IDS_RVALUE));
	case PB_ITER:	return TSTR(GetString (IDS_ITERATIONS));
	case PB_BOUNDARY:	return TSTR(GetString (IDS_BOUNDARY));
	default:		return TSTR(_T(""));
	}
}

#define VERSION_CHUNK	0x1000

IOResult RelaxMod::Save(ISave *isave) {
	ULONG nb;
	Modifier::Save(isave);
	isave->BeginChunk (VERSION_CHUNK);
	isave->Write (&version, sizeof(int), &nb);
	isave->EndChunk();
	return IO_OK;
	}

IOResult RelaxMod::Load(ILoad *iload) {
	Modifier::Load(iload);
	iload->RegisterPostLoadCallback(
		new ParamBlockPLCB(versions,NUM_OLDVERSIONS,&curVersion,this,0));
	IOResult res;
	ULONG nb;
	version = RELAXMOD_VER1;	// Set default version to old one
	while (IO_OK==(res=iload->OpenChunk())) {
		switch(iload->CurChunkID())  {
			case VERSION_CHUNK:
				res = iload->Read(&version,sizeof(int),&nb);
				break;
			}
		iload->CloseChunk();
		if (res!=IO_OK) 
			return res;
		}
	return IO_OK;
}

	
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     //Microsoft Developer Studio generated resource script.
//
#include "resource.h"

#define APSTUDIO_READONLY_SYMBOLS
/////////////////////////////////////////////////////////////////////////////
//
// Generated from the TEXTINCLUDE 2 resource.
//
#include "afxres.h"

/////////////////////////////////////////////////////////////////////////////
#undef APSTUDIO_READONLY_SYMBOLS

/////////////////////////////////////////////////////////////////////////////
// English (U.S.) resources

#if !defined(AFX_RESOURCE_DLL) || defined(AFX_TARG_ENU)
#ifdef _WIN32
LANGUAGE LANG_ENGLISH, SUBLANG_ENGLISH_US
#pragma code_page(1252)
#endif //_WIN32

/////////////////////////////////////////////////////////////////////////////
//
// Dialog
//

IDD_NURBS_API_TEST DIALOG DISCARDABLE  0, 0, 108, 166
STYLE WS_CHILD | WS_VISIBLE
FONT 8, "MS Sans Serif"
BEGIN
    PUSHBUTTON      "Combined Test",IDC_RUN_TEST,8,14,91,11
    PUSHBUTTON      "Point Tests",IDC_POINT_TEST,8,28,91,11
    PUSHBUTTON      "Curve Tests",IDC_CURVE_TEST,8,42,91,11
    PUSHBUTTON      "Surface Tests",IDC_SURF_TEST,8,56,91,11
    PUSHBUTTON      "Curve On Surface Tests",IDC_COS_TEST,8,71,91,11
    PUSHBUTTON      "Dump Selected",IDC_DUMP,6,108,95,11
    CONTROL         "To File:",IDC_FILE,"Button",BS_AUTOCHECKBOX | 
                    WS_TABSTOP,6,138,39,10
    EDITTEXT        IDC_FILENAME,17,149,84,14,ES_AUTOHSCROLL
    GROUPBOX        "Creation Test",IDC_STATIC,3,3,101,98
    CONTROL         "Relational",IDC_RELATIONAL,"Button",BS_AUTOCHECKBOX | 
                    WS_TABSTOP,6,124,47,10
    CONTROL         "As Curve Object",IDC_AS_CURVE,"Button",BS_AUTOCHECKBOX | 
                    WS_TABSTOP,20,88,67,10
END

IDD_SURF_DISPLAY DIALOG DISCARDABLE  0, 0, 108, 112
STYLE WS_CHILD | WS_VISIBLE
FONT 8, "MS Sans Serif"
BEGIN
    PUSHBUTTON      "Set Selected",IDC_SURF_DISPLAY,13,84,81,11
    PUSHBUTTON      "Reset",IDC_RESET,13,98,81,11
    CONTROL         "Lattices",IDC_DISPLATTICE,"Button",BS_AUTOCHECKBOX | 
                    WS_TABSTOP,9,14,41,10
    CONTROL         "Surfaces",IDC_DISP_SURFACE,"Button",BS_AUTOCHECKBOX | 
                    WS_TABSTOP,9,36,44,10
    GROUPBOX        "Display",-1,4,4,101,78
    CONTROL         "Dependents",IDC_DISP_DEP,"Button",BS_AUTOCHECKBOX | 
                    WS_TABSTOP,9,47,55,10
    CONTROL         "Curves",IDC_DISP_CURVE,"Button",BS_AUTOCHECKBOX | 
                    WS_TABSTOP,9,25,37,10
    CONTROL         "Surface Trims",IDC_DISP_TRIM,"Button",BS_AUTOCHECKBOX | 
                    WS_TABSTOP,9,58,59,10
    CONTROL         "Transform Degrade",IDC_DEGRADE,"Button",BS_AUTOCHECKBOX | 
                    WS_TABSTOP,9,70,77,10
END

IDD_SURF_APPROX_PARAMS DIALOG DISCARDABLE  0, 0, 121, 194
STYLE DS_MODALFRAME | WS_POPUP | WS_CAPTION | WS_SYSMENU
CAPTION "Approximation Parameters"
FONT 8, "MS Sans Serif"
BEGIN
    DEFPUSHBUTTON   "OK",IDOK,7,173,50,14
    PUSHBUTTON      "Cancel",IDCANCEL,64,173,50,14
    CONTROL         "Parametric",IDC_TESS_PARAM,"Button",BS_AUTORADIOBUTTON | 
                    WS_GROUP | WS_TABSTOP,11,15,49,10
    CONTROL         "",IDC_TESS_U,"CustEdit",WS_GROUP | WS_TABSTOP,57,25,36,
                    10
    CONTROL         "",IDC_TESS_V,"CustEdit",WS_TABSTOP,57,38,36,10
    CONTROL         "Spatial",IDC_TESS_SPATIAL,"Button",BS_AUTORADIOBUTTON | 
                    WS_TABSTOP,11,52,37,10
    CONTROL         "",IDC_TESS_EDGE,"CustEdit",WS_TABSTOP,57,84,36,10
    CONTROL         "Curvature",IDC_TESS_CURV,"Button",BS_AUTORADIOBUTTON | 
                    WS_TABSTOP,11,63,47,10
    CONTROL         "",IDC_TESS_DIST,"CustEdit",WS_TABSTOP,57,98,36,10
    CONTROL         "",IDC_TESS_ANG,"CustEdit",WS_TABSTOP,57,111,36,10
    CONTROL         "View-Dependent",IDC_TESS_VIEW_DEP,"Button",
                    BS_AUTOCHECKBOX | WS_TABSTOP,13,124,69,10
    CONTROL         "",IDC_TESS_U_SPINNER,"SpinnerControl",0x0,93,25,7,10
    CONTROL         "",IDC_TESS_V_SPINNER,"SpinnerControl",0x0,93,38,7,10
    CONTROL         "",IDC_TESS_EDGE_SPINNER,"SpinnerControl",0x0,93,84,7,10
    CONTROL         "",IDC_TESS_DIST_SPINNER,"SpinnerControl",0x0,93,98,7,10
    CONTROL         "",IDC_TESS_ANG_SPINNER,"SpinnerControl",0x0,93,111,7,10
    LTEXT           "U Steps:",IDC_STATIC,24,26,28,8
    LTEXT           "V Steps:",IDC_STATIC,24,38,28,8
    LTEXT           "Distance:",IDC_STATIC,24,98,31,8
    LTEXT           "Angle:",IDC_STATIC,24,110,21,8
    LTEXT           "Edge:",IDC_STATIC,24,84,20,8
    CONTROL         "",IDC_MERGE,"CustEdit",WS_TABSTOP,48,139,36,10
    CONTROL         "",IDC_MERGE_SPINNER,"SpinnerControl",0x0,84,139,7,10
    LTEXT           "Merge:",IDC_STATIC,13,139,23,8
    CONTROL         "Spatial and Curvature",IDC_TESS_LDA,"Button",
                    BS_AUTORADIOBUTTON | WS_TABSTOP,11,74,84,10
    PUSHBUTTON      "Advanced Parameters...",IDC_ADVANCED,15,156,81,11
    CONTROL         "Regular",IDC_TESS_REGULAR,"Button",BS_AUTORADIOBUTTON,
                    11,4,41,10
END

IDD_SURF_APPROX DIALOG DISCARDABLE  0, 0, 108, 400
STYLE WS_CHILD | WS_VISIBLE
FONT 8, "MS Sans Serif"
BEGIN
    CONTROL         "",IDC_ISO_U,"CustEdit",WS_GROUP | WS_TABSTOP,51,14,36,
                    10
    CONTROL         "",IDC_ISO_V,"CustEdit",WS_TABSTOP,51,27,36,10
    CONTROL         "Iso Only",IDC_ISO_ONLY,"Button",BS_AUTORADIOBUTTON | 
                    WS_GROUP | WS_TABSTOP,10,40,41,10
    CONTROL         "Iso And Mesh",IDC_ISO_AND_MESH,"Button",
                    BS_AUTORADIOBUTTON | WS_TABSTOP,10,52,59,10
    CONTROL         "Mesh Only",IDC_MESH_ONLY,"Button",BS_AUTORADIOBUTTON | 
                    WS_TABSTOP,10,64,49,10
    GROUPBOX        "Iso Parametric Lines",IDC_STATIC,3,3,101,73
    CONTROL         "",IDC_ISO_U_SPINNER,"SpinnerControl",0x0,87,14,7,10
    CONTROL         "",IDC_ISO_V_SPINNER,"SpinnerControl",0x0,87,27,7,10
    LTEXT           "U Lines:",IDC_STATIC,17,15,27,8
    LTEXT           "V Lines:",IDC_STATIC,18,27,26,8
    PUSHBUTTON      "Set Selected",IDC_SURF_APPROX,3,373,101,11
    PUSHBUTTON      "Reset",IDC_RESET,3,387,101,11
    CONTROL         "Viewports",IDC_TESS_VIEW,"Button",BS_AUTORADIOBUTTON | 
                    WS_GROUP | WS_TABSTOP,7,82,47,10
    CONTROL         "Renderer",IDC_TESS_RENDERER,"Button",BS_AUTORADIOBUTTON | 
                    WS_TABSTOP,55,82,45,10
    CONTROL         "Parametric",IDC_TESS_PARAM,"Button",BS_AUTORADIOBUTTON | 
                    WS_TABSTOP,9,199,49,10
    CONTROL         "",IDC_TESS_U,"CustEdit",WS_GROUP | WS_TABSTOP,55,209,36,
                    10
    CONTROL         "",IDC_TESS_V,"CustEdit",WS_TABSTOP,55,222,36,10
    CONTROL         "Spatial",IDC_TESS_SPATIAL,"Button",BS_AUTORADIOBUTTON | 
                    WS_TABSTOP,9,236,37,10
    CONTROL         "",IDC_TESS_EDGE,"CustEdit",WS_TABSTOP,55,269,36,10
    CONTROL         "Curvature",IDC_TESS_CURV,"Button",BS_AUTORADIOBUTTON | 
                    WS_TABSTOP,9,247,47,10
    CONTROL         "",IDC_TESS_DIST,"CustEdit",WS_TABSTOP,55,282,36,10
    CONTROL         "",IDC_TESS_ANG,"CustEdit",WS_TABSTOP,55,295,36,10
    CONTROL         "View-Dependent",IDC_TESS_VIEW_DEP,"Button",
                    BS_AUTOCHECKBOX | WS_TABSTOP,11,309,69,10
    CONTROL         "",IDC_TESS_U_SPINNER,"SpinnerControl",0x0,91,209,7,10
    CONTROL         "",IDC_TESS_V_SPINNER,"SpinnerControl",0x0,91,222,7,10
    CONTROL         "",IDC_TESS_EDGE_SPINNER,"SpinnerControl",0x0,91,269,7,
                    10
    CONTROL         "",IDC_TESS_DIST_SPINNER,"SpinnerControl",0x0,91,282,7,
                    10
    CONTROL         "",IDC_TESS_ANG_SPINNER,"SpinnerControl",0x0,91,295,7,10
    LTEXT           "U Steps:",IDC_STATIC,22,210,28,8
    LTEXT           "V Steps:",IDC_TESS_V_TXT,22,222,28,8
    LTEXT           "Distance:",IDC_STATIC,22,282,31,8
    LTEXT           "Angle:",IDC_STATIC,22,294,21,8
    LTEXT           "Edge:",IDC_STATIC,22,269,20,8
    CONTROL         "",IDC_MERGE,"CustEdit",WS_TABSTOP,46,323,36,10
    CONTROL         "",IDC_MERGE_SPINNER,"SpinnerControl",0x0,82,323,7,10
    LTEXT           "Merge:",IDC_MERGE_TXT,11,323,23,8
    CONTROL         "Spatial and Curvature",IDC_TESS_LDA,"Button",
                    BS_AUTORADIOBUTTON | WS_TABSTOP,9,258,84,10
    PUSHBUTTON      "Advanced Parameters...",IDC_ADVANCED,13,338,81,11
    CONTROL         "Regular",IDC_TESS_REGULAR,"Button",BS_AUTORADIOBUTTON | 
                    WS_GROUP,9,189,41,10
    CONTROL         "Base Surface",IDC_MESH,"Button",BS_AUTORADIOBUTTON | 
                    BS_PUSHLIKE | WS_GROUP,8,93,91,10
    CONTROL         "Surface Edge",IDC_TRIM,"Button",BS_AUTORADIOBUTTON | 
                    BS_PUSHLIKE,8,103,91,10
    CONTROL         "Displaced Surface",IDC_DISPLACEMENT,"Button",
                    BS_AUTORADIOBUTTON | BS_PUSHLIKE,8,113,91,10
    GROUPBOX        "Tessellation Method",IDC_STATIC,3,181,101,189
    CONTROL         "Clear Surfaces",IDC_CLEAR_ALL_SURFS,"Button",
                    BS_AUTOCHECKBOX | WS_TABSTOP,22,355,62,10
    GROUPBOX        "Load Tessellation Preset",IDC_STATIC,3,127,102,26
    PUSHBUTTON      "Low",IDC_PRESET1,6,138,30,10
    PUSHBUTTON      "Medium",IDC_PRESET2,40,138,30,10
    PUSHBUTTON      "High",IDC_PRESET3,72,138,30,10
    GROUPBOX        "Save Tessellation Preset",IDC_STATIC,3,154,102,26
    PUSHBUTTON      "Low",IDC_SAVE_PRESET1,6,165,30,10
    PUSHBUTTON      "Medium",IDC_SAVE_PRESET2,40,165,30,10
    PUSHBUTTON      "High",IDC_SAVE_PRESET3,72,165,30,10
END

IDD_DISP_SURF_APPROX_PARAMS DIALOG DISCARDABLE  0, 0, 121, 194
STYLE DS_MODALFRAME | WS_POPUP | WS_CAPTION | WS_SYSMENU
CAPTION "Approximation Parameters"
FONT 8, "MS Sans Serif"
BEGIN
    DEFPUSHBUTTON   "OK",IDOK,7,173,50,14
    PUSHBUTTON      "Cancel",IDCANCEL,64,173,50,14
    CONTROL         "Parametric",IDC_TESS_PARAM,"Button",BS_AUTORADIOBUTTON | 
                    WS_TABSTOP,11,34,49,10
    CONTROL         "",IDC_TESS_U,"CustEdit",WS_GROUP | WS_TABSTOP,57,44,36,
                    10
    CONTROL         "",IDC_TESS_V,"CustEdit",WS_TABSTOP,57,57,36,10
    CONTROL         "Spatial",IDC_TESS_SPATIAL,"Button",BS_AUTORADIOBUTTON | 
                    WS_TABSTOP,11,71,37,10
    CONTROL         "",IDC_TESS_EDGE,"CustEdit",WS_TABSTOP,57,103,36,10
    CONTROL         "Curvature",IDC_TESS_CURV,"Button",BS_AUTORADIOBUTTON | 
                    WS_TABSTOP,11,82,47,10
    CONTROL         "",IDC_TESS_DIST,"CustEdit",WS_TABSTOP,57,117,36,10
    CONTROL         "",IDC_TESS_ANG,"CustEdit",WS_TABSTOP,57,130,36,10
    CONTROL         "View-Dependent",IDC_TESS_VIEW_DEP,"Button",
                    BS_AUTOCHECKBOX | WS_TABSTOP,13,143,69,10
    CONTROL         "",IDC_TESS_U_SPINNER,"SpinnerControl",0x0,93,44,7,10
    CONTROL         "",IDC_TESS_V_SPINNER,"SpinnerControl",0x0,93,57,7,10
    CONTROL         "",IDC_TESS_EDGE_SPINNER,"SpinnerControl",0x0,93,103,7,
                    10
    CONTROL         "",IDC_TESS_DIST_SPINNER,"SpinnerControl",0x0,93,117,7,
                    10
    CONTROL         "",IDC_TESS_ANG_SPINNER,"SpinnerControl",0x0,93,130,7,10
    LTEXT           "U Steps:",-1,24,45,28,8
    LTEXT           "V Steps:",-1,24,57,28,8
    LTEXT           "Distance:",-1,24,117,31,8
    LTEXT           "Angle:",-1,24,129,21,8
    LTEXT           "Edge:",-1,24,103,20,8
    CONTROL         "Spatial and Curvature",IDC_TESS_LDA,"Button",
                    BS_AUTORADIOBUTTON | WS_TABSTOP,11,93,84,10
    PUSHBUTTON      "Advanced Parameters...",IDC_ADVANCED,15,157,81,11
    CONTROL         "Regular",IDC_TESS_REGULAR,"Button",BS_AUTORADIOBUTTON | 
                    WS_GROUP | WS_TABSTOP,11,23,41,10
    CONTROL         "Lock to Toplevel",IDC_LOCK,"Button",BS_AUTOCHECKBOX | 
                    BS_PUSHLIKE | WS_TABSTOP,7,7,107,10
END

IDD_CRUVE_SURF_APPROX_PARAMS DIALOG DISCARDABLE  0, 0, 121, 183
STYLE DS_MODALFRAME | WS_POPUP | WS_CAPTION | WS_SYSMENU
CAPTION "Approximation Parameters"
FONT 8, "MS Sans Serif"
BEGIN
    DEFPUSHBUTTON   "OK",IDOK,7,162,50,14
    PUSHBUTTON      "Cancel",IDCANCEL,64,162,50,14
    CONTROL         "Parametric",IDC_TESS_PARAM,"Button",BS_AUTORADIOBUTTON | 
                    WS_TABSTOP,11,34,49,10
    CONTROL         "",IDC_TESS_U,"CustEdit",WS_GROUP | WS_TABSTOP,57,44,36,
                    10
    CONTROL         "Spatial",IDC_TESS_SPATIAL,"Button",BS_AUTORADIOBUTTON | 
                    WS_TABSTOP,11,60,37,10
    CONTROL         "",IDC_TESS_EDGE,"CustEdit",WS_TABSTOP,57,92,36,10
    CONTROL         "Curvature",IDC_TESS_CURV,"Button",BS_AUTORADIOBUTTON | 
                    WS_TABSTOP,11,71,47,10
    CONTROL         "",IDC_TESS_DIST,"CustEdit",WS_TABSTOP,57,106,36,10
    CONTROL         "",IDC_TESS_ANG,"CustEdit",WS_TABSTOP,57,119,36,10
    CONTROL         "View-Dependent",IDC_TESS_VIEW_DEP,"Button",
                    BS_AUTOCHECKBOX | WS_TABSTOP,13,132,69,10
    CONTROL         "",IDC_TESS_U_SPINNER,"SpinnerControl",0x0,93,44,7,10
    CONTROL         "",IDC_TESS_EDGE_SPINNER,"SpinnerControl",0x0,93,92,7,10
    CONTROL         "",IDC_TESS_DIST_SPINNER,"SpinnerControl",0x0,93,106,7,
                    10
    CONTROL         "",IDC_TESS_ANG_SPINNER,"SpinnerControl",0x0,93,119,7,10
    LTEXT           "U Steps:",-1,24,45,28,8
    LTEXT           "Distance:",-1,24,106,31,8
    LTEXT           "Angle:",-1,24,118,21,8
    LTEXT           "Edge:",-1,24,92,20,8
    CONTROL         "Spatial and Curvature",IDC_TESS_LDA,"Button",
                    BS_AUTORADIOBUTTON | WS_TABSTOP,11,82,84,10
    PUSHBUTTON      "Advanced Parameters...",IDC_ADVANCED,15,146,81,11
    CONTROL         "Regular",IDC_TESS_REGULAR,"Button",BS_AUTORADIOBUTTON | 
                    WS_GROUP | WS_TABSTOP,11,23,41,10
    CONTROL         "Lock to Toplevel",IDC_LOCK,"Button",BS_AUTOCHECKBOX | 
                    BS_PUSHLIKE | WS_TABSTOP,7,7,107,10
END

IDD_SURF_APPROX_ADV DIALOG DISCARDABLE  0, 0, 180, 116
STYLE DS_MODALFRAME | WS_POPUP | WS_CAPTION | WS_SYSMENU
CAPTION "Advanced Surface Approx."
FONT 8, "MS Sans Serif"
BEGIN
    CONTROL         "Grid",IDC_GRID,"Button",BS_AUTORADIOBUTTON | WS_GROUP | 
                    WS_TABSTOP,10,19,29,10
    CONTROL         "Tree",IDC_TREE,"Button",BS_AUTORADIOBUTTON | WS_TABSTOP,
                    10,30,31,10
    DEFPUSHBUTTON   "OK",IDOK,7,95,50,14
    PUSHBUTTON      "Cancel",IDCANCEL,123,95,50,14
    LTEXT           "Subdivision Style:",IDC_STATIC,10,9,56,8
    CONTROL         "",IDC_TESS_MIN_REC,"CustEdit",WS_TABSTOP,116,41,36,10
    CONTROL         "",IDC_TESS_MIN_REC_SPINNER,"SpinnerControl",0x0,152,41,
                    7,10
    LTEXT           "Minimum Subdivison Levels",IDC_STATIC,19,43,88,8
    CONTROL         "",IDC_TESS_MAX_REC,"CustEdit",WS_TABSTOP,116,54,36,10
    CONTROL         "",IDC_TESS_MAX_REC_SPINNER,"SpinnerControl",0x0,152,54,
                    7,10
    LTEXT           "Maximum Subdivisions Levels",IDC_STATIC,19,56,94,8
    CONTROL         "Delaunay",IDC_DELAUNAY,"Button",BS_AUTORADIOBUTTON,10,
                    68,46,10
    CONTROL         "",IDC_TESS_MAX_TRIS,"CustEdit",WS_TABSTOP,116,80,36,10
    CONTROL         "",IDC_TESS_MAX_TRIS_SPINNER,"SpinnerControl",0x0,152,80,
                    7,10
    LTEXT           "Maximum Number of Triangles",IDC_STATIC,19,82,96,8
END


#ifdef APSTUDIO_INVOKED
/////////////////////////////////////////////////////////////////////////////
//
// TEXTINCLUDE
//

1 TEXTINCLUDE DISCARDABLE 
BEGIN
    "resource.h\0"
END

2 TEXTINCLUDE DISCARDABLE 
BEGIN
    "#include ""afxres.h""\r\n"
    "\0"
END

3 TEXTINCLUDE DISCARDABLE 
BEGIN
    "\r\n"
    "#include ""veroverrides.h""\r\n"
    "#include ""maxversion.r""\r\n"
    "\0"
END

#endif    // APSTUDIO_INVOKED





/////////////////////////////////////////////////////////////////////////////
//
// DESIGNINFO
//

#ifdef APSTUDIO_INVOKED
GUIDELINES DESIGNINFO DISCARDABLE 
BEGIN
    IDD_SURF_APPROX_PARAMS, DIALOG
    BEGIN
        LEFTMARGIN, 7
        RIGHTMARGIN, 114
        TOPMARGIN, 7
        BOTTOMMARGIN, 187
    END

    IDD_DISP_SURF_APPROX_PARAMS, DIALOG
    BEGIN
        LEFTMARGIN, 7
        RIGHTMARGIN, 114
        TOPMARGIN, 7
        BOTTOMMARGIN, 187
    END

    IDD_CRUVE_SURF_APPROX_PARAMS, DIALOG
    BEGIN
        LEFTMARGIN, 7
        RIGHTMARGIN, 114
        TOPMARGIN, 7
        BOTTOMMARGIN, 176
    END

    IDD_SURF_APPROX_ADV, DIALOG
    BEGIN
        LEFTMARGIN, 7
        RIGHTMARGIN, 173
        TOPMARGIN, 7
        BOTTOMMARGIN, 109
    END
END
#endif    // APSTUDIO_INVOKED


/////////////////////////////////////////////////////////////////////////////
//
// String Table
//

STRINGTABLE DISCARDABLE 
BEGIN
    IDS_LIB_DESCRIPTION     "NURBS Surface Approximation Utility (Autodesk)"
    IDS_SURF_APPROX         "Surface Approximation"
    IDS_API_TEST            "NURBS API Test"
    IDS_POINT               "Point"
    IDS_POINT_CONST_POINT   "Point Constrained Point"
    IDS_CURVE_CONST_POINT   "Curve Constrained Point"
    IDS_SURF_CONST_POINT    "Surface Constrained Point"
    IDS_CURVE_CURVE_POINT   "Curve Curve Intersection Point"
    IDS_CV_CURVE            "CV Curve"
    IDS_POINT_CURVE         "Point Curve"
    IDS_BLEND_CURVE         "Blend Curve"
    IDS_OFFSET_CURVE        "Offset Curve"
    IDS_XFORM_CURVE         "Transform Curve"
    IDS_MIRROR_CURVE        "Mirror Curve"
    IDS_FILLET_CURVE        "Fillet Curve"
END

STRINGTABLE DISCARDABLE 
BEGIN
    IDS_CHAMFER_CURVE       "Chamfer Curve"
    IDS_U_ISO_CURVE         "U Iso Curve"
    IDS_V_ISO_CURVE         "V Iso Curve"
    IDS_CV_SURFACE          "CV Surface"
    IDS_CV                  "CV"
    IDS_POINT_SURFACE       "Point Surface"
    IDS_BLEND_SURFACE       "Blend Surface"
    IDS_OFFSET_SURFACE      "Offset Surface"
    IDS_XFORM_SURFACE       "Transform Surface"
    IDS_MIRROR_SURFACE      "Mirror Surface"
    IDS_RULED_SURFACE       "Ruled Surface"
    IDS_ULOFT_SURFACE       "U Loft Surface"
    IDS_EXTRUDE_SURFACE     "Extrude Surface"
    IDS_LATHE_SURFACE       "Lathe Surface"
    IDS_F_EDGE_CRV1         "Fillet Edge Curve1"
    IDS_F_EDGE_CRV2         "Fillet Edge Curve2"
END

STRINGTABLE DISCARDABLE 
BEGIN
    IDS_C_EDGE_CRV1         "Chamfer Edge Curve1"
    IDS_C_EDGE_CRV2         "Chamfer Edge Curve2"
    IDS_ADDED_POINT_SURF    "Added Point Surf"
    IDS_ADDED_ISO_CURVE     "Added Iso Curve"
    IDS_J_PT_CRV1           "Join Point Curve 1"
    IDS_J_PT_CRV2           "Join Point Curve 2"
    IDS_J_PT_SRF1           "Join Point Surf 1"
    IDS_J_PT_SRF2           "Join Point Surf 2"
    IDS_BREAK_CURVE         "Break Curve"
    IDS_BREAK_SURFACE       "Break Surf"
    IDS_NAME                "Name"
    IDS_ID                  "ID"
    IDS_ISO_CURVE           "Iso Curve"
    IDS_X                   "X:"
    IDS_Y                   "Y:"
    IDS_Z                   "Z:"
END

STRINGTABLE DISCARDABLE 
BEGIN
    IDS_NUM_TRIM_POINTS     "NumTrimPoints"
    IDS_PARAMETER           "Parameter"
    IDS_DIRECTION_NONE      "Direction = None"
    IDS_DIRECTION_POS       "Direction = Positive"
    IDS_DIRECTION_NEG       "Direction = Negative"
    IDS_RENDERABLE          "Renderable"
    IDS_FLIP_NORMALS        "Flip Normals"
    IDS_MAT_ID              "Material ID"
    IDS_CLOSED_U            "Closed In U"
    IDS_CLOSED_V            "Closed In V"
    IDS_UV_CHANNEL          "UV Channel"
    IDS_GENUV               "GenUVs"
    IDS_TEXUV               "TexUV"
    IDS_U                   "U:"
    IDS_V                   "V:"
    IDS_UTILE               "U Tile:"
END

STRINGTABLE DISCARDABLE 
BEGIN
    IDS_VTILE               "V Tile:"
    IDS_UOFFSET             "U Offset:"
    IDS_VOFFSET             "V Offset:"
    IDS_YES                 "Yes"
    IDS_NO                  "No"
    IDS_TYPE                "TYPE:"
    IDS_ON_OBJECT           "On Object"
    IDS_OFFSET              "Offset"
    IDS_NORMAL              "Normal:"
    IDS_UTANGENT            "U Tangent:"
    IDS_VTANGENT            "V Tangent:"
    IDS_UPARAM              "U Parameter:"
    IDS_VPARAM              "V Parameter:"
    IDS_XFORM_MAT           "Transformation Matrix:"
    IDS_POINTS              "POINTS:"
END

STRINGTABLE DISCARDABLE 
BEGIN
    IDS_ORDER               "Order"
    IDS_KNOTS               "Knots"
    IDS_CVS                 "CVS:"
    IDS_PARENT_ID           "Parent ID:"
    IDS_TRANSFORM           "Transform"
    IDS_DIRECTION           "Direction:"
    IDS_DISTANCE            "Distance:"
    IDS_TENSION             "Tension"
    IDS_EDGE                "Edge"
    IDS_FLIP                "Flip"
    IDS_LOWU                "U Low"
    IDS_HIGHU               "U High"
    IDS_LOWV                "V Low"
    IDS_HIGHV               "V High"
    IDS_UORDER              "U Order:"
    IDS_VORDER              "V Order:"
END

STRINGTABLE DISCARDABLE 
BEGIN
    IDS_UKNOTS              "U Knots:"
    IDS_VKNOTS              "V Knots:"
    IDS_END                 "End"
    IDS_TRIM                "Trim:"
    IDS_MIRRORX             "Mirror X"
    IDS_MIRRORY             "Mirror Y"
    IDS_MIRRORZ             "Mirror Z"
    IDS_MIRRORXY            "Mirror XY"
    IDS_MIRRORXZ            "Mirror XZ"
    IDS_MIRRORYZ            "Mirror YZ"
    IDS_AXIS                "Axis:"
    IDS_DEGREES             "Degrees:"
    IDS_NURBS               "NURBS"
    IDS_SELECTED            "Selected"
    IDS_NOT_SELECTED        "Not Selected"
    IDS_TEST_OBJECT         "NAPI Test Object"
END

STRINGTABLE DISCARDABLE 
BEGIN
    IDS_ADV_SURF_APPROX_WARNING_TITLE "Surface Approximation Verification"
    IDS_ADV_SURF_APPROX_WARNING 
                            "You have selected a potential dangerous setting for the SubDivision limits.  Are you sure you want to do this?"
    IDS_SURF_DISPLAY        "Surface Display"
    IDS_CURV_SURF_INT_POINT "Curve Surface Intersection Point"
    IDS_PROJ_VECT_CURVE     "Project Vector Curve"
    IDS_PROJ_NORM_CURVE     "Project Normal Curve"
    IDS_SURF_SURF_CURVE     "Surface Surface Intersection Curve"
    IDS_COS_CURVE           "Curve On Surface"
    IDS_SURF_NORM_CURVE     "Surface Normal Curve"
    IDS_UVLOFT_SURFACE      "UV Loft Surface"
    IDS_NBLEND_SURFACE      "Multi Sided Blend Surface"
    IDS_1RAIL_SURFACE       "1 Rail Sweep Surface"
    IDS_2RAIL_SURFACE       "2 Rail Sweep Surface"
    IDS_MULTI_TRIM_SURFACE  "Multiple Curve Trimmed Surface"
END

STRINGTABLE DISCARDABLE 
BEGIN
    IDS_CAP_SURFACE         "Cap Surface"
    IDS_PARALLEL            "Parallel"
    IDS_SCALE               "Scale"
    IDS_RAIL_ID             "Rail ID:"
    IDS_SEED                "Seed"
    IDS_TRIM_SURFACE        "Trim Surface:"
    IDS_FLIP_TRIM           "Flip Trim:"
    IDS_CLP                 "Chord Length Parameterized Texture Surface"
    IDS_POINT_COS_CURVE     "Point Curve On Surface"
    IDS_CV_COS_CURVE        "CV Curve On Surface"
    IDS_RIGID               "Rigid"
    IDS_ANGLE               "Angle"
    IDS_FILLET_SURFACE      "Fillet Surface"
    IDS_CUBIC               "Cubic:"
    IDS_RADIUS              "Radius:"
    IDS_SURFACE_EDGE_CURVE  "Surface Edge Curve"
END

STRINGTABLE DISCARDABLE 
BEGIN
    IDS_PNT_TEST_OBJECT     "NAPI Point Test Object"
    IDS_CRV_TEST_OBJECT     "NAPI Curve Test Object"
    IDS_SRF_TEST_OBJECT     "NAPI Surface Test Object"
    IDS_COS_TEST_OBJECT     "NAPI COS Test Object"
END

STRINGTABLE DISCARDABLE 
BEGIN
    IDS_SNAPCS              "Snap Cross Sections"
    IDS_ROADLIKE            "Roadlike"
    IDS_TEXTURE_POINT       "Texture Point"
    IDS_SURFACE_MAPPER      "Surface Mapper"
END

#endif    // English (U.S.) resources
/////////////////////////////////////////////////////////////////////////////



#ifndef APSTUDIO_INVOKED
/////////////////////////////////////////////////////////////////////////////
//
// Generated from the TEXTINCLUDE 3 resource.
//


#include "veroverrides.h"
#include "maxversion.r"
/////////////////////////////////////////////////////////////////////////////
#endif    // not APSTUDIO_INVOKED

                                                                   //{{NO_DEPENDENCIES}}
// Microsoft Visual C++ generated include file.
// Used by vrmlexp.rc
//
#define IDS_DB_TRIGGER_DIST             1
#define IDS_ANIM_PICK_MODE              2
#define IDS_LOD_PICK_MODE               3
#define IDS_OPEN_FAILED                 4
#define IDS_HL_TITLE                    5
#define IDS_VPT_TITLE                   6
#define IDS_ANIM_TITLE                  7
#define IDS_ACTION_TITLE                8
#define IDS_TRIGGERS_TITLE              9
#define IDS_LOD_TITLE                   10
#define IDS_VRML_INS_TITLE              11
#define IDS_LIBDESCRIPTION              12
#define IDS_VRML_EXPORT                 13
#define IDS_DS_AMBIENT                  14
#define IDS_DS_DIFFUSE                  15
#define IDS_DS_SPECULAR                 16
#define IDS_DS_NONE                     17
#define IDS_DS_LOCKAD                   18
#define IDS_DS_LOCKCOL                  19
#define IDS_DS_PARAMCHG                 20
#define IDS_DS_LOCK_DS                  21
#define IDS_DS_BASIC                    22
#define IDS_DS_SHININESS                23
#define IDS_DS_SELFI                    24
#define IDS_DS_OPACITY                  25
#define IDS_DS_MAP_TEXTURE_ERR          26
#define IDS_DS_INVAL_NAME               27
#define IDS_DS_SELECT_FILE              28
#define IDS_DS_STANDARD                 29
#define IDS_DS_BITMAP                   30
#define IDS_TH_SCENEEXPORT              31
#define IDS_TimeSensor_PICK_MODE        32
#define IDS_TouchSensor_PICK_MODE       33
#define IDS_POLYGON_COUNTER_CLASS       34
#define IDS_ANCHOR_CLASS                35
#define IDS_TOUCH_SENSOR_CLASS          36
#define IDS_TIME_SENSOR_CLASS           37
#define IDS_NAV_INFO_CLASS              38
#define IDS_BACKGROUND_CLASS            39
#define IDS_FOG_CLASS                   40
#define IDS_AUDIO_CLIP_CLASS            41
#define IDS_SOUND_CLASS                 42
#define IDS_BILLBOARD_CLASS             43
#define IDS_LOD_CLASS                   44
#define IDS_INLINE_CLASS                45
#define IDS_ANCHOR                      46
#define IDS_TOUCH_SENSOR                47
#define IDS_TIME_SENSOR                 48
#define IDS_NAV_INFO                    49
#define IDS_BACKGROUND                  50
#define IDS_FOG                         51
#define IDS_AUDIO_CLIP                  52
#define IDS_SOUND                       53
#define IDS_BILLBOARD                   54
#define IDS_LOD                         55
#define IDS_INLINE                      56
#define IDS_VRML_EXPORT_CLASS           57
#define IDS_PROX_SENSOR_CLASS           58
#define IDS_PROX_SENSOR                 59
#define IDS_PICK_TRIGGER                69
#define IDS_PICK_AUDIOCLIP              70
#define IDS_OUT_TRIANGLES               71
#define IDS_OUT_QUADS                   72
#define IDS_OUT_NGONS                   73
#define IDS_OUT_VIS_EDGES               74
#define IDS_VISIBLE_EDGES               75
#define IDS_NGONS                       76
#define IDS_QUADS                       77
#define IDD_CPPOUT_PANEL                103
#define IDD_LOD                         116
#define IDD_INS                         117
#define IDD_VRBLEXP                     118
#define IDD_URL_BOOKMARKS               119
#define IDC_LOD_CURSOR                  122
#define IDB_VMTL_BUTTONS                122
#define IDC_ANIM_CURSOR                 123
#define IDB_VMTL_MASKBUTTONS            123
#define IDD_SAMPLE_RATES                127
#define IDD_WORLD_INFO                  129
#define IDD_ABOUT                       130
#define IDD_PROGRESSDLG                 131
#define IDC_CROSS_HAIR                  156
#define IDC_CPPOUT_PICK                 1002
#define IDC_TRIANGLE                    1009
#define IDC_POLY                        1010
#define IDD_TimeSensor                  1034
#define IDD_NAV_INFO                    1035
#define IDD_BACKGROUND_COLORS           1036
#define IDD_BACKGROUND_IMAGES           1037
#define IDD_FOG                         1038
#define IDD_AUDIO_CLIP                  1039
#define IDC_COLOR_SWATCH_2              1040
#define IDD_SOUND                       1040
#define IDC_COLOR_SWATCH_3              1041
#define IDD_TOUCH_SENSOR                1041
#define IDD_PROX_SENSOR                 1042
#define IDD_BACKGROUND_COLORS1          1043
#define IDD_ANCHOR                      1044
#define IDD_BBOARD                      1045
#define IDC_TFORM_ONCE                  1061
#define IDC_HYPERLINK                   1061
#define IDC_COORD_ONCE                  1062
#define IDC_FLIPBOOK_ONCE               1063
#define IDC_URL                         1068
#define IDC_URL_PREFIX                  1068
#define IDC_TITLE                       1068
#define IDC_BACK                        1068
#define IDC_INFO                        1069
#define IDC_BOTTOM                      1069
#define IDC_FRONT                       1070
#define IDC_LEFT                        1071
#define IDC_RIGHT                       1072
#define IDC_TOP                         1073
#define IDC_LOD_SIZE                    1094
#define IDC_LOD_SIZE_SPINNER            1095
#define IDC_LOD_PICK                    1096
#define IDC_LOD_DIST                    1098
#define IDC_LOD_DIST_SPINNER            1099
#define IDC_LOD_LIST                    1101
#define IDC_LOD_DEL                     1102
#define IDC_INS_URL                     1103
#define IDC_INS_SIZE                    1104
#define IDC_INS_SIZE_SPINNER            1105
#define IDC_INS_BBOX_SIZE               1106
#define IDC_INS_BBOX_DEF                1107
#define IDC_GENNORMALS                  1109
#define IDC_INDENT                      1110
#define IDC_CPV_CALC                    1111
#define IDC_CAMERA_COMBO                1113
#define IDC_ADD                         1114
#define IDC_NAV_INFO_COMBO              1114
#define IDC_DELETE                      1115
#define IDC_BACKGROUND_COMBO            1115
#define IDC_IMPORT                      1116
#define IDC_FOG_COMBO                   1116
#define IDC_DESC                        1118
#define IDC_URL_LIST                    1120
#define IDC_BOOKMARKS                   1121
#define IDC_USE_PREFIX                  1127
#define IDC_DIGITS                      1136
#define IDC_POLY_COUNT                  1139
#define IDC_SEL_COUNT                   1140
#define IDC_POLY_BAR                    1141
#define IDC_SELECTED_BAR                1142
#define IDC_LOOP                        1144
#define IDC_START_EDIT                  1147
#define IDC_START_SPIN                  1148
#define IDC_STOP_EDIT                   1149
#define IDC_STOP_SPIN                   1150
#define IDC_COORD_INTERP                1151
#define IDC_MAX_FRONT_EDIT              1151
#define IDC_MAX_FRONT_SPIN              1152
#define IDC_FLIP_BOOK                   1152
#define IDC_SAMPLE_RATES                1153
#define IDC_TFORM_CUSTOM                1156
#define IDC_TFORM_EDIT                  1157
#define IDC_TFORM_SPIN                  1158
#define IDC_COORD_EDIT                  1159
#define IDC_TimeSensor_SIZE             1159
#define IDC_COLOR_3_ANGLE_EDIT          1159
#define IDC_COORD_SPIN                  1160
#define IDC_TimeSensor_SIZE_SPINNER     1160
#define IDC_COLOR_3_ANGLE_SPIN          1160
#define IDC_COORD_CUSTOM                1161
#define IDC_TimeSensor_PICK             1161
#define IDC_TimeSensor_LIST             1162
#define IDC_FLIPBOOK_EDIT               1162
#define IDC_TimeSensor_DEL              1163
#define IDC_FLIPBOOK_SPIN               1163
#define IDC_HEADLIGHT                   1164
#define IDC_FLIPBOOK_CUSTOM             1164
#define IDC_VIS_LIMIT_EDIT              1165
#define IDC_VIS_LIMIT_SPIN              1166
#define IDC_COLLISION_EDIT              1167
#define IDC_COLLISION_SPIN              1168
#define IDC_TYPE                        1169
#define IDC_TERRAIN_EDIT                1170
#define IDC_TERRAIN_SPIN                1171
#define IDC_STEP_EDIT                   1172
#define IDC_STEP_SPIN                   1173
#define IDC_SPEED_EDIT                  1174
#define IDC_SPEED_SPIN                  1175
#define IDC_WORLD_INFO                  1176
#define IDC_EXP_HELP                    1177
#define IDC_EXPORT_HIDDEN               1178
#define IDC_PRIM                        1179
#define IDC_1_COLOR                     1180
#define IDC_ENABLE_PROGRESS_BAR         1180
#define IDC_2_COLOR                     1181
#define IDC_COLOR_PER_VERTEX            1181
#define IDC_COLOR_PER_VERTEX1           1181
#define IDC_3_COLOR                     1182
#define IDC_COLOR_SWATCH_1              1183
#define IDC_COLOR_2_ANGLE_EDIT          1184
#define IDC_COLOR_2_ANGLE_SPIN          1185
#define IDC_COLOR_SWATCH                1187
#define IDC_VR_EDIT                     1188
#define IDC_VR_SPIN                     1189
#define IDC_PITCH_EDIT                  1191
#define IDC_PITCH_SPIN                  1192
#define IDC_INTENSITY_EDIT              1193
#define IDC_INTENSITY_SPIN              1194
#define IDC_MIN_BACK_EDIT               1195
#define IDC_MIN_BACK_SPIN               1196
#define IDC_MIN_FRONT_EDIT              1197
#define IDC_MIN_FRONT_SPIN              1198
#define IDC_MAX_BACK_EDIT               1199
#define IDC_MAX_BACK_SPIN               1200
#define IDC_NAME                        1201
#define IDC_AUDIO_CLIP_PICK             1202
#define IDC_SPATIALIZE                  1203
#define IDC_PRIORITY_EDIT               1204
#define IDC_START_ON_LOAD               1204
#define IDC_PRIORITY_SPIN               1205
#define IDC_ICON_EDIT                   1206
#define IDC_ICON_SPIN                   1207
#define IDC_ENABLE                      1209
#define IDC_PICK                        1210
#define IDC_SIZE_EDIT                   1211
#define IDC_SIZE_SPIN                   1212
#define IDC_LIST                        1213
#define IDC_DEL                         1214
#define IDC_WIDTH_EDIT                  1215
#define IDC_PICK_PARENT                 1215
#define IDC_WIDTH_SPIN                  1216
#define IDC_HEIGHT_EDIT                 1217
#define IDC_HEIGHT_SPIN                 1218
#define IDC_LENGTH_EDIT                 1219
#define IDC_LENGTH_SPIN                 1220
#define IDC_TRIGGER_OBJ                 1221
#define IDC_ANCHOR_URL                  1226
#define IDC_PARAMETER                   1227
#define IDC_CAMERA                      1228
#define IDC_SET_CAMERA                  1229
#define IDC_ALIGN                       1230
#define IDC_POLYGON_TYPE                1231
#define IDC_PROGRESS_NNAME              1236
#define IDC_CPV_MAX                     1238
#define IDC_MAX_POLY_EDIT               1349
#define IDC_MAX_POLY_SPIN               1350
#define IDC_MAX_SELECTED_EDIT           1351
#define IDC_MAX_SELECTED_SPIN           1352
#define IDS_DS_CREATE                   10008
#define IDS_DS_EXCLUDE__                10122
#define IDS_DS_INCLUDE__                10123
#define IDS_DS_LIGHTCOL                 10175
#define IDS_DB_TDIST                    20072
#define IDS_DB_MULTIPLIER               20315
#define IDS_DB_ATTENSTART               20316
#define IDS_DB_ATTENEND                 20317
#define IDS_DB_HOTSIZE                  20318
#define IDS_DB_FALLSIZE                 20319
#define IDS_DB_COLOR                    20320
#define IDS_DB_ASPECT_RATIO             20323
#define IDS_DB_TAPE_LENGTH              20326
#define IDS_DB_NRANGE                   20453
#define IDS_DB_FRANGE                   20454
#define IDS_RB_OBJECT                   30004
#define IDS_RB_PARAMETERS               30028
#define IDS_RB_ANGLE                    30029
#define IDS_RB_AMOUNT                   30031
#define IDS_RB_RED                      30049
#define IDS_RB_GREEN                    30050
#define IDS_RB_BLUE                     30051
#define IDS_RB_HOTSIZE                  30052
#define IDS_RB_TRANSFORM                30053
#define IDS_RB_BASEPARAMS               30054
#define IDS_DB_TARGET                   30055
#define IDS_DB_DOT_TARGET               30056
#define IDS_DB_OMNI                     30057
#define IDS_DB_TARGET_SPOT              30058
#define IDS_DB_DIRECTIONAL              30059
#define IDS_DB_FREE_SPOT                30060
#define IDS_DB_NONE                     30061
#define IDS_DB_GENERAL_PARAMS           30064
#define IDS_DB_DIR_PARAMS               30065
#define IDS_DB_SPOT_PARAMS              30066
#define IDS_DB_SHADOW_PARAMS            30067
#define IDS_DB_SELECT_TO_FIT            30068
#define IDS_DB_OMNI_LIGHT               30069
#define IDS_DB_DIR_LIGHT                30070
#define IDS_DB_DIRECT                   30071
#define IDS_DB_FSPOT                    30072
#define IDS_DB_SPOT                     30073
#define IDS_DB_LIGHT                    30074
#define IDS_DB_TAPE                     30075
#define IDS_DB_GENERAL                  30076
#define IDS_RB_GEOMETERIC               30157
#define IDS_RB_SHAPES                   30158
#define IDS_RB_LIGHTS                   30159
#define IDS_RB_CPPOBJECTOUT             30619
#define IDS_RB_CPPFILES                 30620
#define IDS_RB_SAVEOBJECT               30621
#define IDS_RB_FILEEXISTS               30625
#define IDS_RB_MAPSIZE                  30640
#define IDS_RB_MAPBIAS                  30641
#define IDS_RB_MAPRANGE                 30642
#define IDS_RB_RAYBIAS                  30643
#define IDS_RB_NEARPLANE                30644
#define IDS_RB_FARPLANE                 30645
#define IDS_PRS_URL                     30646
#define IDS_PRS_DESCRIPTION             30647
#define IDS_SKY_COLORS                  30648
#define IDS_GROUND_COLORS               30649
#define IDS_IMAGES                      30650
#define IDC_STATIC                      -1

// Next default values for new objects
// 
#ifdef APSTUDIO_INVOKED
#ifndef APSTUDIO_READONLY_SYMBOLS
#define _APS_NEXT_RESOURCE_VALUE        132
#define _APS_NEXT_COMMAND_VALUE         40001
#define _APS_NEXT_CONTROL_VALUE         1240
#define _APS_NEXT_SYMED_VALUE           101
#endif
#endif
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 #include "reactionMgr.h"
#include "custcont.h"

static ReactionManager theReactionMgr;
// Reaction Manager interface instance and descriptor
ReactionMgrImp theReactionMgrImp(REACTION_MANAGER_INTERFACE, _T("reactionMgr"), 0, NULL, FP_CORE, 
	IReactionManager::openEditor, _T("openEditor"), 0, TYPE_VOID, 0, 0, 
	p_end );

ReactionManager* GetReactionManager() { return &theReactionMgr; }
void AddReactionMgrToScene();

//**********************************************************************
// ReactionManager implementation
//**********************************************************************
void PostReset(void *param, NotifyInfo *info)
{
	AddReactionMgrToScene();
}

void PreReset(void *param, NotifyInfo *info)
{
	DbgAssert(info);

	// Do not empty the reaction manager if we're just loading a render preset file
	if (info != NULL && info->intcode == NOTIFY_FILE_PRE_OPEN && info->callParam) {
		FileIOType type = *(static_cast<FileIOType*>(info->callParam));
		if (type == IOTYPE_RENDER_PRESETS)
			return;
	}

	for(int i = GetReactionManager()->NumRefs()-1; i >= 0; i--)
		GetReactionManager()->RemoveReaction(i);
}

ReactionManager::ReactionManager() 
{ 
	mSelected = -1; 
	mSuspended = 0;
	RegisterNotification(PreReset, this, NOTIFY_SYSTEM_PRE_RESET);
	RegisterNotification(PreReset, this, NOTIFY_FILE_PRE_OPEN);
	RegisterNotification(PreReset, this, NOTIFY_SYSTEM_PRE_NEW);

	RegisterNotification(PreReset, this, NOTIFY_SYSTEM_SHUTDOWN);

	RegisterNotification(PostReset, this, NOTIFY_SYSTEM_POST_RESET);
	RegisterNotification(PostReset, this, NOTIFY_FILE_POST_OPEN);
	RegisterNotification(PostReset, this, NOTIFY_SYSTEM_POST_NEW);
}

ReactionManager::~ReactionManager() 
	{ 
	}

void ReactionManager::SetReference(int i, RefTargetHandle rtarg)
{
	if (i >= mReactionSets.Count())
	{
		if (rtarg != NULL)
		{
			if (theHold.Holding()) {
				theHold.Put(new MgrListSizeRestore(GetReactionManager(), true, i));
				}
			ReactionSet* m = (ReactionSet*)rtarg;
			mReactionSets.Append(1, &m);
		}
	}
	else
	{
		mReactionSets[i] = (ReactionSet*)rtarg;
	}
}

RefResult ReactionManager::NotifyRefChanged(const Interval& changeInt, RefTargetHandle hTarget, PartID &partID, RefMessage message, BOOL propagate)
{
	switch (message) {
		case REFMSG_TARGET_DELETED:
			RemoveTarget(hTarget);
			break;
		}
	return REF_SUCCEED;
}

void ReactionManager::RemoveTarget(ReferenceTarget* target)
{
	for(int i = mReactionSets.Count()-1; i>=0; i--)
		if (mReactionSets[i] == target)
		{
			RemoveReaction(i);
			break;
		}
}

ReactionMaster* ReactionManager::AddReaction(ReferenceTarget* owner, int subAnimIndex, Reactor* slave)
{
	if (!IsSuspended())
	{
      int i;
		for(i = 0; i < mReactionSets.Count(); i++)
		{
			if (!mReactionSets[i])
				continue;
			ReactionMaster* master = mReactionSets[i]->GetReactionMaster();
			if ((owner == NULL && master == NULL) || 
				(master != NULL && master->Owner() != NULL && // don't add it to a set with a valid master and a null client.  This will soon be deleted.
				master->Owner() == owner && master->SubIndex() == subAnimIndex))
			{
				if (slave != NULL)
				{
					mReactionSets[i]->AddSlave(slave);
					mSelected = i;
				}
				return master;
			}
		}
		ReactionMaster* master = NULL;
		if (owner != NULL)
			master = new ReactionMaster(owner, subAnimIndex);

		if (theHold.Holding()) {
			theHold.Put(new MgrListSizeRestore(GetReactionManager(), true, i));
		}
		ReactionSet* null_ptr = NULL;
		mReactionSets.Append(1, &null_ptr);

		ReactionSet* rs = new ReactionSet(master, slave);
		ReplaceReference(i, (ReferenceTarget*)rs);
		mSelected = i;
		NotifyDependents(FOREVER, PART_ALL, REFMSG_SUBANIM_STRUCTURE_CHANGED);
		return master;
	}
	return NULL;
}

void ReactionManager::AddReactionSet(ReactionSet* set)
{
	int count = mReactionSets.Count();
	for(int i = 0; i < count; i++)
		if (mReactionSets[i] == set)
			return;

	if (theHold.Holding()) {
		theHold.Put(new MgrListSizeRestore(GetReactionManager(), true, count));
	}
	ReactionSet* null_ptr = NULL;
	mReactionSets.Append(1, &null_ptr);

	ReplaceReference(count, set);
	mSelected = count;
	NotifyDependents(FOREVER, PART_ALL, REFMSG_SUBANIM_STRUCTURE_CHANGED);
}

void ReactionManager::MaybeAddReactor(Reactor* slave)
{
	for(int i = 0; i < mReactionSets.Count(); i++)
	{
		ReactionSet* set = GetReactionSet(i);
		if (set->GetReactionMaster() == slave->GetMaster())
		{
			for(int x = 0; x < set->SlaveCount(); x++)
			{
				if (set->Slave(x) == slave)
				{
					mSelected = i;
					return; //already added
				}
			}
			// if a set has this master, but not this slave add the slave.
			// this can happen with R7 beta files.
			set->AddSlave(slave); 
			return;
		}
	}

	// if you made it this far you are probably loading an PreR7 or R7 beta file.
	ReactionMaster* slavesMaster = slave->GetMaster();
	if (slavesMaster != NULL)
	{
		ReactionSet* rs = new ReactionSet(slavesMaster, slave);
		if (rs)
			AddReactionSet(rs);
	}
	else
		GetReactionManager()->AddReaction(NULL, 0, slave);
}

void ReactionManager::RemoveSlave(ReferenceTarget* owner, int subAnimIndex, Reactor* slave)
{
	for(int i = 0; i < mReactionSets.Count(); i++)
	{
		ReactionMaster* master = mReactionSets[i]->GetReactionMaster();
		if ((master == NULL && owner == NULL) ||
			(master != NULL && master->Owner() == owner && master->SubIndex() == subAnimIndex))
		{
			if (slave != NULL)
				mReactionSets[i]->RemoveSlave(slave);
			return;
		}
	}
}

void ReactionManager::RemoveReaction(ReferenceTarget* owner, int subAnimIndex, Reactor* slave)
{
	for(int i = 0; i < mReactionSets.Count(); i++)
	{
		ReactionMaster* master = mReactionSets[i]->GetReactionMaster();
		if ((master == NULL && owner == NULL) ||
			(master != NULL && master->Owner() == owner && master->SubIndex() == subAnimIndex))
		{
			if (slave != NULL)
				mReactionSets[i]->RemoveSlave(slave);
			if (mReactionSets[i]->SlaveCount() == 0)
			{
				RemoveReaction(i);
			}
			return;
		}
	}
}

void ReactionManager::RemoveReaction(int i)
{
	if (i >= mReactionSets.Count())
		return;

	Suspend();
	DeleteReference(i);
	if (theHold.Holding())
		theHold.Put(new MgrListSizeRestore(GetReactionManager(), false, i));
	// Deleting the reference above may have triggered other reaction set deletions
	if (i < mReactionSets.Count())
		mReactionSets.Delete(i, 1);
	if (mSelected >= i)
		mSelected--;
	NotifyDependents(FOREVER, PART_ALL, REFMSG_SUBANIM_STRUCTURE_CHANGED);
	Resume();
}

IOResult ReactionManager::Save(ISave *isave)
{		
	return IO_OK;
}

IOResult ReactionManager::Load(ILoad *iload)
{
	return IO_OK;
}

void ReactionMgrImp::OpenEditor()
{
	// open reaction manager dialog on selected objects
	if (GetReactionDlg() == NULL)
	{
		SetReactionDlg(new ReactionDlg((IObjParam*)GetCOREInterface(), GetCUIFrameMgr()->GetAppHWnd()));
		ShowWindow(GetReactionDlg()->hWnd, SW_SHOWNORMAL);
	}
	else if (IsIconic(GetReactionDlg()->hWnd))
		ShowWindow(GetReactionDlg()->hWnd, SW_SHOWNORMAL);
	else
		DestroyWindow(GetReactionDlg()->hWnd);
}

//**********************************************************************
// ReactionSet implementation
//**********************************************************************

ReferenceTarget* ReactionSet::GetReference(int i) 
{ 
	if (i == 0)
		return mMaster;
	else return mSlaves[i-1];
}

void ReactionSet::SetReference(int i, RefTargetHandle rtarg)
{
	if (i == 0)
		mMaster = (ReactionMaster*)rtarg;
	else 
	{
		i--;
		if (i >= mSlaves.Count())
		{
			if (rtarg != NULL)
			{
				if (theHold.Holding()) {
					theHold.Put(new SlaveListSizeRestore(this, true, i));
					}
				Reactor* r = (Reactor*)rtarg;
				mSlaves.Append(1, &r);
			}
		}
		else
		{
			mSlaves[i] = (Reactor*)rtarg;
		}
	}
}

RefResult ReactionSet::NotifyRefChanged(const Interval& changeInt, RefTargetHandle hTarget, PartID &partID, RefMessage message, BOOL propagate)
{
	switch (message) {
		case REFMSG_TARGET_DELETED:
			{
				if (hTarget == this->mMaster)
				{
					mMaster = NULL;
					return REF_AUTO_DELETE;
				}
				else
				{
					for(int i = mSlaves.Count()-1; i >= 0 ; i--)
						if (hTarget == mSlaves[i])
						{
							if (theHold.Holding())
								theHold.Put(new SlaveListSizeRestore(this, false, i));
							mSlaves.Delete(i, 1);
							NotifyDependents(FOREVER, PART_ALL, REFMSG_SUBANIM_STRUCTURE_CHANGED);
							break;
						}
				}
			}

			break;
		}
	return REF_SUCCEED;
}

void ReactionSet::AddSlave(Reactor* r)
{
    int i;
	for(i = 0; i < mSlaves.Count(); i++)
	{
		if (mSlaves[i] == r)
			return;
	}

	if (theHold.Holding()) {
		theHold.Put(new SlaveListSizeRestore(this, true, i));
	}
	Reactor* null_ptr = NULL;
	mSlaves.Append(1, &null_ptr);

	ReplaceReference( SlaveNumToRefNum(i), r);
	NotifyDependents(FOREVER, PART_ALL, REFMSG_SUBANIM_STRUCTURE_CHANGED);
}

void ReactionSet::RemoveSlave(Reactor* r)
{
	for(int i = 0; i < mSlaves.Count(); i++)
	{
		if (mSlaves[i] == r)
		{
			RemoveSlave(i);
			return;
		}
	}
}

void ReactionSet::RemoveSlave(int i)
{
	DeleteReference(SlaveNumToRefNum(i));
	mSlaves.Delete(i, 1);
	if (theHold.Holding()) {
		theHold.Put(new SlaveListSizeRestore(this, false, i));
		}
	NotifyDependents(FOREVER, PART_ALL, REFMSG_SUBANIM_STRUCTURE_CHANGED);
}

void ReactionSet::ReplaceMaster(ReferenceTarget* parent, int subAnim)
{
	int defaultID = -1;
	bool aborted = false;

	for(int i = 0; i < GetReactionManager()->ReactionCount(); i ++)
	{
		ReactionSet* set = GetReactionManager()->GetReactionSet(i);
		if (set != this)
		{
			ReactionMaster* master = set->GetReactionMaster();
			if (master != NULL && master->Owner() == parent && master->subnum == subAnim)
			{
				aborted = true;
				break;
			}
		}
	}

	if (!aborted)
	{
		ReactionMaster* master = new ReactionMaster(parent, subAnim);
		//master->AddState(NULL, defaultID, true, GetCOREInterface()->GetTime());
		ReplaceReference(0, master);
	}

	if (SlaveCount())
	{
		for(int i = SlaveCount()-1; i >=0 ; i--)
		{
			Reactor* r = Slave(i);
			BOOL succeed = false;
			if (r) {
				if (parent->SuperClassID()==BASENODE_CLASS_ID)
					succeed = r->reactTo(parent, GetCOREInterface()->GetTime(), false);
				else
					succeed = r->reactTo((ReferenceTarget*)parent->SubAnim(subAnim), GetCOREInterface()->GetTime(), false);

				if (succeed)
					r->CreateReactionAndReturn(true, NULL, GetCOREInterface()->GetTime(), defaultID);
				else
					return;
			}
		}
	NotifyDependents(FOREVER, PART_ALL, REFMSG_SUBANIM_STRUCTURE_CHANGED);
	}
	else
	{
		NotifyDependents(FOREVER, PART_ALL, REFMSG_SUBANIM_STRUCTURE_CHANGED);
		MaybeAutoDelete();
	}
}

class ReactionSetPostLoadCallback : public PostLoadCallback {
	ReactionSet* mSet;
	public:
		ReactionSetPostLoadCallback(ReactionSet* s) { mSet = s; }
		int Priority() { return 3; }  
		// CleanUpReactionSet removes null slaves from the slaves list
		int CleanUpReactionSet(ReactionSet* in_set) {
			int nbCleaned = 0;
			if (in_set) {
				for (int i = in_set->SlaveCount() - 1; i >= 0; i--) {
					if (!in_set->Slave(i)) {
						in_set->RemoveSlave(i);
						nbCleaned++;
					}
				}
			}
			return nbCleaned;
		}
		void proc(ILoad *iload)
		{
			CleanUpReactionSet(mSet);
			GetReactionManager()->AddReactionSet(mSet);
		}
	};

#define SLAVE_COUNT_CHUNK		0x5001

IOResult ReactionSet::Save(ISave *isave)
{		
	ULONG 	nb;

	isave->BeginChunk(SLAVE_COUNT_CHUNK);
	int count = mSlaves.Count();
	isave->Write(&count, sizeof(int), &nb);
 	isave->EndChunk();

	return IO_OK;
}

IOResult ReactionSet::Load(ILoad *iload)
	{
	ULONG 	nb;
	int id;

	while (iload->OpenChunk()==IO_OK) {
		switch (id = iload->CurChunkID()) {
			case SLAVE_COUNT_CHUNK:
				{
				int count = 0;
				iload->Read(&count, sizeof(int), &nb);
				mSlaves.SetCount(count);
				for(int i = 0; i < count; i++)
					mSlaves[i] = NULL;

				break;
				}
		}
		iload->CloseChunk();
	}

	ReactionSetPostLoadCallback *plc = new ReactionSetPostLoadCallback(this);
	iload->RegisterPostLoadCallback(plc);

	return IO_OK;
}

void AddReactionMgrToScene()
{
	Interface *ip = GetCOREInterface();
	if (ip == NULL)
		return;

	ITrackViewNode* tvRoot = ip->GetTrackViewRootNode();
	if (tvRoot->FindItem(REACTION_MGR_CLASSID) < 0)
		tvRoot->AddController(GetReactionManager(), _T("Reaction Manager"), REACTION_MGR_CLASSID);
}

///*****************************************************************
/// Class descriptors
///*****************************************************************

class ReactionManagerClassDesc:public ClassDesc2 {
	public:
	ReactionManagerClassDesc(){ AddReactionMgrToScene(); }

	int 			IsPublic() { return FALSE; }
	void *			Create(BOOL loading) 
					{ 
						return GetReactionManager(); 
					}
	const TCHAR *	ClassName() { return GetString(IDS_AF_REACTION_MANAGER); }
	SClass_ID		SuperClassID() { return REF_MAKER_CLASS_ID; }
	Class_ID		ClassID() { return REACTION_MGR_CLASSID; }
	const TCHAR* 	Category() { return _T("");  }

	const TCHAR*	InternalName() { return _T("ReactionManager"); }	// returns fixed parsable name (scripter-visible name)
	HINSTANCE		HInstance() { return hInstance; }					// returns owning module handle
	void			ResetClassParams(BOOL fileReset) 
		{ 
		}

	int             NumActionTables() { return 1; }
	ActionTable*	GetActionTable(int i) { return GetActions(); }

	};

class ReactionSetClassDesc:public ClassDesc2 {
	public:
	int 			IsPublic() { return FALSE; }
	void *			Create(BOOL loading) 
					{ 
						return new ReactionSet(); 
					}
	const TCHAR *	ClassName() { return GetString(IDS_AF_REACTION_SET); }
	SClass_ID		SuperClassID() { return REF_MAKER_CLASS_ID; }
	Class_ID		ClassID() { return REACTIONSET_CLASSID; }
	const TCHAR* 	Category() { return _T("");  }

	const TCHAR*	InternalName() { return _T("ReactionSet"); }	// returns fixed parsable name (scripter-visible name)
	HINSTANCE		HInstance() { return hInstance; }					// returns owning module handle
	};

static ReactionManagerClassDesc reactionMgrCD;
static ReactionSetClassDesc reactionSetCD;

ClassDesc* GetReactionManagerDesc() { return &reactionMgrCD; }
ClassDesc* GetReactionSetDesc() { return &reactionSetCD; }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    //**************************************************************************/
// Copyright (c) 1998-2006 Autodesk, Inc.
// All rights reserved.
// 
// These coded instructions, statements, and computer programs contain
// unpublished proprietary information written by Autodesk, Inc., and are
// protected by Federal copyright law. They may not be disclosed to third
// parties or copied or duplicated in any form, in whole or in part, without
// the prior written consent of Autodesk, Inc.
//**************************************************************************/
// DESCRIPTION: These are uv data
// AUTHOR: Peter Watje
// DATE: 2006/10/07 
//***************************************************************************/

#ifndef __TVDATA__H
#define __TVDATA__H


#include "Point3.h"
#include "ioapi.h"
#include "iunwrap.h"
#include <Util/StaticAssert.h>
#define FLAG_PINNED	32

class UnwrapMod;

//PELT
class UVWHitData
{
public:
	int index;
	float dist;
};

class UVW_TVFaceOldClass
{
public:
int t[4];
int FaceIndex;
int MatID;
int flags;
Point3 pt[4];
};
//this is the Max9 format we need to keep it to load older files
class UVW_TVVertClass_Max9
{
	// Warning - instances of this class are saved as a binary blob to scene file
	// Adding/removing members will break file i/o
public:
	 UVW_TVVertClass_Max9() 
	{
		p = Point3(0.0f,0.0f,0.0f);
		flags = 0;
		influence = 0.0f;
	}

	Point3 p;
	float influence;	
	BYTE flags;
};

// compile-time validates size of UVW_TVVertClass_Max9 class to ensure its size doesn't change since instances are 
// saved as a binary blob to scene file. Changes in size will break file i/o
class UVW_TVVertClass_Max9SizeValidator {
	UVW_TVVertClass_Max9SizeValidator() {}  // not creatable
	MaxSDK::Util::StaticAssert< (sizeof(UVW_TVVertClass_Max9) == sizeof(Point3)+sizeof(float)+sizeof(BYTE)+3) > validator; // 3 bytes padding
};

class UVW_TVVectorClass
{
public:
//index into the texture list
	int handles[8];
	int interiors[4];
//index into the geometric list
	int vhandles[8];
	int vinteriors[4];

	UVW_TVVectorClass()
		{
		for (int i = 0; i < 4; i++)
			{
			interiors[i] = -1;
			vinteriors[i] = -1;
			}
		for (int i = 0; i < 8; i++)
			{
			handles[i] = -1;
			vhandles[i] = -1;
			}

		}


};


class UVW_TVFaceClass
{
public:

//index into the texture vertlist
	int *t;
	int FaceIndex;
	int MatID;
	int flags;
//count of number of vertex currently can only 3 or 4 but with poly objects this will change
	int count;
//index into the geometric vertlist
	int *v;
	UVW_TVVectorClass *vecs;

	UVW_TVFaceClass()
		{
		count = 3;
		flags = 0;
		vecs = NULL;
		t = NULL;
		v = NULL;
		}
	~UVW_TVFaceClass()
		{
		if (vecs) delete vecs;
		vecs = NULL;
		if (t) delete [] t;
		t = NULL;
		if (v) delete [] v;
		t = NULL;

		}
	UVW_TVFaceClass* Clone();
	void DeleteVec();
	int FindGeomEdge(int a, int b);
	int FindUVEdge(int a, int b);

	ULONG SaveFace(ISave *isave);
	ULONG SaveFace(FILE *file);


	ULONG LoadFace(ILoad *iload);
	ULONG LoadFace(FILE *file);

	void GetConnectedUVVerts(int a, int &v1, int &v2);
	void GetConnectedGeoVerts(int a, int &v1, int &v2);
	int GetGeoVertIDFromUVVertID(int uvID);

};



//need a table of TVert pointers
class UVW_TVVertClass
{
public:
	UVW_TVVertClass() 
	{
		p = Point3(0.0f,0.0f,0.0f);
		flags = 0;
		influence = 0.0f;
		mControllerID = -1;
	}

	Point3 GetP() {return p;}
	void SetP(Point3 pos ) { p = pos; }

	float GetInfluence() {return influence;}
	void  SetInfluence(float v) { influence = v; }
	
	BYTE GetFlag() {return flags; }
	void SetFlag(BYTE flg) {flags = flg; }
	void OrFlag(BYTE flg) {flags |= flg; }
	void AnfFlag(BYTE flg) {flags &= flg; }

	BOOL IsDead() { return flags & FLAG_DEAD;}
	void SetDead() { flags |= FLAG_DEAD;}
	void SetAlive() { flags &= ~FLAG_DEAD;}


	BOOL IsHidden() { return flags & FLAG_HIDDEN;}
	void Hide() { flags |= FLAG_HIDDEN;}
	void Show() { flags &= ~FLAG_HIDDEN;}


	BOOL IsFrozen() { return flags & FLAG_FROZEN;}
	void Freeze() { flags |= FLAG_FROZEN;}
	void Unfreeze() { flags &= ~FLAG_FROZEN;}

	int GetControlID() { return mControllerID; }
	void SetControlID(int id) { mControllerID = id; }

	BOOL IsWeightModified() { return flags & FLAG_WEIGHTMODIFIED;}
	void SetWeightModified() { flags |= FLAG_WEIGHTMODIFIED;}
	void SetWeightUnModified() { flags &= ~FLAG_WEIGHTMODIFIED;}


	BOOL IsPinned() { return flags & FLAG_PINNED;}
	void Pin() { flags |= FLAG_PINNED;}
	void Unpin() { flags &= ~FLAG_PINNED;}

	BOOL IsRigPoint() { return flags & FLAG_RIGPOINT;}
	void SetRigPoint(BOOL val)
	{ 
		if (val)
			flags |= FLAG_RIGPOINT;
		else
			flags &= ~FLAG_RIGPOINT;

	}


private:
	// Warning - instances of this class are saved as a binary blob to scene file
	// Adding/removing members will break file i/o
	Point3 p;
	float influence;
	int  mControllerID;
	BYTE flags;
};

// compile-time validates size of UVW_TVVertClass class to ensure its size doesn't change since instances are 
// saved as a binary blob to scene file. Changes in size will break file i/o
class UVW_TVVertClassSizeValidator {
	UVW_TVVertClassSizeValidator() {}  // not creatable
	MaxSDK::Util::StaticAssert< (sizeof(UVW_TVVertClass) == sizeof(Point3)+sizeof(float)+sizeof(int)+sizeof(BYTE)+3) > validator; // 3 bytes padding
};

//need a table of edgs
class UVW_TVEdgeDataClass
{
public:
//indices into the vert list
	int a,avec;
	int b,bvec;
	int flags;
	int lookupIndex;
	
	int ga,gb;
	
	Tab<int> faceList;

	UVW_TVEdgeDataClass()
		{
			ga = -1;
			gb = -1;
		}
	~UVW_TVEdgeDataClass()
		{
		}
};

class UVW_TVEdgeClass
	{
public:
	Tab<UVW_TVEdgeDataClass*> data;
	BYTE flags;
	};

//Pelt
class EData
{
public:
	int edgeIndex;
	int vertexIndex;
};

class AdjacentItem
{
public:
	Tab<int> index;
};

class VConnections
{
public:
	VConnections *closestNode;          //parent for th dystraka algorithm
	float accumDist;
	BOOL solved;
	int vid;
	Tab<EData> connectingVerts;
	//these is used for our priority list for the unsolved nodes
	VConnections *linkedListChild; //child for the linked list
	VConnections *linkedListParent; //parent for the linked list
};

/***************************************************************************************************
This class just contains a list of all controllers for the Unwrap, this may span several local
mod data since we store the controlles in the modifier
****************************************************************************************************/
class UVW_VertexControllerClass
{
public:
	Tab<Control*> cont;	//just a table of point3 controllers, the local mod data holds indices into this list
};

/***************************************************************************************************
This class contains all our UVWs and geometric information we need to generate the UVWs data.  It is 
mish/mash of mesh/poly/patch data since we support all 3 types.
****************************************************************************************************/
class UVW_ChannelClass
{
public:
	//Destructor / Destructor
	UVW_ChannelClass();
	~UVW_ChannelClass();

	int channel;

	Tab<UVW_TVVertClass> v;
	Tab<UVW_TVFaceClass*> f;

	Tab<UVW_TVEdgeClass*> e;
	Tab<UVW_TVEdgeDataClass*> ePtrList;
	
	//PELT
	//geo edge data
	Tab<UVW_TVEdgeClass*> ge;				
	Tab<UVW_TVEdgeDataClass*> gePtrList;


		
	Tab<Point3> geomPoints;

	//these 2 methods are just for backwards compatibility to max9 from max9.5
	ULONG SaveFacesMax9(ISave *isave);
	ULONG LoadFacesMax9(ILoad *iload);


	ULONG LoadFaces(ILoad *iload);
	ULONG LoadFaces(FILE *file);

	ULONG SaveFaces(ISave *isave);
	ULONG SaveFaces(FILE *file);


	void SetCountFaces(int newct);

	void CloneFaces(Tab<UVW_TVFaceClass*> &t);
	void AssignFaces(Tab<UVW_TVFaceClass*> &t);
	void FreeFaces();
	void Dump();

	void MarkDeadVertices();

	BOOL edgesValid;
	BOOL mGeoEdgesValid;
	void FreeEdges();
	void BuildEdges();

	void FreeGeomEdges();
	void BuildGeomEdges();
	
	// As cer report in MAXX-6848, it is hard to repro the crash and the minidump info is less. Here I add "count" parameter
	// which records the count of "Tab<UVW_TVEdgeClass*> &e" in "AppendEdge" function to get more info in the minidump.
	void AppendEdge(Tab<UVW_TVEdgeClass*> &e,int index1,int vec1, int index2,int vec2, int face, BOOL hidden, int count/*number of TV edges*/, int gva=-1, int gvb=-1);
	void EdgeListFromPoints(Tab<int> &selEdges, int a, int b, Point3 vec);
	int GetNextEdge(int currentEdgeIndex, int cornerVert, int currentFace);
	void SplitUVEdges(BitArray esel);
	//give 2 geo points find the geo edge for them
	//returns -1 if no valid edge found
	int FindGeoEdge(int a, int b);

	//give 2 uv points find the uv edge for them
	//returns -1 if no valid edge found
	int FindUVEdge(int a, int b);

	float LineToPoint(Point3 p1, Point3 l1, Point3 l2);
	int EdgeIntersect(Point3 p, float threshold, int i1, int i2);

	float edgeScale;

	void BuildAdjacentUVEdgesToVerts(Tab<AdjacentItem*> &verts);
	void BuildAdjacentGeomEdgesToVerts(Tab<AdjacentItem*> &verts);
	
	void BuildAdjacentUVFacesToVerts(Tab<AdjacentItem*> &verts);

	Point3 UVFaceNormal(int index);
	Point3 GeomFaceNormal(int index);

	Matrix3 MatrixFromGeoFace(int index);
	Matrix3 MatrixFromUVFace(int index);

	void LoadOlderVersions(ILoad *iload);
	void ResolveOldData(UVW_ChannelClass &oldData);

	//this is a list of all our system locked vertices, we cannot change these vertices
	//these are typically when you have a selection flowing up the stack, we cannot change
	//any of the vertices that are not selected.  So we set this flag for those verts
	BitArray mSystemLockedFlag;

};


class VertexLookUpDataClass
{
public:
int index;
int newindex;
Point3 p;

};
class VertexLookUpListClass
{
public:
BitArray sel;
Tab<VertexLookUpDataClass> d;
void addPoint(int a_index, Point3 a);
};

class VEdges
{
public:
	Tab<int> edgeIndex;
};


class GTVData
{
public:
	int gIndex;
	int tIndex;
};

class GeomToTVEdges
{
public:
	Tab<GTVData> edgeInfo;
};

class EdgeVertInfo
{
public:
	int faceIndex;

	int uvIndexP;
	int geoIndexP;

	int uvIndexA;
	int geoIndexA;


	int uvIndexN;
	int geoIndexN;

	float angle;

	Point3 idealPos;
	Point3 idealPosNormalized;
	Point3 tempPos;
	Point3 tempPos2;
	
	
};

class ClusterInfo
{
public:
	int uvCenterIndex;
	int geoCenterIndex;
	float angle;	
	float counterAngle;	
	Point3 delta;
	Tab<EdgeVertInfo> edgeVerts;
};

class MyPoint3Tab
{
public:
	Tab<Point3> p;
};


class BXPInterpData
{
public:
	BXPInterpData()
	{
		x = 0.0f;
		y = 0.0f;
		
		pos = Point3(0.0f,0.0f,0.0f);
		color = Point3(0.0f,0.0f,0.0f);
		normal = Point3(0.0f,0.0f,0.0f);

	}
	float x,y;
	Point3 pos;
	Point3 color;
	Point3 normal;
	int IntX()
	{
		int ix0 = x;
		if (x - floor(x) >= 0.5f) ix0 += 1;
		return ix0;
	}
	int IntY()
	{
		int ix0 = y;
		if (y - floor(y) >= 0.5f) ix0 += 1;
		return ix0;
	}


	BXPInterpData operator-(const BXPInterpData& v) 
	const 
	{
		BXPInterpData temp;
		temp.x = x-v.x;
		temp.y = x-v.y;
		temp.pos = pos-v.pos;
		temp.color = color-v.color;
		temp.normal = normal-v.normal;
		return temp;
	}

	BXPInterpData operator+(const BXPInterpData& v) 
	const 
	{
		BXPInterpData temp;
		temp.x = x+v.x;
		temp.y = x+v.y;
		temp.pos = pos+v.pos;
		temp.color = color+v.color;
		temp.normal = normal+v.normal;
		return temp;
	}

	BXPInterpData operator/(const BXPInterpData& v) 
	const 
	{
		BXPInterpData temp;
		temp.x = x/v.x;
		temp.y = x/v.y;
		temp.pos = pos/v.pos;
		temp.color = color/v.color;
		temp.normal = normal/v.normal;
		return temp;
	}

	BXPInterpData operator/(const float &v) 
	const 
	{
		BXPInterpData temp;
		if (v != 0.0f)
		{
			temp.x = x/v;
			temp.y = x/v;
			temp.pos = pos/v;
			temp.color = color/v;
			temp.normal = normal/v;
		}
		else
		{
			temp.x = x;
			temp.y = x;
			temp.pos = pos;
			temp.color = color;
			temp.normal = normal;
		}
		return temp;
	}

};


#endif // __UWNRAP__H
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Copyright 1998-2018 Epic Games, Inc. All Rights Reserved.
/*===========================================================================
	Generated code exported from UnrealHeaderTool.
	DO NOT modify this manually! Edit the corresponding .h files instead!
===========================================================================*/

#include "UObject/ObjectMacros.h"
#include "UObject/ScriptMacros.h"

PRAGMA_DISABLE_DEPRECATION_WARNINGS
#ifdef ENGINE_GameInstance_generated_h
#error "GameInstance.generated.h already included, missing '#pragma once' in GameInstance.h"
#endif
#define ENGINE_GameInstance_generated_h

#define Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_RPC_WRAPPERS \
 \
	DECLARE_FUNCTION(execDebugRemovePlayer) \
	{ \
		P_GET_PROPERTY(UIntProperty,Z_Param_ControllerId); \
		P_FINISH; \
		P_NATIVE_BEGIN; \
		P_THIS->DebugRemovePlayer(Z_Param_ControllerId); \
		P_NATIVE_END; \
	} \
 \
	DECLARE_FUNCTION(execDebugCreatePlayer) \
	{ \
		P_GET_PROPERTY(UIntProperty,Z_Param_ControllerId); \
		P_FINISH; \
		P_NATIVE_BEGIN; \
		P_THIS->DebugCreatePlayer(Z_Param_ControllerId); \
		P_NATIVE_END; \
	}


#define Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_RPC_WRAPPERS_NO_PURE_DECLS \
 \
	DECLARE_FUNCTION(execDebugRemovePlayer) \
	{ \
		P_GET_PROPERTY(UIntProperty,Z_Param_ControllerId); \
		P_FINISH; \
		P_NATIVE_BEGIN; \
		P_THIS->DebugRemovePlayer(Z_Param_ControllerId); \
		P_NATIVE_END; \
	} \
 \
	DECLARE_FUNCTION(execDebugCreatePlayer) \
	{ \
		P_GET_PROPERTY(UIntProperty,Z_Param_ControllerId); \
		P_FINISH; \
		P_NATIVE_BEGIN; \
		P_THIS->DebugCreatePlayer(Z_Param_ControllerId); \
		P_NATIVE_END; \
	}


#define Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_EVENT_PARMS \
	struct GameInstance_eventHandleNetworkError_Parms \
	{ \
		TEnumAsByte<ENetworkFailure::Type> FailureType; \
		bool bIsServer; \
	}; \
	struct GameInstance_eventHandleTravelError_Parms \
	{ \
		TEnumAsByte<ETravelFailure::Type> FailureType; \
	};


#define Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_CALLBACK_WRAPPERS
#define Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_INCLASS_NO_PURE_DECLS \
private: \
	static void StaticRegisterNativesUGameInstance(); \
	friend struct Z_Construct_UClass_UGameInstance_Statics; \
public: \
	DECLARE_CLASS(UGameInstance, UObject, COMPILED_IN_FLAGS(0 | CLASS_Transient), CASTCLASS_None, TEXT("/Script/Engine"), NO_API) \
	DECLARE_SERIALIZER(UGameInstance) \
	static const TCHAR* StaticConfigName() {return TEXT("Game");} \



#define Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_INCLASS \
private: \
	static void StaticRegisterNativesUGameInstance(); \
	friend struct Z_Construct_UClass_UGameInstance_Statics; \
public: \
	DECLARE_CLASS(UGameInstance, UObject, COMPILED_IN_FLAGS(0 | CLASS_Transient), CASTCLASS_None, TEXT("/Script/Engine"), NO_API) \
	DECLARE_SERIALIZER(UGameInstance) \
	static const TCHAR* StaticConfigName() {return TEXT("Game");} \



#define Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_STANDARD_CONSTRUCTORS \
	/** Standard constructor, called after all reflected properties have been initialized */ \
	NO_API UGameInstance(const FObjectInitializer& ObjectInitializer = FObjectInitializer::Get()); \
	DEFINE_DEFAULT_OBJECT_INITIALIZER_CONSTRUCTOR_CALL(UGameInstance) \
	DECLARE_VTABLE_PTR_HELPER_CTOR(NO_API, UGameInstance); \
DEFINE_VTABLE_PTR_HELPER_CTOR_CALLER(UGameInstance); \
private: \
	/** Private move- and copy-constructors, should never be used */ \
	NO_API UGameInstance(UGameInstance&&); \
	NO_API UGameInstance(const UGameInstance&); \
public:


#define Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_ENHANCED_CONSTRUCTORS \
	/** Standard constructor, called after all reflected properties have been initialized */ \
	NO_API UGameInstance(const FObjectInitializer& ObjectInitializer = FObjectInitializer::Get()) : Super(ObjectInitializer) { }; \
private: \
	/** Private move- and copy-constructors, should never be used */ \
	NO_API UGameInstance(UGameInstance&&); \
	NO_API UGameInstance(const UGameInstance&); \
public: \
	DECLARE_VTABLE_PTR_HELPER_CTOR(NO_API, UGameInstance); \
DEFINE_VTABLE_PTR_HELPER_CTOR_CALLER(UGameInstance); \
	DEFINE_DEFAULT_OBJECT_INITIALIZER_CONSTRUCTOR_CALL(UGameInstance)


#define Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_PRIVATE_PROPERTY_OFFSET \
	FORCEINLINE static uint32 __PPO__LocalPlayers() { return STRUCT_OFFSET(UGameInstance, LocalPlayers); } \
	FORCEINLINE static uint32 __PPO__OnlineSession() { return STRUCT_OFFSET(UGameInstance, OnlineSession); } \
	FORCEINLINE static uint32 __PPO__ReferencedObjects() { return STRUCT_OFFSET(UGameInstance, ReferencedObjects); }


#define Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_114_PROLOG \
	Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_EVENT_PARMS


#define Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_GENERATED_BODY_LEGACY \
PRAGMA_DISABLE_DEPRECATION_WARNINGS \
public: \
	Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_PRIVATE_PROPERTY_OFFSET \
	Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_RPC_WRAPPERS \
	Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_CALLBACK_WRAPPERS \
	Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_INCLASS \
	Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_STANDARD_CONSTRUCTORS \
public: \
PRAGMA_ENABLE_DEPRECATION_WARNINGS


#define Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_GENERATED_BODY \
PRAGMA_DISABLE_DEPRECATION_WARNINGS \
public: \
	Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_PRIVATE_PROPERTY_OFFSET \
	Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_RPC_WRAPPERS_NO_PURE_DECLS \
	Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_CALLBACK_WRAPPERS \
	Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_INCLASS_NO_PURE_DECLS \
	Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h_117_ENHANCED_CONSTRUCTORS \
static_assert(false, "Unknown access specifier for GENERATED_BODY() macro in class GameInstance."); \
PRAGMA_ENABLE_DEPRECATION_WARNINGS


#undef CURRENT_FILE_ID
#define CURRENT_FILE_ID Engine_Source_Runtime_Engine_Classes_Engine_GameInstance_h


PRAGMA_ENABLE_DEPRECATION_WARNINGS
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         // Copyright 1998-2017 Epic Games, Inc. All Rights Reserved.

using System.IO;
using UnrealBuildTool;

public class GoogleVR : ModuleRules
{
	public GoogleVR(TargetInfo Target)
	{
		Type = ModuleType.External;

		string GoogleVRSDKDir = UEBuildConfiguration.UEThirdPartySourceDirectory + "GoogleVR/";
		PublicSystemIncludePaths.AddRange(
			new string[] {
					GoogleVRSDKDir + "include",
					GoogleVRSDKDir + "include/vr/gvr/capi/include",
				}
			);

		string GoogleVRBaseLibPath = GoogleVRSDKDir + "lib/";

		if (Target.Platform == UnrealTargetPlatform.Mac)
		{
			PublicAdditionalLibraries.Add(GoogleVRBaseLibPath+"mac/libgvr.a");
			PublicAdditionalLibraries.Add(GoogleVRBaseLibPath+"mac/libgvraux.a");
		}

		else if (Target.Platform == UnrealTargetPlatform.Win32)
		{
			PublicAdditionalLibraries.Add(GoogleVRBaseLibPath+"win32/libgvr.lib");
			PublicAdditionalLibraries.Add(GoogleVRBaseLibPath+"win32/libgvraux.lib");
		}

		else if (Target.Platform == UnrealTargetPlatform.Win64)
		{
			PublicAdditionalLibraries.Add(GoogleVRBaseLibPath+"win64/libgvr.lib");
			PublicAdditionalLibraries.Add(GoogleVRBaseLibPath+"win64/libgvraux.lib");
		}

		else if (Target.Platform == UnrealTargetPlatform.Android)
		{
			string GoogleVRArmLibPath = GoogleVRBaseLibPath + "android_arm/";
			string GoogleVRArm64LibPath = GoogleVRBaseLibPath + "android_arm64/";
			string GoogleVRx86LibPath = GoogleVRBaseLibPath + "android_x86/";
			string GoogleVRx86_64LibPath = GoogleVRBaseLibPath + "android_x86_64/";

			// toolchain will filter properly
			PublicLibraryPaths.Add(GoogleVRArmLibPath);
			PublicLibraryPaths.Add(GoogleVRArm64LibPath);
			PublicLibraryPaths.Add(GoogleVRx86LibPath);
			PublicLibraryPaths.Add(GoogleVRx86_64LibPath);

			PublicAdditionalLibraries.Add("gvr");
		}
		else if (Target.Platform == UnrealTargetPlatform.IOS)
		{
			string GoogleVRIOSLibPath = GoogleVRBaseLibPath + "ios/";
			PublicLibraryPaths.Add(GoogleVRIOSLibPath);

			// Frameworks that GoogleVR frame depends on
			PublicAdditionalFrameworks.Add(new UEBuildFramework("CoreText"));
			PublicAdditionalFrameworks.Add(new UEBuildFramework("AudioToolbox"));
			PublicAdditionalFrameworks.Add(new UEBuildFramework("AVFoundation"));
			PublicAdditionalFrameworks.Add(new UEBuildFramework("CoreGraphics"));
			PublicAdditionalFrameworks.Add(new UEBuildFramework("CoreMotion"));
			PublicAdditionalFrameworks.Add(new UEBuildFramework("CoreVideo"));
			PublicAdditionalFrameworks.Add(new UEBuildFramework("GLKit"));
			PublicAdditionalFrameworks.Add(new UEBuildFramework("MediaPlayer"));
			PublicAdditionalFrameworks.Add(new UEBuildFramework("OpenGLES"));
			PublicAdditionalFrameworks.Add(new UEBuildFramework("QuartzCore"));

			// GoogleVR framework.
			// Note: Had to add 5 times because there are 5 different resource bundles and there doesn't seem to be support for
			//       just adding resource bundles on iOS
			PublicAdditionalFrameworks.Add(
				new UEBuildFramework(
					"GVRSDK",														// Framework name
					"lib/ios/ThirdPartyFrameworks/GVRSDK.embeddedframework.zip",			// Zip name
					"GVRSDK.framework/Resources/GoogleKitCore.bundle"				// Resources we need copied and staged
				)
			);
			PublicAdditionalFrameworks.Add(
				new UEBuildFramework(
					"GVRSDK",														// Framework name
					"lib/ios/ThirdPartyFrameworks/GVRSDK.embeddedframework.zip",			// Zip name
					"GVRSDK.framework/Resources/GoogleKitDialogs.bundle"			// Resources we need copied and staged
				)
			);
			PublicAdditionalFrameworks.Add(
				new UEBuildFramework(
					"GVRSDK",														// Framework name
					"lib/ios/ThirdPartyFrameworks/GVRSDK.embeddedframework.zip",			// Zip name
					"GVRSDK.framework/Resources/CardboardSDK.bundle"				// Resources we need copied and staged
				)
			);
			PublicAdditionalFrameworks.Add(
				new UEBuildFramework(
					"GVRSDK",														// Framework name
					"lib/ios/ThirdPartyFrameworks/GVRSDK.embeddedframework.zip",			// Zip name
					"GVRSDK.framework/Resources/GoogleKitHUD.bundle"				// Resources we need copied and staged
				)
			);
			PublicAdditionalFrameworks.Add(
				new UEBuildFramework(
					"GVRSDK",														// Framework name
					"lib/ios/ThirdPartyFrameworks/GVRSDK.embeddedframework.zip",			// Zip name
					"GVRSDK.framework/Resources/MaterialRobotoFontLoader.bundle"	// Resources we need copied and staged
				)
			);
		}
	}
}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       #include <p16f917.inc>
#include lcd.inc

	__CONFIG    _CP_OFF & _CPD_OFF & _BOD_OFF & _PWRTE_ON & _WDT_OFF & _INTRC_OSC_NOCLKOUT & _MCLRE_ON & _FCMEN_OFF & _IESO_OFF

	errorlevel -302		; supress "register not in bank0, check page bits" message

; Pin Declarations
#define	POT		PORTA,0
#define	BEMF	PORTA,5
#define	N2		PORTD,2
#define	P1		PORTD,7


; Variable Declarations
bank0	udata
DutyCycle		res 1
BackEMFValue	res .64
Math_High		res 1
Math_Low		res	1
RPM_High		res	1
RPM_Low			res 1
Counter			res 1
Pointer			res 1
TimeKeeper		res 1

; These variables are required for the BinaryToBCD routine (take from AN526)
count 		res 1
temp		res 1
H_byte  	res	1
L_byte  	res 1
R0          res 1
R1      	res 1
R2      	res 1






                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   0 &  xterm-xfree86|xterm terminal emulator (XFree86)                              P    @        & * . 9 J L P W Y f j n x |                     !'-39?CHLQVZ^fnwORTX$,4<DINSX`hpx	\[Z   [%i%p1%d;%p2%dr [3g [H[2J [K [J [%i%p1%dG [%i%p1%d;%p2%dH 
 [H [?25l  [?12l[?25h [C [A [?12;25h [P [M  [5m [1m [?1049h [4h [8m [7m [7m [4m [%p1%dX  [m [?1049l [4l [27m [24m [?5h$<100/>[?5l [!p[?3;4l[4l> [L  [3~ OB OP [21~ OQ OR OS [15~ [17~ [18~ [19~ [20~ OH [2~ OD [6~ [5~ OC OA [?1l> [?1h= [%p1%dP [%p1%dM [%p1%dB [%p1%d@ [%p1%dS [%p1%dL [%p1%dD [%p1%dC [%p1%dT [%p1%dA [i [4i [5i c [!p[?3;4l[4l> 8 [%i%p1%dd 7 
 M [0%?%p6%t;1%;%?%p2%t;4%;%?%p1%p3%|%t;7%;%?%p4%t;5%;%?%p7%t;8%;m%?%p9%t%e%; H 	 OE ``aaffggiijjkkllmmnnooppqqrrssttuuvvwwxxyyzz{{||}}~~ [Z [?7h [?7l (B)0 OF OM [3;2~ [1;2F [1;2H [2;2~ [1;2D [6;2~ [5;2~ [1;2C [23~ [24~ O2P O2Q O2R O2S [15;2~ [17;2~ [18;2~ [19;2~ [20;2~ [21;2~ [23;2~ [24;2~ O5P O5Q O5R O5S [15;5~ [17;5~ [18;5~ [19;5~ [20;5~ [21;5~ [23;5~ [24;5~ O6P O6Q O6R O6S [15;6~ [17;6~ [18;6~ [19;6~ [20;6~ [21;6~ [23;6~ [24;6~ [1K [%i%d;%dR [6n [?1;2c [c [39;49m [3%?%p1%{1}%=%t4%e%p1%{3}%=%t6%e%p1%{4}%=%t1%e%p1%{6}%=%t3%e%p1%d%;m [4%?%p1%{1}%=%t4%e%p1%{3}%=%t6%e%p1%{4}%=%t1%e%p1%{6}%=%t3%e%p1%d%;m [M [3%p1%dm [4%p1%dm l m      5          	     ! Ox Ot Ov Or AX XT TS kEND5 kHOM5 ka2 kb1 kb3 kc2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      /****************************************************************************
**
** Copyright (C) 2016 The Qt Company Ltd.
** Contact: https://www.qt.io/licensing/
**
** This file is part of the Qt Charts module of the Qt Toolkit.
**
** $QT_BEGIN_LICENSE:GPL$
** Commercial License Usage
** Licensees holding valid commercial Qt licenses may use this file in
** accordance with the commercial license agreement provided with the
** Software or, alternatively, in accordance with the terms contained in
** a written agreement between you and The Qt Company. For licensing terms
** and conditions see https://www.qt.io/terms-conditions. For further
** information use the contact form at https://www.qt.io/contact-us.
**
** GNU General Public License Usage
** Alternatively, this file may be used under the terms of the GNU
** General Public License version 3 or (at your option) any later version
** approved by the KDE Free Qt Foundation. The licenses are as published by
** the Free Software Foundation and appearing in the file LICENSE.GPL3
** included in the packaging of this file. Please review the following
** information to ensure the GNU General Public License requirements will
** be met: https://www.gnu.org/licenses/gpl-3.0.html.
**
** $QT_END_LICENSE$
**
****************************************************************************/

//  W A R N I N G
//  -------------
//
// This file is not part of the Qt Chart API.  It exists purely as an
// implementation detail.  This header file may change from version to
// version without notice, or even be removed.
//
// We mean it.

#ifndef XLOGYPOLARDOMAIN_H
#define XLOGYPOLARDOMAIN_H
#include <private/polardomain_p.h>
#include <QtCharts/private/qchartglobal_p.h>
#include <QtCore/QRectF>
#include <QtCore/QSizeF>

QT_CHARTS_BEGIN_NAMESPACE

class QT_CHARTS_PRIVATE_EXPORT XLogYPolarDomain: public PolarDomain
{
    Q_OBJECT
public:
    explicit XLogYPolarDomain(QObject *object = 0);
    virtual ~XLogYPolarDomain();

    DomainType type() { return AbstractDomain::XLogYPolarDomain; }

    void setRange(qreal minX, qreal maxX, qreal minY, qreal maxY);

    friend bool Q_AUTOTEST_EXPORT operator== (const XLogYPolarDomain &domain1, const XLogYPolarDomain &domain2);
    friend bool Q_AUTOTEST_EXPORT operator!= (const XLogYPolarDomain &domain1, const XLogYPolarDomain &domain2);
    friend QDebug Q_AUTOTEST_EXPORT operator<<(QDebug dbg, const XLogYPolarDomain &domain);

    void zoomIn(const QRectF &rect);
    void zoomOut(const QRectF &rect);
    void move(qreal dx, qreal dy);

    QPointF calculateDomainPoint(const QPointF &point) const;

    bool attachAxis(QAbstractAxis *axis);
    bool detachAxis(QAbstractAxis *axis);

public Q_SLOTS:
    void handleVerticalAxisBaseChanged(qreal baseY);

protected:
    qreal toAngularCoordinate(qreal value, bool &ok) const;
    qreal toRadialCoordinate(qreal value, bool &ok) const;

private:
    qreal m_logInnerY;
    qreal m_logOuterY;
    qreal m_logBaseY;
};

QT_CHARTS_END_NAMESPACE

#endif // XLOGYPOLARDOMAIN_H
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 *`           hB1AF.   2O~J6   `    None                 {   &  I     U      [   'OD7   {         (10    ++UE4+Main            ++UE4+Main         9     $             ` .   /Game/Mannequin/Animations/ThirdPerson_AnimBP \,   /Game/Mannequin/Character/Mesh/SK_Mannequin K4   /Game/ThirdPersonBP/Blueprints/ThirdPersonCharacter *   /Script/BlueprintGraph |D   /Script/CoreUObject I->   /Script/Engine @I   /Script/InputCore T3   /Script/UnrealEd ,   Actor -#Y   ActorLabel r_   AddControllerPitchInput rt   AddControllerYawInput    AddMovementInput !2}   AgentHeight    AgentRadius 7sZ   AirControl  :e	   AllNodes B   AnimBlueprintGeneratedClass ;
   AnimClass F   ArrayProperty Ii   Arrow t   ArrowComponent UTf>   AttachParent .   AttachToName 0
   AxisValue o
   bAllowDeletion    BaseLookUpRate /   BaseTurnRate    bCommentBubbleVisible Q$<<   bConsumeInput B   bEnforceConstCorrectness    bExecuteWhenPaused h0C   bIsConstFunc 9   bIsParentComponentNative WAmw   bIsPureFunc O%   bLegacyGeneratedClassIsAuthoritative tua   bLegacyNeedToPurgeSkelRefs \;
   Blueprint 93   BlueprintDescription WnP   BlueprintGeneratedClass )p-   BlueprintGuid U$   BlueprintInputActionDelegateBinding 
B"   BlueprintInputAxisDelegateBinding ~y#   BlueprintInputTouchDelegateBinding \   BlueprintInternalUseOnly Q   BlueprintSystemVersion t	+   BlueprintType    BodyInstance @   BoolProperty    bOrientRotationToMovement    bOverrideParentBinding    BPVariableDescription &   BPVariableMetaDataEntry p   BreakRotator N    bSelfContext b|   bUseControllerRotationYaw ?|$   bUsePawnControlRotation b   ByteProperty N-   CallFunc_BreakRotator_Pitch 'zy   CallFunc_BreakRotator_Roll    CallFunc_BreakRotator_Yaw l(   CallFunc_GetControlRotation_ReturnValue #&   CallFunc_GetForwardVector_ReturnValue $   CallFunc_GetRightVector_ReturnValue x"*   CallFunc_GetWorldDeltaSeconds_ReturnValue r
+   CallFunc_GetWorldDeltaSeconds_ReturnValue2 ?o!   CallFunc_MakeRotator_ReturnValue z)   CallFunc_Multiply_FloatFloat_ReturnValue '/*   CallFunc_Multiply_FloatFloat_ReturnValue2 `*   CallFunc_Multiply_FloatFloat_ReturnValue3 X*   CallFunc_Multiply_FloatFloat_ReturnValue4 ]A   CameraBoom #y|   CameraComponent gy   CameraComponent_0__CCE3C0B4    CapsuleComponent Oq   CapsuleHalfHeight Oc   CapsuleRadius \
.	   Category ~   CategoryName 6X   CategorySorting 
   Character >   CharacterMesh0 /5   CharacterMovement G   CharacterMovementComponent b   CharMoveComp    ChildNodes i   Class twx   CollisionCylinder \   ComponentClass 1U   ComponentTemplate "
   COND_None 2)   CustomFunctionName a   Default o>   Default__Character aL|   Default__GameplayStatics *+   Default__HeadMountedDisplayFunctionLibrary tm   Default__KismetMathLibrary Dj    Default__ThirdPersonCharacter_C    DefaultSceneRoot    DefaultSceneRootNode :P   DefaultValue 3   DisplayName zB   DynamicBindingObjects a   EdGraph o]   EdGraphNode_Comment :   EdGraphPinType wE   EdGraphSchema_K2    EditedDocumentInfo _   EditedObject Ba   EInputEvent &t   ELifetimeCondition d   EntryPoint X#   Enum Vo   EOrientPositionSelector bo   ETouchIndex ~S   EventGraph ]]   EventReference &   ExecuteUbergraph_ThirdPersonCharacter ~s@   FingerIndex z   FloatProperty    FollowCamera u24   FriendlyName 	   Function r   FunctionGraphs D)(=   FunctionNameToBind    FunctionReference Z   Game K%   GameplayStatics hb   GeneratedClass XT   GetControlRotation W   GetForwardVector rg   GetRightVector j'   GetWorldDeltaSeconds db
   GraphGuid v   Guid CPh"   HeadMountedDisplayFunctionLibrary ]   HideCategories K   IE_Pressed L   IE_Released 1N1'   InpActEvt_Jump_K2Node_InputActionEvent sD{*   InpActEvt_ResetVR_K2Node_InputActionEvent J(   InpAxisEvt_LookUp_K2Node_InputAxisEvent \_,   InpAxisEvt_LookUpRate_K2Node_InputAxisEvent >!-   InpAxisEvt_MoveForward_K2Node_InputAxisEvent t+   InpAxisEvt_MoveRight_K2Node_InputAxisEvent @M&   InpAxisEvt_Turn_K2Node_InputAxisEvent O*   InpAxisEvt_TurnRate_K2Node_InputAxisEvent Pv   InpTchEvt_Pressed o   InpTchEvt_Released O   InputActionDelegateBinding *\   InputActionDelegateBindings l   InputActionName d   InputAxisDelegateBinding ;"   InputAxisDelegateBindings    InputAxisName Q   InputKeyEvent    InputTouchDelegateBinding 'Y'   InputTouchDelegateBindings )   InternalVariableName =
   IntProperty 6J   Jump    JumpZVelocity    K2Node_CallFunction    K2Node_Comment Fz,   K2Node_CommutativeAssociativeBinaryOperator zz   K2Node_EnumEquality A   K2Node_FunctionEntry *   K2Node_IfThenElse G   K2Node_InputAction nJ   K2Node_InputActionEvent_Key 
]=   K2Node_InputActionEvent_Key2 LL   K2Node_InputActionEvent_Key3 WQ+   K2Node_InputAxisEvent     K2Node_InputAxisEvent_AxisValue #!   K2Node_InputAxisEvent_AxisValue2 k!   K2Node_InputAxisEvent_AxisValue3 iv!   K2Node_InputAxisEvent_AxisValue4 l&H!   K2Node_InputAxisEvent_AxisValue5 ;-!   K2Node_InputAxisEvent_AxisValue6 }   K2Node_InputTouch 7 F>#   K2Node_InputTouchEvent_FingerIndex P$   K2Node_InputTouchEvent_FingerIndex2     K2Node_InputTouchEvent_Location 0H!   K2Node_InputTouchEvent_Location2 *A   K2Node_VariableGet 6r   Key =X   KismetMathLibrary l   LastEditedDocuments 	   Location q|   LookUp m   LookUpRate    MakeRotator T   MapProperty 5   MassInKgOverride     MemberGuid Rq   MemberName    MemberParent ~}<   MemberReference ~?   Mesh q	   MetaData    MetaDataArray Rf   ModuleRelativePath p"a   MoveForward &h
   MoveRight y   Multiply_FloatFloat 8~   My Character vS   NameProperty J   NavAgentProperties ]   NavAgentProps AX   NewVariables    NodeComment `$_	   NodeGuid    NodeHeight S	   NodePosX [	   NodePosY rFe   Nodes l
   NodeWidth lni   None    NumAdditionalInputs Qx   Object eK   ObjectProperty A   Package sG   PackageLocalizationNamespace ty   PackageMetaData ,e   ParentClass [   ParentComponentOrVariableName aZp   Pawn c   PointerToUberGraphFrame T<   PropertyFlags o   PropertyGuids w   RelativeLocation P,   RelativeRotation )   ReplicationCondition o   RepNotifyFunc    ResetOrientationAndPosition    ResetVR t%   RootComponent a
   RootNodes GW   RotationRate O7   Rotator i   SavedViewOffset |D   SavedZoomAmount _   SceneComponent Hd_   SceneThumbnailInfo "   Schema w   ScriptStruct K	   SCS_Node 1   SignatureClass N$   SignatureName t   SimpleConstructionScript +R    SK_Mannequin 4   SkeletalMesh f   SkeletalMeshComponent 7R   SpringArmComponent 5]   SpringArmComponent_0__A9892D03 I(_   SpringEndpoint {tE   StopJumping y   StrProperty ;r$   StructProperty 0    Temp_byte_Variable    Temp_struct_Variable Y@   Temp_struct_Variable2 4   TextProperty :t   ThirdPerson_AnimBP_C    ThirdPersonCharacter 7   ThirdPersonCharacter_C u9   ThumbnailInfo L3   ToolTip    Tooltip e   Turn /	   TurnRate v>/   UberGraphFrame i8   UberGraphFramePointerProperty {u8   UberGraphFunction 9   UbergraphPages #3   UInt64Property ^p\l   UserConstructionScript M`    VarGuid 1   VariableGuid ~   VariableReference D   VarName |1   VarType G'L
   Vector d	   Vector2D U0l	                                                J       W              P       ]              S       T              V       j              V                     V                     V                     V                     V                     V                     V                     V                     V                     V       9              V       w              V       z              V                     V                     V                     V                     V                    V                     V                     V       %              V       '              V       H              V       J              V       P              V       S              V       g              V                     V                     V                     V                     V                     V                     V                     V                     V                     V                     V                     V                     V       h              V                     p       q              p       r              z                    z                     z                     z       5              z                     z                     z                     z                     z                            ^                     _                     `                                                                                                                                                                                                                                                                                                             Q               >             $   `                                                                >             $   `                                                                >   G          (   `                                                                >   x          (   a                                                                #   F          $   /a                                                                #   E          $   Sa                                                                #   A          $   wa                                                                #   @          $   a                                                                #   D          $   a                                                                #   C          $   a                                                                #             $   b                                                                #             $   +b                                                                #             $   Ob                                                                #   >          (   sb                                                                #   ?          (   b                                                                #             (   b                                                                #             (   b                                                                #   B          (   c                                                                #   <          $   ;c                                                                #   :          $   _c                                                                #   ;          $   c                                                                #             $   c                                                                #   =          (   c                                                                #             $   c                                                                #             $   d                                                                #             (   ;d                                                                #            (   cd                                                                #             (   d                                                                #             (   d                                                                #            (   d                                                                #            (   e                                                                #             (   +e                                                                #             (   Se                                                                #   o          $   {e                                                                >   u          T  e                                                                %             $   h                                                                >      6      H   i                                                                '             $   _i                                                                >      '      H   i                                                                )             $   i                                                                >      )      H   i                                                                +             $   7j                                                                >      0      H   [j                                                                -             $   j                                                                >      [      H   j                                                                /             $   k                                                                >      P      H   3k                                                                1             (   {k                                                                >            H   k                                                                3             (   k                                                                >            H   l                                                                5             (   [l                                                                >      	      H   l                                                                8             (   l                                                                8   v          (   l                                                                >             R   m                                                                ;             (   mm                                                                ;   v          (   m                                                                >             R   m                                                            >            1   n                                                                >            (   @n                                                                	      	     hn                                                        >               a       1   n  -p                                                                 ?          )  )   q                                                                             q                                                              >   I       )      y                                                                ?   W       )  F   y                                                                ?   T       )    #z                                                                A   s          I  3{                                                               A               ||                                                               E   h           )}                                                               E   h   +         8~                                                               E   h   ^         &                                                               E                                                                              E      (                                                                        E      9                                                                        >                                                                               >                                                                               >               s                                                                E           h                                                                 E      mQ     u  }                                                               E      :S                                                                      E                                                                            E                                                                            E      Y       7                                                               E           A                                                                 E      G     A                                                                 E             ]                                                               E             c                                                               E      P         i                                                               E                                                                            E            A                                                                 E            A                                                                 E      "                                                                      E      @"                                                                      E      $     K                                                                 E      &                                                                      E            s                                                                 E            s                                                                 E              h                                                               F              t                                                               E                                                                             E            8                                                                 E              :                                                               E      =      0  8                                                               E      +        h                                                               E      ,        1                                                               E      3                                                                       E      8                                                                       E      V        X                                                               E      `        !
                                                               E                                                                             E      \        v                                                               E      ^         t                                                                               t                                                               >         )                                                                      A                                                                               y               %                                                                y            c  $                                                                 y               !                                                                >               "                                                                ?   Q       )  P  &#                                                                >          )   c   v$                                                                                                             	      
                                                                                                                                           !   "      "   	               
                                                                         !          #   $             %   &             '   (             )   *             +   ,             -   .             /   0             1   2             3   4             6      5   7   !       6          9      8   :         9      ;      <      N   O   M   y   =   #   %   '   )   +   -   /   1   3   5   8   ;   <   A   ?      z   @   D   C   >      C      y   E   F   u   >             (   J   P   i   j   ]   l   \   K   n   o   X   Y   [   ^   _   L   p   d   g   S   H   Q   R   q   r   c   b   W   V   I   k   m   T   U   `   f   a   h   Z   G      e                                          P   i      Q   [   R      R   Q   ^   _      S   g   p      T   c      U   b      V   m   b      W   k   c      X   n   ^      Y   o   _      Z   h      [   Q      \   l      ]   j      ^   R   X      _   R   Y      `   i      a   f   p      b   m   r   V   U      c   k   q   W   T      d   g   f   p      e      f   d   a      g   d   S      h   Z      i   P   `      j   >   ]      k   >   W   c      l   >   \      m   >   V   b      n   >   X      o   >   Y      p   S   a   d      q   c   >      r   b   >                  t      {   x      B      w   x   v      C             \ PNG

   IHDR         \rf    IDATxmy=}ol"Ij0PeEa2|H>Nl#qO 6Q`_!BE%KDAMI("dO<{}jZfSyUk>?U3g,]yJ%hP|exo	,F$hD^%KkdHK
.O^QzB]-i?KXzM!u@f9koAI>j3f"PsX^|h9dB8*P3<f?8q"X[|Ab{fjA-E|Pw1"&4bv	<.DNM,>M&871{'!nO7;lZl'#<pb6hPusa_c7`s1>C7niO9qh	O?~r8E+d%'m *SP7m3;gL2CEU}bff?Qzw}qNL".6$`|egv9L	v.LxROVP)'XrMSYFUH`nxO;g91gvE H!B?nX!h(vpMAL}!DXa6P'IMx}M.*bd3)&;qiS2A7}	>#<t[DNY)2vZ,66f	395L|X~^V"|)[uYOdP/AYZNJcI0!<s:smhDDRA)}1|P}+O;NW"V{hWP4	GV.HDMn{"UlKLm0c%xbc[Ubhzh~?	5;-~'~hrl+AEL:/w45I8h)oA'&zg!pBn,ns(12t\^:ikVcS<'~n|)z;`cN$
S&wJAQ@NzlD*L|);)2RU!7:M5vAN4E\~'c3:3G4MrH m12$Mu0AxR3`0&C_vD,/FW[h
UzO;Yqjnn+b4b&{+$1Llq\rgzVjq!)@hD;iO	|FV	M|Ds[|Sl5v1dOg//b#btQ~D\n(!vnJwxJ :}_NPk{ Z,ka.o'Q.ijrWmc
63FP(f9$@fwhGYf*{l K`inAJw=UwMW&uwU	OS(Q	tqx BVhT7ClsgjoHGbTv>ZOiu1!Q2G;%2;*L>|\D5B65 Aq9 +Z^ZAwsh*R	oPp{ { Ak%XZA}$BR>E4xx09sLp&S*/P%~gY>3Y_OxZNmc qbEa7?#%C\Gk``5iTl,3%
:6a+<PwUgL/.L+\kp #v>0jh_m0SZ@xAui{3KU9.n 1+4=C>mHjD#MInCdJW<pmCxp5}6bbX	p O"All#._Nd\V;z0#u8*=+(Sh|ILC f| GIh4j/r\7G84O*wak<jp,fA7/S4m,cn@pp8E`Vf6\{#p{])&i	',q6tU2Y^NOG96>>p AgP"	<,qozAu@1pT,+4jt?f/*Llqc|b- do gH"=8|Zq(t 6TM@r0FaDR`S+<|5_%eA(ZG1LCNa@V,_q:s96<nj:YLIN1$1Hu,qN  #euA<5f9z~]]m;6	ZRCx|ptaW%|%pID\#
	U$UF|W.~Uk	"rtv j9|OM/4mxpxx@k9&X5znV@Gn|$OEa)16m_fXra)
Q	G94:B>tlgZjF+VZc~p/'
Xu(a[D=b*XdJW1Z14Kopq
\&!CaE_3!1-2'F{V<cnKN tHi[q32l@udl_?9W`T@`c(rr?<gq3B;O`jTpc#+@@/lCCY45D}XOma' $8Cg9X5Ch*PGx@oY
d[G'2   ]ugN4MVO-mQ:rgNY*r(g:n:=a%qqCj

SAb{ d|S#KnW!FY2tWeXQyb'bVI:NW4-IfpY$(OcjP3`CY+T+~1 M/a<4Sqs{"4= 0`"47lxoK`G|]Q$1n&'	-!\p3i/2hI6HTx`&6OaI0L8Oh!UUk{<6FtKdg=+tX#Hv Tc5)PhzgR|B}N{#|q`r0rqF(B@6N-|[12$l2mm%W eCv"k7_FVVk5	^}\cc3s\(f`q73<d<5s[O_nY m:;SogF?LVb-ewnt H	?Dz*)(Th:ar+Mlpg,>rb!t)vU<
7&/D5o`rJ1:pQb(cgP{k%=INbRUxp%@
8	m(k9A*32zFvp'9[\$_JdZzS/Vhjv:qmM[M\FOl&?>869Vi)DYr(9[zcN9Y}(&x@5A{Jtd~'k7K_k `ScyX! 	|;^BOgn4zj_MRsw}_AW6&+=j |vZ1m*$Ww\5+yDJ-^7sX,+c5gc N|bKPQwIQ'78>)JSC[|qz2cxM-4s{--/Xq%x.F:>Nz/;q>~Dvok[Og'LBNM0E79xD0zDuwCn8L2J:	^5_JWF~^v?pNzC^P`})s;o_ptLN$L6_D:CLU6~hnmnv@&!Vg[hX95*[&yxs jD^yV _=u#) ULy ;fLk!7lldFEEV;Np\tVl
gb57PG
S<)6k:+#H)y8wS.C
x4C5$q-7{A";|<g~]Qpg82:(1nW6q\	Y6jWRUCSU 80;n@!)hK@,g[t|>>lpuA
M!T@fp@7Vt60-;wvn%kp8B`.W\V14S>}jPN4:;r}B	pN[Y	,"T	S~@?vKA05Wu4+8;n~:8hY3"uEi|Tp#!ld9Cqld4IF_JHlj7f>Vaq9##[;a2~aw`VRJ-=p%*tC6CpO?/ K3>gg"1hvO#u>i$vek$Wy-^U:xng~#r'gsXfx[J  D`Z#zxnOgu'=DW&T Roiq'`E4UqBYcfj15	_{'c&w6F6]T;Z3'k}p< j8Zq<CPA<]=Q#FJD]0@XpB	-$h"klDImeE^f
bO9].`n&CQ:KrNi; #P/7j[w{ti~h-R)c"d`i+12go~)Cc$`!s~fBs2 @mYlfj6K@C+'6OoK5~R,A ;Qql;-%{F,UGN&S ]?eIAx:a>f,[d
4*`CpyL=p5xJK9RF3HGJld }i3(N7z5twie._sC|{$^l>A|fk	F<22qsXG[3 6lGt.[=qx0$k/5IW5(+[QNGTJdQ&xwJ=9Y%apr+W7o.[=4w"_WY'u|Bwk{P2N>fj.K3_=?4_x2r`_e:w6AZs{|2p,H5R9'\0G`cN]skt*;E~W&C ^{#+}\Y3U((>i9RA5zZpRZ
4|uT48T)9<xpJZiYB6CA: [s264v}493|no-g'Iw9lz=zH/m9uA,H/}}CyDX	:baAF6(/VsC;?Ftkz=;I=NI6B;4-0	6Tn=1<C;%>:{giGL)OPgX bxX&\vo`j{	O
hNxiiSR0$E]D}DfO5m<g= 7cFSAklzWc4ce?{L3yNG=$;}ig'_\h=mkkV =b1`'p] 5B\xNU+sp{+HbtQNFe lo7p?_!kQh<0G{.as{z;]{9YUY\0vPcw&:DO+f1Ms@kCg5m9%Pnxu`2vy;_C4Yu|!mr@,<Zi^$V<>7^61TSuJ|jznQ#a*=uqmAlIQN=\'G)v{z&)PDZMoaw8k/;w"hy2X.^\Tt!L-.ptkrEr\{!7p6okHc3E~&Fj,
VKoWAfLY~hfOkC2
l<	nw%)48l\%Tm'PUN"'j_G&/aijv$kw,~nm-Z%{    IDATn!Q
b&<cDB&-18v[&- /O?>|5#rm}mYC#x<mIY^.`_Rh(-(c`Q`4IJT9tL3M6I'ryVn2o#38x,52Wg7_UdkatTt<I_Umj!RVVfE]6omYk0jGq_O^~AG3,O5CLnx#(1F1`Ain.9Mw{d[oot^N$Ke	A)l6l] `"]eA"s^D]-g[H%|Cjy-	m!rUn,
xu*nX] &{3m<
XMcx>`pQ?'V<&<S:Fj ~Dn>O8,&![oQ<&uu78;rRO;;`Y\W$z`=[o\,$V7{xy[{=tYPtfoeJk^Bn&M-	uDt)&[5@tj: d3}(X$;? U\cW]5-;f&AP*MjB V0`YIf6U$oWt"gz$"ymKo^I vpUlK</]$ormn+zohy't@}a@
20	XE@.{PA]9E4b3)AECZZLmU.3e	
dVxhZ<o<IT
v|hyHo3|.J@;B{)leI|*R{\L\!9Bb`'!IP>M;@Igr3xsq_( 'x.8 xd;wzsz&kW}/7|>1/
/\[lwv0FLBrvg		l6 3>it`PVY/5l dQ
,sYglbzK5zX]"|'NzB8tiY"<;9|( KTUaN:$CJ	2`\KEN~0_i$,.+~;k6/Vu)1>L'QF4",9,3!2^hwoo
z_]>Zxr[+~O<S8QC6/n .k}mWrJ,J'kpZZYLAi:ig=s4'14IA|y~v:%#@IcUB[`d o(Psq 89c}]loy%WeCg;o3^x71x%/p\6kl$ .s[*`bSg:g__>rK/,,|3.,_o~|GJW%L&t	uw!p>y@3--}!v36as!|wteJ2$Ju5m+Rl|EvH 8uPD1%tf#T815Vz3X;2{o}' GC-a#P}S8#(/O6ARG(D/qkIo5FByfyJ~g{W|e}W
OgrQr[tJ\}H`LGu2.F^aZaZgCD%)U<&*A'B-kpM/Nm)w=f1	=u_?56e|n; Z'2PT7*K%\A<bP(YS:#p:2xON `zvDv22],gX2*P,a~Uh\^KFw)W\6	a!~Ynw76+osoo,/|>S1kF=q,; zO*\S*'hT1B4`5(LgNxbe9U;4q*DZ,o>>u`adR22\Vga.uDTAw-'F0 #]
qy(8)8^M%(aP,S{)4K`WSZH{>x'[8]`rs}ane"	yX*{^ mH*<xG>r/~&Ko/o,^Z^qs<XLHYXy#!:+A ?#`.`rGvO>KO\GKxUGBb,zJ0//:2X]JgN^%u:h*uX1_~jo92*>a*!Rv#&uK4n91OrIs5Tt)&zV]/h *m[$lL.3?T^7JCH_++g,xC>V[%B=!^c6*,:-W:^5%44XW-uo/nf9j\kZw<-NrHvybbmVei=8[O\8$r|r[BV	2*;	hh(>=y2rX 8hQT|S6`#0	qvgujg<|m*W9L>!0i?TM),=a8Y;dbE`; *@6AMFx@A=r:c@'RAm=te3tvW._1;o3uFd&NxN~XpW)hgSx#:bH^|iy]?}X><,ok'OJL|(cYr1|AT6WgY5|21$I	;S!L|dX =n#|DTQ96)]#;^JctQm5V11+.,k\dH_XY2oY\m9Uei_<V2=XUX)utWF[DGz41`u51tRy/2j dq h6eO]lASAAcFlh662DXBIlM,Hd)oKN&A``[2;:/y@wQ~[~r8>
oL4P8WcLZZq'1=@!vpUL_HC<Ju AGN0"/@OwjW:3Wf-=t7xD/8G4:ky!$7J4z#?s>xs3;`p&
jYly6@G'8$D&Z+`p,dlZ*h$XS"L2ed&v'?yq>wVL4/;B:	ps?}og?rC.=\R;%O9O^iy^c>;:D WW.XVO<d1\:O\s9HTC~1.d#CEdZ#3|=oakJitl&
cjwx8&a` H
%I51S1R8
Nl=9knt])rk{+*YXmcbKF
Nu0M$Q\ o\\Z7t B| qLjR$g?o]t=;y]m}SW//_z`=>|K[n|gy@A{qeHqtvJWaqaNn#,^rH!'OgM}V)9d#m*'#d.ECZ5M&gfn*PQ	REy2g	u.r
|r*9c5Dx!Z piND-~LE-8e[p&cQ J\q?7AyK&* WY-FY(^^|1$+rWPl.\`UcY5'.^x$=wB)<X^>9h#= tcy'o&*5}	c5% ~[mQU?b{\z[;v"/<7}	
dynu_D?-;.b<r:`a> i&+&^jbL1oh[|0`}~Ej];.^Erp1$d{a9z{dtp9/Q@|e,bU5N2[1 	F-:]	$XDo=X| ==qk@K
<d Nbnap,$HH49(>hR.!t}g$EoUu+\|u#NO.._]|W>VSo.?[,=K&=]O-v	tJZqCD8*N*Op|t@ZABuf]+,_d{bD v'|C(6eGjd8;$r;!DT<4/9}sDq%6^L:a9[mB'Gwutl2Hg^#o^h`%A: 0p29AiX @Ty^BoAm~<-KZ%GVr;t|bRe~Yo|g1Gq>U3A7_{g[.i!OZpI7	3\{$c}]@ZTU;GbW	bw-RDJQ;%.z r8sC1H886IE	*{[TCw1+e-u8	hgAYBo p ~&p|Z0'(_R1^ /cbKh*erEvgV|a(UlD!Bi.'GOmkWRN``cAI)yU0/ me__V+/YN,[q/}xg|ZE}g<??LJO6F,o>w_GM@GpG +[>yRE[k`vm"*!Itp^Za"76REH=.n2bgaC0hJsuJGP_.MVI$lW7e#t(l! ~m{to/)/H9j-b -MNDg^DnQ+'z0=:pGN&]SIM -mV&#BWlw!)?!,>q\ zmc5}z7^e()y7 |Oz@|5X]Fw~;c;| _=q|^0+prHqsb]"Ek-s=+fie!_gv.bbCoqrOR|:"Gf!JB T8rt@:*c;Bc(#0g['EAG/
N>$;F(Q@Or ZQbC#]&dTRC_[/p+/xd^|'b]$j!. m:$?xKG?X~<tu}>uMs../l}hy-} _"{]e[
+]A0bSb@/ ^px!R*r=$PQH2BXD3w!9?qS1*_%0h8}0xwk(|[
$~a5@((2
3X3H,xwPn$[FKn2ST)Y5kE*OdX|x/A }	]%n4	p{fy,d-^y/&.C@F7\.uRyze|V	] #jqgW_}\s{grA_pe?,DKW<wum/WAS.j`49;W)?X{VHAKXM,86swg| <Afy.i5 anXG]<pw6f nDp0@yBn%VK}%TFL`)-Z\Ky5B	#IL#dh:%p%Z/CKw7 
R`k`0\umf>KI:]mkun ('W^}u|Izbu}iCm/r- $ kp77Hd63Ea7Xr8g1U)N`<x
!G! JaXYH2a Tn#P"T>g:U"Gf+!5c\Q}":    IDATW^'NY{L=}iEJ&c&Fr/e~ F5$7KdsW6cR  ,:2X,nN$$P9\[uJJlNIbBt_op4&aRCu(wJawh.?O,_[ya=.9|b"n.W{`A*n6oDauV=EmI/d2Pv6:r_q#G~qqx*1IsNa2;
+}
jfL8jzjAXqK<dhAwCa=gYea;sBL *XICBb]G r L2R*)MWE`p?$ J6<O(pW|<>rPQg}h<[=sppwkBsg}/d`zY"7:B^DO_xyey.{Dd*|n]BRNRgn0>')T}nV/jV'.eB%N(6	f{<^vy
&+^,CEjI*VcO~2!=No+	o"ImM<&D	G`Z0lD&
&cbpg2)hC'@$At53n3S8MB/|@rJ Y=^_OJ^J"~ZNZ[Xn'Q~E?!m_R5/zM?NRByeRJ'`lQ<+Q&~.r}?tX\;u]cIXkUnWW9+BMT_>c.S')#S5 gA*>2v/]{Wxi^b2 lQ(>Of.\PCTy;.9g[LYc0H:Atx9 ,^
>g$CU6E\ejD7' V!!I_&x`R@[O,fGjk>.1~lvneV}E5)-M+Zd-,(&|x("v:c07$8cE6y'+}JEaT;+[oWWrX|oi;L$Xa%
szx-i|MKy|~]>3V}TM6RA]o2&IuWjE%x2t
'|[<>||ieg.@R7	BH'mW[Iw2
}87 NAIg!D?o=/qQn$IVGinc)hHDR%WX~ow<{_\~X~!ZScP],)YF/jrym.;Jj&,=(WMurV:dQ*7?|1#OHp#&?bM1:xAU/o&Wk)5>D!1CMP=dLV>2cQ'$#;X0*e  4)t,|hXYSmV6` *x7ur)UMj{;wLPm~3,jdcUTD}XyNky#F~_/xtCuC./d H7cZ
[6RFa+mPH6c2mp}`3]	'-.0?M1W|	mnUg$g{RnR*+?iqK!Naum@	IDYp&$&+eWKYA""5>a:w[5tH]fY8$Jg84e8"V
lU$5(7 rU8'3UY[:!}C7en*M~uC,3\?F|Q(4Y,_/oD:FxskP@NCW^paSHl]yv{L8_;R:@LG[l1\nI.~)-^h]2@/AtW3|G;!$	j#-^ ;QP_ZPd[_Bam<lX:9lq=aWV|bg"*A T0XEew<2 ;eXItWR#*3cw#[~QC<_B%tV	M?j}.<@bfI$XNj(]g,,?Pg^@U0(S>=qc*LN`=MBiPJvIXGoEf1SMl ] r)@uX{X	cmCwY +0`1j`]2yqSmrBx[x .	E'~@aa@~:4bKeDM
Xt	`7+>{kV&U? hOyt^oy]@Ug~u_[pokuE3Ry^_[g9v!^4r@#Aa`uI79aY90x*jq1,F5PAxL
z7[xeNIx$
8@{Dm,f>wOXp1~R[@N)~5`3eFNF1PsYE_bV J$
XqcO;l,^Ig=sS>X~8bsN[$-j+.Y|jWFxe[y~yF_[	Ok/q;vNxC?3*P_#m$c|M1 d?zO2DM<-Q.'_nH_ilcRj[7f\P&&wrE1HT#LIh_BBv-2nv[gOseP4XEh[w1mbS4ODU'%_DJk[i$AMOD@O!+HP@  o- <VDE	ij>;mn[``AabbH7(c>LW6x],/+_Xw@H ym"_w|//}_[cH3/s\bH'Wnk@;"auK?,rJ;E!j2hR 4,kE6#B#-/U~Gce-"eq^<4r#Wt2$>\&|ec^/iq ,^1Ck2tPr:)#"1~ GVL2Y5!<\KhO0!e>=zv8|ce)Nqe<[>Nq5Q@l5aPIr.@-Jlb"e!J0#'k ~E/KY>/-wx{9}c~e5 :&q=XY`7rX)
d|!cty\-" 
.fX)Le6a /Cj+*Z11Tja\?T}=i?Xou:bk3	:1`K!%Q#rNk7qC}g/P$; J~W`#xajH4YE M[wHG RT+dH>};QDvx	U[zF[o]_/,_kW./xJQx<\! |tj,Y%Isw/KXa_,5Y)h<S'.~zj0E8 UjUa,_7 S#^NY(_lDLnlb <_gV=JIJp\;1SQTdhp$'3TT[&ZqqVP5Y3hr[IqSU_06aQKxY:rGchH& 
_jv]ly7 c/4P|k/k+|/$!-e(<TVTJ>lrc7it0M+H9vPPA83P	|lQw$b4~qEYa<&6.m&IGQe$:K ?0:yv><r<t`diUEKd[))BKoYDN0{l	*a8<[`C2u_kef48>@8b)JHDPP!|>IG,2v&7),P&+|.,| U}k/6n/wIX}2Q'
>v/no/Vx?bt/&h-tJ?G!`xmtvx:p3oRJdTl1Asv9jw;5&V\F Zq|w.EMaDC]ZH;% >n$9RLT[A?{U$HCs0hOFOB481n3^&[l8i\,Xf:+\~rgE=p8P8U+d-|tuvI;J/Fx=D_{9wcbbs$%)jv`K*.a4?qF/d`wM8cZZM.
](=<Vov^:o0j*umlX!%O{:dgcWWcQc62'=_ON}f-#nz|1\.|lnB	,ek&f:c^o!y5/mzhk-psdb2xxZYAahYfX;8tP@Qd4AXI5[GWmj"M[VN OlyQV-@! ;u-5:-~#wPmS51E1]kFgp>5d"|WIIu`+/:"cOrr`aVtGvUOmEd!*]CBR}R$mO1UbM(_<B!?br~Iqm`:`J&~
	&QRm:gm'4Vb0W@@=$	/B-z>i{M LlyghPa*?8P[S:[1V{\VroN]S[zG]t8@!*HRN{PZop_c!E=)h&&P+Xl>-6J FD^H|Cj>l+a
lj,|~
<I+&^kzL57cLdyZ%rVdmET.e98e4)Q)><,8br @TLM>]'wk7-C}^vaDx$&}GV*&	{L=#pMv ewuExXW.c_'SC&mz&RR ?(&4*]<sG\<y>S!xQw{wj\!b=r\m<w	'Q={m*82>kUR5;x92&iag))p;VM*E=y>8; *j]&N4J7joX
XuX:[B0gti/vm ;=OVlFCXYEgF-`fAl>GD+T]jV
cl}' 2k9keY
%J7' !RI1[Cgwt3eC_Ex=|/lw?{rS_qWsE,V%5RWT"XG0`o<O;_^o!<e=9/s3jt;3gau lXmjmeKATMfo"Dx7 
ocKHWu<In05:}}/@0[K}yLLPkQ0rNDAK>:PLaAdM@cu@]}j!V*d[Gv46V6`4m0x>cJV aPl=i) ;0_J<Od EyBVE6uaA)d<Fn!!9B_/p!^K&w'tY~0v R>mY,U|"a`^uJ.)usm&ymzSk.Lb9${YgJ gzH\K+I=32`:3(d_)fSO/'(3m@5H@_\dI
^5Ho6-/`WzHLE/
t-Lf4-o|7M~5	%+xtOUoAr
g\1a23Va`zz1h#wQG~@i@INN.|	PE09:*]gQ.Ps_QMA/5StxIs{U\X(	    IDAT8@F[-dBYI&F{NE6oN@?+p`';Nm>|<w-oGzp}bquc]6j=Y? 
	'?3>7h>7hn'"3# /|	sS>+v\,tqa%xh_]?&d<9DK-rBpj'">wJ9oz [l6<5@o/s2 d8=,PHKAF16*:r@rm\aOB,XZ9W'%Gv&|~89c/d O 4D6~(|m!>]?(&Z/ow_>+\.NG]CkW.W%-pC;fmw G/]&g_s(vlHgxB:kzI~}W^wbK]xRH9dbNVH-,qs%p("
Ty,BO"d#Q`[%`-1)Yv*+/>bG1}^H.1w05:.5|^PvZ]Z}U,8&1VpXqh1BLEt `P1PYQYFq&;.A(l"y@:;F.CJJtx%&x$	]X:\|J9=J|+_]?K>[\t+L+1O/1Q	_WkQ_L[_.i@q3"?<{ \^pK}>p?jA7'{[^|TxP!rWP@%XA*#1p/lZKWsxUqU@FqMP>b[9G]cnjU|(C_R so3D$".,M)o_VsHIP`t2	kE 	GFw0L4l#ld,KW
]1A;-&_2Xed&8
<"t@7^}|yg~au\>?>|3_8T|[Y.}m7b9?][X|;	5p;hkA3
@hpv!*2^v)P$\>|/j;k_[>?\y#%]&_[r`PQ:P9_ 	Bm-&$<)zx'OucZ8VBVw6 Gxf{_>	[_	 %"%xb=TzLx`
fMJyQ5 8 &Of5d..l!&30pWV:c2r,QpfZJ`lSwLx
$\!Ii%iM9}|}vj~_OOGlj__s_gi.g]j;_**ErWbgx';O!C_|is4&}-?3V}}	y$C8Vjc]&	2<YD{md[!e|4v<ixn9t)m	cJ U-R~KN.y6*6x[!klibSLmf27:3O/jR7BlOl0OMT5S5$T-d`@2,c}WK7Z<Zp{,sC"iI+7n`zi|c,!|)ln6]Wu&^-x
a\=}|<C'[_O$*q=qK/ecp}xGwfp<[zNy./lm<x`k8w Ey|D*Pm/qSEA(JO.X6e2e
z$t5O#FeOUz:*+Q}L24k26oYVt\] :;	}i[^S@OaO8nNJaB~2)2q
7Db0qP6a*c9#EkUm 3fq$ADfb	'|i/A8Y8qWi.9X. $UJzIK~:0~q
y<o~i,3)xgR6fmOGY:A}GqE/&gqvlTtBP+0~"J
y /3Bp}x20rhc}C?Y;g62! KO yA"'{vMz\Uewn	'^z,z+_@1B/:y/0|u9CG*%B/Q;$L'sgSO09BP%.|ifJ+p@pO:}!L/P:9Inw+kJvA #h8mu+!4	}>'dn={Hgsyqms`<Iom`o?jYboJB|.6rX2-Tgi8`5tq	4snz}_-;-YXz)_;!=R}m?gIk'IWUI6>j#B/^0
U2"rYd b&OA"
*oLMYUx]e\BEo	kE0i({1*@y4+<e1eL&62C?%kb8=Zqb\)k[r1<!E^rK\2KORt4Kwx|+*Q(Lp+]zeeCg
*2YQsl|/cqx;u^GO8sOw}7_|IEG-+oI8C >ekufi62peC|/8D%e#6y7/o|2p2w.x8VfpUb3~c9^3j>|Hx7GDejni(,V]'o_"u!B=VFI+0Hd"7=8-]
O7zuP~t%@@dR#{ rV.y |@frU!dHi~R^\:):tpgIv3%CV.-CN*Sx^r)u/?% |JH%vm'/>qwFfO/QaY	u.|Ae[&?
o}E|0/}$x_5@0xkg}{GU_YA;51r\L[k*$\v/pPHehwr-&DY%1Rg
5NOR
"{`Orpt2z5:S*T!M:u,WtB.FUU%~rF"&z5bb
JwOcAN-x:Z{SpK*!oa&	k">IF^CSUhMy3 D*9-"4wT:>?qc
^zG^^ G9Gg;Jqc#4V9Vr{{[?x.\,N.U/'=A[JwBFkI{@,~Tuh[yQ4}[8fU;9#'ei!Yir;fA'%gMILVUrm,P*F-MVG^e0a_8U1 u}4):	h@KK;v=Z%8MURkbU]j~ p0l'TN5'pp]z4h -=u*8FIT70p_?k_u&]fnx[]w9v8f2)-kG]q}w|+^z~eTm *OC/=#"lhMA(XYc%ml'Vh=S$r#R'QeY*(<tizZly^nYbDF}r%D#Q Z3M~-5UCMCB.axDMo3Y_/XQ#!Cx|iG0(
yYx<JV/(y(|5='-%S0W]9CSN}qQ+Ph8i].rLGi{(r~P=M`Q63h\lhOY$[dbbo6UY#-CMHnOrn3Z-#e~IGHdjz5=G(},Z[ ZO$~>HrVt% 'OT`{><(#'m;zfehG8FZC`[-:HWs \/B=2E4l<0m2Rf\bA
ZK~ia-_q''N;65'1?vvw ;p@;l~.066:AYA4?dzcgNyQXTT|^x/ze{7i?O(t\G2{,m>*l7eHt4u&9wtaE<:8!2%zy]*gKI2,?a\	Eb'	aUU6 m}0aLVbD~,L
$"P"Q5eFT$B@lou
C)01d'g=iiU^6^CF1g1(KVqo[?\N`~Nm5OGBzq\o[yTr!' 	}OE}`O>|$~aw_	=l9&zmvck8:X	[~0,r%P!m}3hE4%,w]w_Z-'I3xkIK><2y]\}KP'gE=SsLC\gx4'ig\Hd8qTx[>2k AHfL,*xqSOHS8.0qHqHk|<r	.)rPVJ#>G_xOnIQMEG?%c g{UT .Aj' ;^t3T-[xMy/f*<aW_u8kvWn,i4[k^	2(=n\<pK]F\eJy1=<>QQqSAI,RThbtz~2nxO*F{&>I~9^^([AZ9U~vq;h9O}L;(q	X&Ss%8N `sB]iYq,-<I^yK0&Cx(pO+HEiBP&+\GJ*?)!=\?a~<eMy,M/PJ#t(Yx2x?Jhx}L`gqOdq}O>1>8??OlL,'QSt]x{s+i<(aqt9n`i/t|w,b&IRF3C' 'C5mSV|yvcTM 1BxhhN*7>Z#CP"&I%2BG-4L=J%f$aMOSK
|J^<=,@I~F*Sag)BP>8%3#eTalo8*M?lkGA,"G_
Q!T~h ~U&Y*Yhu7b@A^O	PgE*=!f<g a{9*.-,9};q+7c'/m;Np}G-+[naw%dTCKcZA8o~'u!XJ[eF&i\3MO1e!M4CcT\Iq9IO(nUxVXIC"YOWRuk8a%HW	Ba9Hiane|(4oJkPJ46TRZ#qM\/M8Z%~[6YnT`bwDym-wd	):rGv>8tKh$%\:.n/dw%]%nOCCjhIQ`oyt~q7m<+p<V-Ctw+tdi&4` -OO_g<}q\S6cC[e(Y`fY|lbH9#54RQcG9ySb'Cj%S#34)v<XG	#SIY=GF398Ei8%'YAq/-}r	H(Vq5Obe\ LmIQ+_6y4|	YWJ.C e/%2GejYC| rtx5\&IcWp|gJkm^Ws
|yQ|^9m	    IDAT1W?y\|u!!Wu&o}f^G#@QUAT<ij.V;/_;.|UQV2RRE93(o*GS6V](y8jg_fS0R+*U2gd~Oa*oi8+d4T1<aJKpy$.PH$qD
] n~'J8g5tzp- T!6N
6[Vi+NL0C=	aV7\*z94VP)ar;r:.}.\G x{/l_*D]O~Wfwg%ho--'Xw||N0I|6:^t7oo56dV-~}Is<U&-[0~$Kc@|+L3s%)ds^#\<b gkdmU>$x3D%Ju.Wy5ek5e#dGL R/=0yFB+d7\Rf@zh;I)[C~"0hF(VU8K# 32You{~*pF ";-xxq.d`(\f~8Io$\{p1~eC Vy:>Lf38K|mWDNom
2(m+X]\3-BwsAWPvhCZc%hx5MF>l3?7W7mA<5n
]6KEYyCQ)wrf//$DH^d[<G #y:*]>t1fmI+m5i:r/mTHA"U6Kx3 "AL8<IVE&EqT8p<FLPfRXEF(j88JEFM bRx8<: tSLG#=@UJ<x*$L\G]eu_qg!4o';~3?W0I>*|(R2'ay"=[3EFU|wHW#f(@R#<wR\w~xKSl_G9WKRU^SGzlH)G*33bDQ:P/BC'n(hgJ>!-"HeLM+nqD^mzd	<'c (Z)~WBP{$RLUX(, i!t^@ ^rQ0*QqN%f2AE#Zsj'-I3}'^_|WGtt'm?AgAIKC[V*#CD.!zyY0qn"Z#&;lk"q<qc5lGB66uc?"GOeoT)IE\>|F\8&OA5p#mVK&/ywV%}2P|&t ?ji C8>3fj[f(msM	IPXbs]`1
RFG'	
4lawNIW2KFc,YBxr?)=\G$fJxiFmQW&\{!'E3zOyZq
OS_y,gn>9	FN'cX{6[Dp@hD>{ 'H2LrxYs)qw(/+?O?q6aSd/OE'zS,NrQ)@W/> #_j9uaCib@LjDA& id
EN;q!P_#nY+$Sig00>m#{lW)Rjqs*B{<S8!`E gc\c`'a:aEt'VX'1|K!*A.bAlym":
QTik^.5X!Ngg#<~s=G{jptx&9J_1 wm grtHHF$n;zl#;/2!/|a<c6o|;':)W,E_;;h)3WlR~;d,k`y;JSZ4<3)qG"xvAT&GGR5L0NSlvC9-$` cHzM[s8*Zp`:(0cX R)(&iV6t@:5 m!-=6Tyhk,?(5mJ6#p+|}}|8sJb?f3/ILm+chtZR]Y*^j%2K()r,aqmG1+W]3>p=Tj,jV!(5G{wv@4	c/&,-K!n%+8b6LO77tk<iH|>MOiKYDUN;/M8Bl.>VO'7-8{+~&
>[^ )RhDUP>hDihs3i SmJj8\WRIGz4Vbd`&aHE96[B3RA
k_{og,u5L Wz!*cmQrCP;*6sf"n ,{\/0/;G;p8FF^Ld&tJ?iR&UFUNjd#QmRl{aQHR2GBq"hpZlBaO@T&I'!)ydU0*z] X$I$QUv(m!
O%5}VNpht0Q6iU S|iRW<eg0b$$e0$8lt59_6F	jhG~Ul:x{l].Siz|o_>6nO.l|;RC3mpBuJ(^&w_q4/CxtiU o>5w01F,u{Ma w(`+e^sP@RLG~?&$I,4?y$"s.uIcaeSUHKrkO!!uxt,Oq$
;U".m[O)+5Bn5C|KEK4`%+{HF}fUPbGS{f;xzgt69g~_WO=J?/UCkrN+euH2tu {'^>d>Kr]|4[fQ2*r4]P^ 7}Fq	%V_l,H(NXL6F9bLY'8]IZD23<qN!DNAp)_\yx5[p
dxb#iJDdkO{WOs<u6e_p8(`]nD~2-$6(1J=G6eM_|n#Vrwg tf+,v*tb2g.1E<:<w<d 5q=}7Y^5mS^Vh[de\<sx?d
}Cvi|A
wyK:a$(mV_4Fz2s4L_[_?JL_frrU)`$maccukJ[Z$*4vNuMiB)o!nzf~mTxWNM @d
8"Gp$!NsN+_Zit CbEeX]haG!r+rOU\1x- s-_9EiSR	ds-znaU>,m (^Q)s'#_i9{//w
G#T> F_x+nmv9s|ZgB;/okhK,2l7q2z7HGO<i,x2gge1KW3cROPN,ylO:sg'i[ZgL_<bb
;0;4+/;!:V/:$
[=i9N.	i5ZndSXOJ18=GPC"!``z\<r4GIe31 0OWoIhiLYbKbY2i0g!OsqMQ*rNL(
$i,8~~8Ki _/s8V99dEK.!r<3?|<^u".fKr.`p<|^^.PSM5A;{/px&bi<{K6~G4IK9NK<
-2(O^S+1(zdU/?A9)e
ZN!yAj/.GsAwPp%biso\-ZJ2u9yg#6F:FA@IRM
M R02
e4[29XP&Fv\	H8rbY+2'lo-iEk&w^`aJe^yWRjo~/<;+lz>C}'%T6`V4/w|:xp|"?7^t
=K8g<Gyua>'`r7|@t,a*SF/h?<?=NcMs8"yrfh`Byz+IC		gF1`=v7X~YC*dY7z7VxZ&O^>k9vMP>H|pI9MYnRG+s [=5FI=iEWe^KKsn|HyL/e%GGC*]AYJy<di$?!,Yz&PS D`XyBObi4sg"F@}yidsrqb]}E'# Cz|q7(w]{m&NVG;W>/i|k<z$);W[cQ,fe#}M*8`evFjMyv>%JTUmi3Y.>,#/|"nkC_.u#rTcN=:G^[_p>T3h,$#%pU_y!La+	U/^1UoW^!a<?J"2hOp~4fsXHF9v(	s\+of'&K+M#{g3Q*VV9p40-N1m\;c'w8>[@:	)6@M2O8Uq@|E]Jl
\s}?2s6V.)l5qpJ:/-kU=WZVpY7|4NE4qy<i$21Z3/!gE$ H@	!$&L2qYlZI`8zxi1p$PwOlWX(83JvfJy[LW(W/,Ea1kMnB[i~oJ)k<Tg7c+Ss8-p7V+tx_	!2i3jo/y*64=/.W^4'_(z*@c,3 a-PS;[/a,0z,#ia6+)o=I"^Ir_%f I^aB+~EOC7ixA~M|896hDGuq1hp1TxV*)KhbT( ~87A1&QOA1Q [*/m0d[zVTt	ORhNdY%),`1;%w83m2yKc;{.r;yo_~3g)x'~J@_^g@eX_L6yd?Cmp<.co7LyVOwFQ3raa]o&yHfRu1UL_+ry@`N*Jf9KoVJS/+cAu(k%ww68!`6~Ri	Sont,=_Cb
ZYZx)t0uT}=_-jQ9d4&T$ ?)L%18Q&\U-$xu&-+	-sQ_qkwWnx?}/c-&7~Z, yl7(N7~73~ `4r.5T4 C>^F<^&R!M>?[O;o\p}i|;9Me-Omg
20Zg`RI-yV99RVt4A,j*r<+8W2h	6b6JQ??]eSM'`ByaNU1|3G'Hbh%CC0X`E8VBk++VK|<``qh,iZ0u    IDATI#-+ +	j4\44$\Yq0ZPV),of6<}lqx[}gw
dFx'>0xGt~h97x{qh^}U*Mrj>m5}w<:kn3=D`=\Ky,"Hf+<  
;N9/9+tWJe->W$e0>.>2QLA{O29vuYYYdz(8-(Uy^|oe# !DXd) dK uKHkT8r0ld$sG>cj",RVa*I:17<64Q5Ep'3x$I+ODI7C}Q^@o#gz]7):{Amhn*Gi@fwzx?v8_u/OlM~n3P1'PHSko1IATKZ[:vqw?s/Se!5G~m1c"!YIvKodETxKMYQJcyuf$}A8 WZ&;`y=2F};`3WI}KBa}Cz}63Q/K8> 	$L'"$	vyCJ6=Goa BAg/AQhtUU4?r7p*hV"Cn1]WQ6)c`Hc&dxsz]GL.Xe4n.[n~_/4~qn]6R54aCU/;K
Kp}W^XlF4n7BkF/`m, 6KPuKt*k5+ov>S:KSIC4yUB"{4Te_[u(I3x'&8HlU5-bu'y5B2HEQ\SXqUZ+< M2`Eo W2YH
muv7Lj7e iT{AZ<bdRViVz{YPk.4|D|Mfb+t_=~7}~<'{wIK['Voc?Yi/sOc[;o%v8O:?plJ:I%ltTlEU%H0+-")JSk6R7N"]@zQp{vZ>8&04W MP4'OOqKQmC42Fg) A7~*[V@UBU0UTQh@'@	u!4qqJ$w*.HS&]x>1[6)ea"*Kqx!3m^mYCCKcMY-<Vzvom	78v'j^m&e+zBIW?/|3<;	<|#	.^ eG =aVr)\3L}|<5+kpw$|2JrCIqq;1^\WMR'HlabtlAZ!i#L*LCVw=1F^7- 4	?IKQT>2hT3z[tEM`~2F!~i|
W R)Rz4Q&#rYz=5.#3 ,Z11VW\g+KfLHS;&B%C7dj{f1et6X}um|iVTf_fj<y.Y@w'n!|Kx^TF@8_i H(0|_OgiX|| zuK#5}}kP~8+p837^t{{E}T~W/feQFCeY]JD-ViWuBh$9*t;X|jN<(w{
ELQ!H&C#qF''@G+wo2FTR5$TUf''({Y^99Ar`eLrqi	q&EHdsZ4SR)I+~@3/2I\W8\0VUB[l;FO	SVE!qdbQN?56c4*%({m4UCxoj1~I&gxft3pe!:> 
#6}|{|q39I:j(c<W
jdL,Cf%``[MOnN^$3i3*z	d7d0K	%4e$BRmeT4Y_ Vz/I.z		J!VYL[iN
t/Z":o	-A-J~ X	>s}J,J!_?qR&SyV=c]E^*SoKjK`,  Mdq~)%`_7.wN^L@	?cn_w! 0UDdQkZG?uU?ECP3>sMcgVCT^wVo1^`s/|#MY &97Aq=N>"JEI `ZLJh
]YvhYZ2/T5r,:7YWQ?U|3	0r>b;T3LLle6okWtt6M8K1|B8(}g]
BiR0/SSiT<B>>ifJ&ia/
k8=
gbFt.nia* \
#(I1e,( 8m:FnG^a#^
hHW'I[yqY]5<6~B*#8|*S;5MYcpJS.&BDX^NA/(kI@Y#$UAt~WnVc0>&<ZR@8?~us'NW!b5m/^w91bG|:^W('"zy"85`CX%$=hEnxqcW4\FR RulfB8NV#Ua$\
C|i8Js@vH\+,:MNq@4`;N;`R.~G3ng_K]a3<[v+;}g#If '1)C,L)4RkDU([q$#LO-)+2Bw}m)goYn3__g]-?[d^3HA4O#g:U^+ll+iWRNi :T\
&TnB|TEi,ZK<T| 4u4 m,ai:K3$4K#f84Rc?$	SlxF<:uAXZ$W/vz;|OK]r"lN<F<@W]uuvr|?vdYt*?zO}3"<T.{YF&MvNCl/6
{8-KC3J>3g/r LJY_\
I%k;W|L<xw[6Up[-^`xBF/{GGO?1<HF-6G 8Y-BTZ"i(jU
&8wxuEalR5 R|-zBsR^'#/0':v{id?D
rq:ObS&m8yi_9O!w5N+:1!Y=oOf4PtXW'}J#<Ixj>kG_d{,:N0e$=-E'}{*ym
CA^$U>q@_~C*Y	i8RBxi#(U+H"9ui9JeaSw0jhUTjFJ"I<}	bB&xw>u Au-`2]6(BU~U3*@
4]e
wM6Za
v-yg^rl_0iS4_\5e"0`H"UPILso-k~zpo_qj)|chl|ozuGDz'}w7^gp[p}bmwzH^w-_cinXc+l#v CgOsX&t! VI(KN<'7iSA,\uYXHox\}}QJu4;(NjisMO~@[P]6*sLn &%4ZTxuD7U_en/N<>mE2pYb|"+@/xX>< s:
o|L=o/=Ex&rT]?<w|/?1vro-Yoo)K%X.b\{L,0lGGWt|-VQ|4}M;fI0Z05Wk)yF4_5 &SDf2wZu'jlHh_!]yF1]EL{+MV.]e&bR&(/NZrU&u(kx)46c;%~|6fde{%8e6f&*H9gM5XuS9I11Xcn#;-`}`8;7ov/<#nY\P$hy=q[q=Z }T|A+=eWgvR-Lj4>(V*qDz$l[	\ZDz	XVrJ 7gf42TF-D-s,vF
'!'URdTaBO$	dZ#A/
W}q	M#D	-\S>|	n;-B@rNq(uk|
V:%4&~G6LS8"NdV{-{IP|	|{jC@dG8~[N]=goXy&lgn*?mf)'Oa
_5/8C-;f<[fokcWnVb*ud:3t9"o*T5+_SBOF,MH
}x,V>Z+xh~D^D&+Lt-BIp%GRy[Exi=_nfzS4f>2$*,1Dr4k,+ 4/QqFAW.F&Ep!N-0]MGrK+h$KE#.KBi)wWTAd%qA^O>1>:.-q#Had>IHR:'60?#Nc MCyh_*j/nezr1apQWUfSopt^y_li%.48QAWTM4Q^haW[{^[:VOs		u_nFySFP03o5Av6r= 1I'^0QUkc9{-s-LBGCRs~X +\,{N S~mR8/-4ELCM0xa:"q
CmM97x9AuSN=kn~,o?>`bX6bG.|4lf`u:JT8Hjzd"#ayR":S	gt%K[2vTiJ/r]"sd|/~/LBsRvO3/y1v|1w}3U0Mn{X3Cz|{2tAiu?}
-}*c8	P1I|R-`@*B^IP)	8$N&O"'s[IaLl  MKlEGlX)CI+?Gjooy)  :;VnW%E]-lW^[>?vhk\Asgl\h^^=Ve*|ZF9k..K4ks<J|#R?^)uih[yJwN!h]El")vKMs2;%#z2I3N|INn,_Rk=8xIefQ
IJ6DCe[Q<qzW|9DP~Fh+GJED-"-N"@+-9KV9(
Sp%k7?6qy<+wxq-;wGEx,nSO9/OiO.yUiR0@HedZ;h8	F!8^|}@We0P3mQ"2j	i,FUO^Y-!R.^\?z438lc$\PUx+)x&A!&r|(p)S -8EF<J ~\`<Yg#VZ-WaWj_CRCGc+vplL/^uJ^;\_v)4nU:K~p)Yg<l{	~c7dS
hO#\@%*dvVFL^0pMw    IDAT%I\zh&:5=g F}4m1*haFP1u-a!$.q3nAhR '}H.'W6)-s?G&|$%-3}V=Jj.'VpMYlhlOd+N
H!Mq*g@+cC@s2ca<7Q-`+~^FyKp8v_Y!v[Y pPW~$fOWi6Rt{ 2U9^I7^5V.t$&R#I|fJVk}=x<zy$}Q4H%DguVhDp"?~CF&3kBcp\akFsE22JG<+[62&NHIuL(0Plk!	FOY/$q)k:C'DiNS$`2`9zH5 2$O/)gI:<%Et[rY@cl^Zt<yQ~2o_-ZQ/ur!*gtcBq	8'&8[ues&bI
"#
7=FHEwk(t?v/K.	5/Os(:D<5M0$n6[ 0("1fqhz87woN&|%(t:V# oKFYW(Z)q*TkeK,5">p]mvIy%Kj	V:y-Z^\s[zS^&igVE>y^WjAz]A6:`d&?
4J%4TiGT'-G_UU)cDysf6ZyN
:P#=`jw^^rNy/A*zWh$v{g
e2N47\md4[B*1s>*|=xv2b7Rk~]X&/ZVy 
bHc7%D5RQF%fUDZa%"$
4r NtakE]IS	kMM[u7'vT.#R[S;j$(57	g/k20)oz8A<g-n,2VyUhTG.Gyl o'W$)mJ	?O%'BNl:)@*|l_.2
[MBv%F,mrBs3O Jm/uop"<!WCVlQDaU2&|$_`eNvHM0K2]F [i0dKkUB1a/~JW`>=#i!PtWA j22Nxh+MYJFfZ;qR"c<i_nOzdr.u#mvNY6cY<T|[e{x7F%~j<xc'
v$Cpo&j]5WQ21J[4+FaJ&L|t)G7/6nW45:Hl>qo=+[7"`r
8}e:*=50!5W81d*r:,Gcy8A,0O;H4Z2e\!JUYmJk4TVb%HJxWz5HF6PoGaHP	<}+/y!(Et|(O n?@s'T+G2K<[gb/?:P~>0n[YVx/o*d(ocUI[szyhh -6F:uRAD_LA]RV+WU`^_6j'*aMMJP:-$iYi!'O&aBI%4	
"_7G&B:^<3N&E]OJ)yGcZ	aq,VTS'nzBGf@&rNO)B_u(Jx 'CYRt$)+quS/ F{X<{ibpZ|)<Z:)GOCi41cvf-e/1Ex'&`UeigOMv.S?cJ*])g8))OZXo6sq;XC>)atr:C?o*]/M_-*r7]W'Qxl;&?!tZz4`|U0GAXl53OZhZA^@kLL- lM%-2qqLC2{yV8J/Zq]&PN7`8|X*[z6iH,,UcpPf|dW.	t@i%lY7M@hry$[C_8~?#Y*y+QK;^}Jkl!/+NuM>.$=~%p:R$~SZINKW*7IAGM;"'|>"T!.y9Tj*?Sp+cGm j[<u25& 3a}' /I\4RI@%LN#Bp#=%2%wV^HLe#*zqXA7+7ateE6y/R:VywG`q3,=CDS~hvi2Zx^^;km_!vb6g{;fq36(3;#xd"l~LJ(v6|C&HLbu X{i%w%Ph}BMy=bC}*u(#AjTlK4	?6}g}0B)2U}BQj|M^ZR)BwcWb^GzuTlAVeC'5Vg~eypS()$H,wvgb<N8:Owkc*g7:{wof3 UGRX#8=G}>c{x,NzRGtNN>sMQN9MAHnM"'PS;cgDuVI5!B"itIrZ#y/hkLHo`M2L'3@iW5:$&u(XTO FLjDxVzV.eFsWuZW/BVpB VL0d	_-c $b>x-WfeDOkY2-+}Fn<+*PK!Q^+&!1)ZofQ@d?3qe7D[)7I=lQx	'L2Pm/'B0u
&`9qjYG~@)K9t7\e*&dE4O@Y5KI*l9"#tj{RgYkJssJfeyyff9H)C,ERQH @,. 
A_pHI<y<uj{]{uyaO>GhJ@>*.(Ph)o\FlIhU5{6d3p*<1R<R,%'?<1K"guiAeW3?KU'rE1LnlF09u  Cg>?'?>>wFw+==raf	+5C&p\.7uC;aL}6#uuuUjlvL8!$R:Ugk<;*D	97~6$ U&iD1my	@9\,Q 7O,+,3#aERAw,S84`KD9]#tnl4>S0BD?%`VfuNQ1'IY:Z79SV3Z=<
` #]|N/w~}zjK3~Y%#<>fYoL'6m3$ /ARnF&e VDP`=Q@W!Rt2wYq6}u;(51M
H--+tC:jm)A .!W%?	0v@:;T9yY4 /t+%aQFxJ'{@wT`vX-H2J#pu2:=%b38dr)@xre+NXq+wb#@t`!m[o:}+_hwz6Zl22ph_ipp:+n:v xn+z]rBf"	\mg['8*#;dTy;EINJK$ Phd]L*yx%G&~\ky	 f<dfn2GBMg%U
<1'M!
aT76.E)hI`257oL5pQ*r`	QQ9gIGnLW+<{Lzhg:[L]=B4*rtamdcn`=r#c<0zD5|>Sp<w2~*pP-I v=Yx056V
33G2"@``7j` 6xdNg-p^.JfaZ~I4,X	^b!Su>DD`:?!2B9<+~v^1:C-~!Svsw	-;
id%?S4)(bhGOr"0^JHi,J\xDAiANXY	x2t#i>kfz{,Gf4sN7B{[NEn4hV2'W~m<C }+0mW|wz3O?|]Niv xuH}x`XC/"N|Qf(&8Q@]L~odO3
\<Z0qIs#/N\u:Sbs]!,/Hr[y%5]Ra- 4#At)(S8T{d@@6aO
+=="yDV%
edXtk"$-*.rD;+?X h]fd)!.+p:oM?_MSW }t{/LO<MpySNE&,T_wjV3?2FvE\ JeV!'L*l&5$wJ:7]_@zM5Z_*o5rG`h[W9$P@)wvR$mzLl{ 0[@9!3eK/pth!WPyrt
.*<gK-0C@>:;,i NITL4;\	>cvJLr6iiM_	kO?7-M\	[N=>/}azwW^ye~8}v &;
rDeGJ,P- HRSH vc[M^"(u?lnwAm,B>gn+'@n#6`9<~ U*$xy 3 jn/3miMGuVq&%bdE%Gv&vtN/;'X!g_P|4OpmfgVp	F$Pq= 6"T5PIp-s[*;y,t%C yU_f/MiQM_~	i/LO>/{	k<w'N9raM 8j<DI| 	-AQO:H;b[zs6$"Hxru>0Sm8tG*^qBgu($/ xKn!mDuJUW>+i$  3hdQ'
yj#	PCCC(ci`p3MW tOGgQaNiUH1eF6h"pZ	*(K~b~Z[>zH8>my_6A4mtk<=N'5g3_J~6>Y}3iP(2=;\([O?f{pH;sCc)On1ew"KU/QI;ggLUnq$q{N9Fi.ioRP8	AlIO_2&YAVN#i;.
\8-v#;C7~Q#e\Z(lB\e.|j; W`-e,.%	IoF:QhcP^it#>newy?Bs&gN=5k~w~_S>)zc9ck
i#?Q3qg<g])xYM5\a#`C+PIN@ Aust6u[";i=\O8Pf$f3/po0m[p{q	X
Nj7[|m2e"@    IDAT[QA{(j;+aW`~#lagTpgJ%fUS`Y4STaN_ R=Z6=$DAYI,:vZ+h8qPciR= kw#d";"b:~>2w{?:|E_o	YJ$,q,v]9]i/G?}Io/}~CS>}!#g"k*N^-g9Yw(z<J%3,i=l=VxYX|+-d3c0P:7+Bl0	w{I ^FI]5C>
#-Rxi\V%!qQ!a/TpcSPLgFc[1gT2
G{Pam(\%DRt2u|FNpn,Pu'JT^a[wM^m=GM/j-	 al
p']yS"/Nw/^wnLXh5k6=igZr#J#bMZK4L6L(Q{~50$CN6:N<`)\URIg t7L;OKZnG3x<f3!2 !(+,Vh5)^ ,{*rCpX^Py6-'KmfVg@(5`*(BG|q=6|>m3=Mx2oZX|tI54pU4&,9mD~o_8N~0#vmzw:;?6P/->z`L 5"\CqYEx#vsOV:48<t8":4BWy#:89p	TGDGj#a"D	#aX2uhWJ`27 _r).^x0RL;
6s<L}CxXug;?*Oiji+5]iz}Nj6q'ugu>z__>yu_B~MAcV]!i.y/ik'-F|RgU'O=e@,m !7 bU-em]3x>tj g:ZI:p1ugYY1b;8Ce4cj_]rLdGoGP+} HXP5~AZp9:cK)BMSX*tz0#FMMfD1v]]z4,0]]5q=#e|Me,3RY,oU_(HRmwS74r/5mt"k@~`x;?}Wilwqk>m!s&XyrBn"r(,Y'OyRo~SZe&Y*2w$vO8n/M@BZ#oT^`6c30dm miu l,iY*@E:>H`IB<>(o\e_rCJq1}2Z/2
3*p4"dZMZF4b;(4ne\.?;T/u{uSw> 7<Fmk@
k~{[W#{.O+y0)~_M6zzT/metKqX.46"N}fK%BnhyB0E]cKf?# v4qQq{RrC:\3 PH1mH\xtjL;]LG
H&L#q+JnHMXg|9l9M*|C0o{GL!umC:L	?":tBeMCECT*>W_yQ	E5~jonTH.eMOfIO|X-?t66Z?g4~K	f mHw=gm]G	F%blVp
*Wr0
B@vUt-@t12Z'[Bp}B@0bCSN8SK1d5%6{iz@ p8\2JAeYoZJ66.Gx+_F4^-/k,#Z@,815ID#5f	'$YxZ9&xmZ0D?P:5#A\!6M: _t=n;oMy;th^s;vhfB`D5B3 :JzDFjLw/\X#n=D<bMV,y1{x4IQ#l<; %p&4UE
\[?T#W@8;-(rk{eBFOE0M9dAX?@R*|;G;*#43d""r6qxME"v11p6'c`zW{?c qnEV 3F wE([{jTL";._xon>~Tw)Nsk<+}{imWy$1*,v}i"tnMGQLXqm"D~!LDTZfc^mWs~n7	|MN}2T`MF4`!K,wz)8%H)04]|;V`n`Hgg+cKO&uFz#/`q<RJFLD5xMgHR0!%!#m=%t	40"&+,6-'*q|wDwcYt6 g:+!=gxnz7c:w1k7iGy>WDbKay1$H}{:c]Q'w`o56>YFa|%3acPX^[q35eTU8 <Jphafo8x)u/*3Xr}X.vH;io:nG{B	8 MfWC2[l$]dI	TJH)mk4_2]=Jx%B#aYCc0/MLG`L#Yzd'+G4_*tQ^XlcGR Of ;tg4388;vaz_nvgz7mc8 h) e aF/t7nIdxYA U<r=/p.z0A[,ior+EQprmNHDA{tt.3<#phF* GXH)GZi9)2CD[J&Yyt1hUl; Fo{J<4xS|=8$5Ag3>q:pS+*MpI7x)\|iG`_!x/ kzf<xEwMo>x>}kq\`VL#FF]cdN8?~OU_zE5]Q8FK
@A+EXVr>4`i/lC1=CAP^'-4#dvIBO1G{"r>dMJ"F*Gx1aV$d7 [JAJZZ}T -%/qIaT[6FV"4\>Y2IWc6p,SRr.ez/L_x_}I7!
}(+Ju|i[/O<~:^yqnh1ketL.t9n^31VghJR}CBD OwRE:0mis`j_JtZy	
>"<BLo=MEuPL>|G(v:ZpieXmx+(Lo03>42t bx P|C*mtFv*J 782njT3-xIle a\JC|Bo/D^3#4fL?8=t<I26"vT7G?P8goPjy4;O{gN,$e ]|v}xh:q7m^O3D8H4\Z&9m;*a\qH<
3yb>:/m:[c81&mNt-8O@ZpehI8F2r(H \<-T	wtcKXtpG6(c(}Gr$7o>vuEi<e,C"0wY2hwp68q7dp(a]yxmFWLwiO?lK@Ba`US}z+7_mE}{d	,#?:6Mt>,G]/	W:3 \[Vxa*POq>`Bf,7&A>d#n3fA,/	Q	pz3&a0h@TH	-!al2Sm	]p(xnOVcl0*YMNF>=)Q9_m "G-?`3:,ftYe7IC9ySOM>CUS\M]a%xr~i	M~9 =X.<>`SW6u=l5(D&z!|2:wS\.G8 k9 HbEm<QgB	iCCXBN%gVEd4*9J#dJ M
]M5$zJ	2xy.$2(^`AB<H3ah=Y#yW mm\HRFfwLG&yAqM4/ Uc [#GA%83pJf$1p{7.2j<n6]Q%D!~9}0=]3o?Kw^p5? ^|<y vz.q6]J.%%1 V_t&
xqRZe2+"1reHEB-m~qqT
wwac[%(Aay5'*L>Mx	 r>(YBpb0=\BkM1BFbD5`]a.W3<)Rr4t s:j8-DmQm=~:$ tn\/r6 oS\lOz^\corD$~BU"+GgO.LLB?#`!+] ww'NT>\m$DmQ%c9g6}UAN,[u^0g"`&agX|Dy'U
VF|uH^H%@:W4#Q3z*Q05PY+@qk(0LG\ynvx1,:5`c1G&+,*0rK.W0y:~4(FMz{V[hjZD$1bmLY!8XUq\xgpF&pp=Jqf
N	<]:6?wh;x!m=u)
\wH	
oFoL?Mz3(Dl2:q5;ExceX#tMCw^muv XEg*HtP)66o?#6	F=J!=;BJ><0xR?8h(>KLg+F}*<WN" YzZBE	 x!k{7?i\	Gx F5PHEwaQ0.Un`;ktu]wgV]x5t0
3sWg[Xw=kLwC]$4t2#1-x(:`Wt;F(#P'6i:_ZOMlul7EXNgl>U |8Q[w$	Q0vC~cy#Ng<A^za)@ #q((6-nC{[;I^t8Z"?^e7~y  q/&afx3S7j	8u9n$bD~b](@nu
l8x`g:y$*dEn%uAyN=nl1K! \zyyuI5a;=;& MJmh%)+#uvWyt,S:8~C	y^+LlT)ObbcG8u2cHS+4iSzd&t<kPawmqy`# q%n}ABgw>
<=(<RC^ c cR@*)c2I7|Kb0R@J#B1(EtRt~B,kM`aU9_QuQN(0@RHT]x'Qml{vVRwA[i7    IDAT586&j\a{Ond#Z\D\82Bg#Y19	RniNdcqe!rAg8F8I<3u;m;v@:`t;AAqquH]3<4BZF]B/aJP*&>COa+Atrd!O'4mZD p =*r:[n!lnxxTU(%IzJ4Bir$WF6T!t  p~nqVErytFz{`^0h+;&<j1N ;+M}0{,GQeS01x"?dHn$a/JCEt!N]1  H'PXoGuD=)37;uN[$PF&Xpx3Fug)Qo,{qQ675uMLUdQ&K.Xt1qV`MT.yf*'{JEm/d93>	osj-y\YEa@aun=+CiN`GO?U<{Qh}g$7|\|i#CCt0T YOu$nxQbT|77x2bMpztG7("0g}Ags_{u} "ZT'HgR0 GtCi`GG)
yW.>o.lU6KO<getzv~NLBm'%v[teF/`#=1a:F
9"FJI;?gahHJ"He*/-#?{Yub#?!GV*qPc*c!#%zTji$J
4#:jwjG'Gpf=YSc?e"cd]m~l>7f)qWu~/}*P87DXo4JvGFxR*=hC/yPnH5"$4]lbAt-]}v7?4U[M8rf'Cf'u*y]ScVOK >=~xUQKC=tU2`(7mRC]e=u$1T^tQh Zl(Y4^!<{niTIniU,=2TuG)0mcr7HCNg_n~_{
2O|mV_SEYQKKd GCt0f:g{	MA?tVo)J_B"jGo=T]z	S\,X"OlGaIf: %cTYtZ eT	Zbba(p&
_%I}SJUp9040DTSf(2R!)Z-cc)<s* otb:OL|G/^{9K(8
`U.	>8FAWV(#t]gFYmLodQGS|oe! c>h4!yW 6tZQ}e `(#]lW6Fc_WW(
;PTD3EHZ=t"V3cp:Z$	SW;G`erH$aTS	-M(-R>f@H	q #Ad*f
:O PrL@Q]kj)I+{F-z%6NF}0Ppn%^N3	yyz|4;CV4/]	+
P\6ti1m!N-k$/YqdaM&hD.//
izR^/-x_/|:|Fh"Vy^{_7cn4/DPDE\KngY3xL#X}P lx#m8RG|MY:nJ;X]i)Cj:@h'fovC<~4-|	`d#LSX+(: jCIU#Ly(EXB#<$<ejTGa[%0CO5SH7T_|`~ndK^8/*hcjX8-Xy.O	s[/aM:*XX
i<VQEo).@r%`
KC<#$Z[, OO:G(;\vE6 A)]'n<RS"HyL[Ti':j, Y(HKvph0Q)-" :$mQ!):|5<8D> @!8]Y$1( %%&,U@?9Duv]yF~xF@gCM4+c8.0=}_GzO~ W{z:yt)@nta8s7fE)}Uf8!qD(xtu'vke/#j{,8xL/mEn$W,:Yf#S[]61@N_RUpi|F1$sP~@X($eNsRNC"*l(% dXgg/CG*jWe 52`a; OTS#NHaP!\pzEp N3t(Jo O2Xt*}n]Tl:5w  QWcttt4St|#.>8/\P9[<pC\FyF't\kxYCT2bS#!XwAv@]@fIJK2.~l0.;?%#! _(eiS3=:^2 PbuJ-i%uA?myCD/g+v3;Bg/qq@ *t~jfe8[xMX *K:AL=jnAKa6hN`F2i]iY P4L,{EW~I4:N"HiGdn_=";jSugvpwxi8	 yAic4 2uJh)^Nf cf{ykoi_9~4>EHk>Rt';vZ&tH^M}GYsdVlhE6N!<cYQOR:^@_p:t i;
2KP{ P7M6rC L_Q^
S+AtYi7Zi<4Rd.<Q0%W;3dcNQ?;eQ$3u[-v,zl!dU-21b?	q`9GCd /<=zD96}?"z^Hp Zwgnu\'YX/:Vw:+|b$'ZW9'g*1*@vJX?/B/`"N[5UAND	.AN2:8Qie2||{ :Di-bvy/?MqseA]1mq=-2l~d4kResDis KVu,4l-UhjAZi}\l[m8c
QyR{O?[SN~K}fcKOxiG}U:L]"hKn:zklTr	97D:|e+9}u$ V
eV}bI4}@xGO3c, {+V`Lw^HaZ/vlUP-8:mXx5F{v	)ttYwxiD+Y{y6"4HElE'sE:Bc4<y^1xJ]Lq,8GVY&&!2[ osAYc %3L)tqY9v^~W_?yvY=2}/	}orEUM#,Oya8B 9iih7[1B
:2T>8 
StG ZN9:tBe#b&H(Y,mw&.Z aw"G2uGN 0maT'i3:dF@Fs;B
!m.vLN=
zE5nKLs{z`i/Yd 2VTQ]rM/XO	2E}o/SbJqW(.>><#7W`n`oP\,
>@&lK5#*vAo<d:(\trAdDr9M	H	u{j4Fi)'NPQ?OG`8DNwKx5nTae![&Lw!{;f!,$2%3dd3f]9H	C''o]r8!jJxGWFUfef(=!,znL.qA;EzIMJ:cA[r
+$%NQ[~
r N|:a\abM% spoxOQe.@m8xn8%:4?3-vGo|+|M;%30l(1hj|Y0;.l+5Yf%]d-Qm %euoFuy;MYGC\]BXgo2@Q ^~8x!o61@kVNiSf'm|:"0|@|	Oz &bC6fw8=rgO=3]cNN__fV[9:~T *6-GojVZ%zF `)UKnMeqL@?Y ny]U*\8; R6N	U!27:5*c% eA[5t.5>5QnQdyn9NPH7k`hdDx]1C|9%F	"N!3(N!#y_|izZ7_NzH1{ Mn>T$; -ur/8BB,KcLcBmIo7;+m:pt^_&z7<%u^Mg?Puv,1[AH]dExi*2cp	
Q SsmbAE2";Q6-:yqQ#8Q~ @rJ4S~qx!xFC&|2US@#6=US(4\XBo,52B$XTVLU2y]w=R`9n6o3Az?S37WLtS(N0*q,#hp7:sx2lG Ca3t>s[N9o|;})u~Ak&kFma6T9'#mEKtJ5I?V:I]n.9C~;b]L="3KDf (;AX6rAiKq~	'=FP<@g*y6>h]N>6
(Y5 E"taRU XVo]pWacH9xOdLe /n*M]SKL[}]B}.d!hiOd~J1"+QDV596EyFe`]xXI<=?y`Cm>,Vm'lm5h+aCh!y[\Cq4t LHsTB$0\]mBe3!t-59SN=.i"S,sbDI3`
9 Rf%10z=N#uZ2x:00h7|,D08yNA7~x2b~s+g5*r
4H{&mB48T%f%ocZ'6AGAH	.#K&69>T
_TG/o&fxl"5^`>>}Z	e}$|!_>}q&O(&0 e43uoPu
e'zcJ;rn81.zsH{A;y`N&e1,<{h3FgtwBC\*M<@Qm % 22Hju i4%GIr$4^-R2$Qp,0yyf2E4dVT;wWw&QQQP)_}52yX|oO?/f
z2tEzy"3t]r&QlST_"7aM\/xw[t\7W>:eIY3+n:qtT7HgRP' 'h>'Zr/]$&<t@WiA<:gV;# O}&5I0=fJ1O `RRF*w1	K!Yp/p0-'hN7)*%DrgU>!rvP#MG`8s	-FjRGT\C\vLG~`s$2D?gAi:"	mi01YHPN |c~;xsIBF<x	<4gdqcQBP):PYj@-~CMre<Q;Vi|IW_"Spp#a<Vp8T=dWk5@}%<
=e$W]/    IDATA:L+MiF!b-KXNPi
^yy5<f9y+a6h|-^+MGJM=$D)2=$<J-'@C=#>[hil')KrL.c-2H!
e<	Lx YI/R^Po>P>-guz9{	ocyfuvn9
x!6	\[z
c/uh>kuwd!B1mGBKX>Alo"%IN,2G0[{A%FQw<3tuWT8x
hMtpq^I8OjHFg8{	ix4=T.8x,UjXr|,A=235VGke:<8PhjCRQr]FA:Dz.Iut@\$6+[Ay:(4@nlO+.+pvy=DcA-oSc	NnQ@f>p"UN]{uT@n#`2(<"Y}I5QY&NKvs^El>71[b]-8?v4/	8Tua]=?KPqAfsR?t{w8I;M(K(ZHEesc#W/HVD;m2.]:?4s{:+<6,\kE6:5]3G`QK@9#.?~r_k*-7>69?r_vHt<P MAJ{e"|#{|H,xo&s 1L)q5!me^3?8/@t27@Ks]+j3O8(CS4aA5:E a_7D ET+	t	B3nz"p@P.@:iE_qZhM(k4DHQA>6hlw*p,{wpzt7nA03pExqJE'B8GpJW; =kL&Y7z	ew~SG'~F{G,ef`HwRtmAgK 	rOeV-)&K036dVg0Gq2Fmlgq]Aho;rAb
5L# 'GM-j
CA=(I1JF%[CS_'4v&-qNb
7p/SwW#7o;v'/ZZ;hM-95,Vax&x5Lh=SZ%ydCo?LEB:J]V- ;H/gyQo/"=/*tt_LSj&U#?q`?`.]:;XD622.s#@w(vzvr@5&=X@}^v9~w(9/{w04edq6rn|`h'4
!@_7^<=X%t|^fL^u()J122feZ>W,nUL\* S$%(Er5/><o tt^VI#E_-G+iShPtiE46}V#bgF[U_DVgFWruBi;@1!Mtp)<X#L{=O:tTc'7}Wwngk/koPs&|x2]?tUOLd`R pFmBdA}cY*`v7}a.ssLgie1C74u9Bt7]V Kcd8DXY|R@  L!:ys	#]mI7t",<(]w1Yp'nqpT^).^6&r>qU:-]..~/;4)F?zQBXN|'_USgpoa}0-oFvM2-gz8#m&=Ka}}MN_zU?;N97~'_/?}N~>{9x	
Z&!"B/:F+>Q4Tx3/B6]4Dhq:0tRYH("0uFMt% oF 6>!TJ[[4Sj4:9J\<r4+qV#;>S_fHtJftH~ 0 J>`Ssg\_^UD68,/'zUUi ^"G SqJK:&;zcG/8/NwlN@@=[\a W]&+MzX08?!}D}$xWbITCDT[]tX27F a. Zcq#/L1\iH;9Xkx 1V$10Dub=C#u X7D6ss02C
} 8,kUF27@tJl!Y2[d{/<Lv^_37kl| eFZ3D_U}XGxF$PFf_QMwF/`I`sZ.\^ q8wEfa/_pdk[P*toM;pVm*6)?sz#c&>ia4w	v+D}=\"ip Cz
b6<Z B<n6DFYxyF/"puTOXO=^QCNYD&91sDh \>, :C/'66L:'1C=?tl?vn<p\om;ExE/$CU|+/K *7D&#ryy!g[e"ww3,^?Y||0 .ELn!"Oq5;7,NTO/jbzm8 cWCuraCRr?r^37q$)T*i*B*o`B([$Q.=0
)'J %EUY hTGgOM;FOiUe)M^$ l9,
	".RC0E[q\Lx{<_-k	p~O>V{GovYGKF/}v/yw^ .QE?Cc~|PjFq]*n[)^ue}E;mH_57;
"u21Db r+{Q6?@V2>pB@,\i6RLpH-Jv